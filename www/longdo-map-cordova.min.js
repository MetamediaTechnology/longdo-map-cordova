document.addEventListener("deviceready",onDeviceReady,!1),document.addEventListener("offline",onOffline,!1),document.addEventListener("online",onOnline,!1);var apikey="",tmpDir="";function onDeviceReady(){}function onOffline(){}function onOnline(){}function callCacheScript(e,o,n){e.file((function(e){var r=new FileReader;r.onloadend=function(){var e=document.createElement("script");e.textContent=this.result,document.head.appendChild(e),init(o,n)},r.readAsText(e)}),fileError)}function download(e,o,n){var r=new FileTransfer,i=e.toURL();r.download(o,i,(function(e){}),(function(e){console.log(e)}),null,{})}function init(e,o){var n=new longdo.Map(o),r=n.Layers.setBase;n.Layers.setBase=function(e){r(offlineLayer(e))};var i=n.Layers.add;n.Layers.add=function(e){i(offlineLayer(e))};var t=n.Layers.remove;n.Layers.remove=function(e){t(offlineLayer(e))},window.resolveLocalFileSystemURL(cordova.file.cacheDirectory,(function(o){tmpDir=o.toURL(),e(n)}),fileError)}function offlineLayer(e){var o=e.name();return new longdo.Layer(o,{type:longdo.LayerType.Custom,url:function(n,r,i,t){if(navigator.connection.type!=Connection.NONE){var c=e.image(n,r,t);return window.resolveLocalFileSystemURL(cordova.file.cacheDirectory,(function(e){e.getDirectory(o,{create:!0},(function(e){e.getDirectory(i.toString(),{create:!0},(function(e){e.getDirectory(r.u.toString(),{create:!0},(function(e){e.getFile(r.v.toString()+".png",{create:!0,exclusive:!1},(function(e){download(e,c,!0)}),fileError)}),fileError)}),fileError)}),fileError)}),fileError),c}c=tmpDir+o+"/"+i+"/"+r.u+"/"+r.v+".png";return window.WkWebView?WkWebView.convertFilePath(c):c}})}function fileError(e){switch(e.code){case FileError.QUOTA_EXCEEDED_ERR:console.log("เครื่องมีพื้นที่ว่างไม่เพียงพอ");break;case FileError.NOT_FOUND_ERR:console.log("ไม่พบไฟล์ที่ต้องการ");break;case FileError.SECURITY_ERR:console.log("แอพไม่สามารถเข้าถึงระบบได้");break;default:console.log("ดำเนินการไม่สำเร็จ")}}window.LongdoMapCordova=function(e,o,n){apikey=e,navigator.connection.type!=Connection.NONE?(window.resolveLocalFileSystemURL(cordova.file.cacheDirectory,(function(e){var o="https://api.longdo.com/map/?key="+apikey;e.getFile("longdo-map.js",{create:!0,exclusive:!1},(function(e){download(e,o,!0)}),fileError)}),fileError),init(o,n)):window.resolveLocalFileSystemURL(cordova.file.cacheDirectory,(function(e){e.getFile("longdo-map.js",null,(function(e){callCacheScript(e,o,n)}),(function(e){var r=location.href.split("/").slice(0,location.href.split("/").length-1).join("/");window.resolveLocalFileSystemURL(r+"/www/plugins/longdo-map-cordova/www/longdo-map.js",(function(e){callCacheScript(e,o,n)}),fileError)}))}),fileError)};
