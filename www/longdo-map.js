(function() {if(!window.requestAnimationFrame){alert('Your browser isn\'t supported or invalid document mode');throw 'Unsupported browser'}
window.longdo = window.longdo || {};
longdo.callback = longdo.callback || {};
longdo.objectcount = longdo.objectcount || 0;
var apikey = '191af1de9989a92c9632de15aa3fc9fd';
var server = {
  map: 'https://api.longdo.com/map',
  coreLayer: 'https://ms.longdo.com/map/msn-server/img.php',
  layer: 'https://ms.longdo.com/mmmap/img.php',
  tomtom: 'https://mstomtom.longdo.com/mmmap/img.php',
  traffic: 'https://mstraffic1.simplethai.net/mmmap/img.php',
  search: 'https://search.longdo.com/mapsearch',
  icon: 'https://mmmap15.longdo.com/mmmap/images/icons',
  address: 'https://api.longdo.com/map/services/address',
  object: 'https://api.longdo.com/map/services/object',
  tag: 'https://api.longdo.com/POIService/json/cluster',
  route: 'https://api.longdo.com/RouteService',
  transit: 'https://api.longdo.com/RouteServiceTransit',
  poi: 'https://api.longdo.com/POIService',
  
  longdo: 'https://map.longdo.com', camera: 'https://camera.longdo.com', event: 'https://event.longdo.com', usertile: 'https://usertiles.longdo.com',
  vector: 'https://msv4.longdo.com',
  mapg: 'https://maps.googleapis.com/maps/api/js', mapb: 'https://api.tiles.mapbox.com', mapa: 'https://server.arcgisonline.com/ArcGIS/rest/services',
};
longdo.Server = server;
var cap = {poi:!0,vector:!0};
var copyright = ['', ''];
var defaultHd = undefined;
var defaultMap = 'POI';
cap.marginOverflow=!0;"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,n){if(e){if("string"==typeof e)return _arrayLikeToArray(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,n):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,o=new Array(n);t<n;t++)o[t]=e[t];return o}var PI2=2*Math.PI,RAD=Math.PI/180,PIh=Math.PI/2,PIq=Math.PI/4;longdo.Math={square:function(e){return e*e},distance:function(e,n){return Math.sqrt(e*e+n*n)},isPointInRect:function(e,n,t,o,a,i){return e>=t&&e<=a&&n>=o&&n<=i},isPointInPolygon:function(e,n){for(var t,o=!1,a=1,i=n[0];t=i,i=n[a];++a)!0===i?i=n[++a]:m.isPointCrossLine(e.x,e.y,t.x,t.y,i.x,i.y)&&(o=!o);return o},isPointOnPolyline:function(e,n,t){t=t||0;for(var o,a=1,i=n[0];o=i,i=n[a];++a)if(!0===i)i=n[++a];else{var r=m.closestPointOnLine(e.x,e.y,o.x,o.y,i.x,i.y);if($.isAbsInRange(e.x-r.x,t)&&$.isAbsInRange(e.y-r.y,t))return!0}return!1},isPointCrossLine:function(e,n,t,o,a,i){return o>n!=i>n&&e<(t-a)/(o-i)*(n-i)+a},closestPointOnLine:function(e,n,t,o,a,i){var r=a-t,l=i-o;if(!r&&!l)return{x:t,y:o};var s=((e-t)*r+(n-o)*l)/(r*r+l*l);return s<0?{x:t,y:o}:s>1?{x:a,y:i}:{x:t+s*r,y:o+s*l}},lineIntersectPoint:function(e,n,t,o,a,i,r,l,s){var d=a-e,u=i-n,c=t-e,m=o-n,p=r-a,f=l-i,g=c*f-m*p,v=c*c+m*m;if(g*g>1e-12*v*(p*p+f*f)){var h=(f*d-p*u)/g;if(h<-1e-6||h>1.000001)return null;var y=(m*d-c*u)/g;return y<-1e-6||y>1.000001?null:{x:e+h*c,y:n+h*m,a:h,b:y}}if(s)return null;if((g=d*m-u*c)*g>1e-12*v*(d*d+u*u))return null;var T=(c*d+m*u)/v,b=T+(c*p+m*f)/v;if(T<b)var L=T,E=b;else L=b,E=T;return L<.999999&&E>1e-6?[L,E]:null},rotateVector:function(e,n){var t=Math.cos(n),o=Math.sin(n);return{x:e.x*t+e.y*o,y:e.y*t-e.x*o}},booleanOperation:function(e,n,t,o,a){var i;if(!window.martinez)throw"Library is not ready";var r=$.overlayToGeoJSON([e]).coordinates,l=$.overlayToGeoJSON([n]).coordinates,s=t?o?martinez.intersection(r,l):martinez.diff(l,r):o?martinez.diff(r,l):martinez.union(r,l);return s.length?$.overlayFromGeoJSON({type:"Polygon",coordinates:(i=[]).concat.apply(i,_toConsumableArray(s))},a)[0]:null}};var m=longdo.Math;setTimeout((function(){$.loadScript(server.map+"/js/martinez.min.js")}),0);var EARTH_DIAMETER=12742018,SCRIPT_TIMEOUT=1e4,RATE_LIMIT=1100,TILEEXP=8,TILESIZE=1<<TILEEXP,IMAGE_PREFIX=server.map+"/images/",ANIMATION_INTERVAL=150,TIME_LEAP=50,MONTH={th:[null," ม.ค. "," ก.พ. "," มี.ค. "," เม.ย. "," พ.ค. "," มิ.ย. "," ก.ค. "," ส.ค. "," ก.ย. "," ต.ค. "," พ.ย. "," ธ.ค. "],en:[null," jan "," feb "," mar "," apr "," may "," jun "," jul "," aug "," sep "," oct "," nov "," dec "]},UNIT={th:{km:" กม.",m:" ม.",sqkm:" ตร.กม.",sqm:" ตร.ม.",rai:" ไร่",ngan:" งาน",sqwa:" ตร.ว.",min:" นาที",hr:" ช.ม."},en:{km:" km",m:" m",sqkm:" sq.km",sqm:" sq.m",rai:" rai",ngan:" ngan",sqwa:" sq.wa",min:" min",hr:" hr"}},DOW={th:["อา.","จ.","อ.","พ.","พฤ.","ศ.","ส.","อา."],en:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"]},BASE32="0123456789bcdefghjkmnpqrstuvwxyz",NODATA="data:,";longdo.MapTheme={},longdo.Util={append:function(e,n,t){var o=document.createElement(n);for(var a in t)o[a]=t[a];return e.appendChild(o),o},prepend:function(e,n,t,o){var a=document.createElement(n);for(var i in t)a[i]=t[i];return e.insertBefore(a,o||e.firstChild),a},empty:function(e){for(;e.firstChild;)e.removeChild(e.firstChild);return e},addClass:function(e,n){return e.className=e.className?e.className+" "+n:n,e},removeClass:function(e,n){var t=(" "+e.className+" ").replace(" "+n+" "," ");return e.className=t.substring(1,t.length-1),e},hasClass:function(e,n){return(" "+e.className+" ").indexOf(" "+n+" ")>=0},transformOrigin:function(e,n){e.style.transformOrigin=n.x+"px "+n.y+"px"},transform:function(e,n,t,o){e.style.transform="translate3d("+o.x+"px, "+o.y+"px, 0px) "+n+"("+t+")"},translate:function(e,n){e.style.transform="translate3d("+n.x+"px, "+n.y+"px, 0px)"},transition:function(e,n){e.style.transition=n?ANIMATION_INTERVAL+"ms":"none"},transitionEnd:function(e,n){e.addEventListener("transitionend",n)},loadStyle:function(e,n){$.append(document.head,"link",{rel:"stylesheet",type:"text/css",media:n||"all",href:e})},loadScript:function(e,n){var t={src:e};if(n){var o=setTimeout(n,SCRIPT_TIMEOUT,!1);t.onload=function(){clearTimeout(o),n(!0)},t.onerror=function(){clearTimeout(o),n(!1)}}$.append(document.head,"script",t)},getJson:function(e,n){var t=new XMLHttpRequest,o=function(e){n("load"==e.type&&200==e.target.status?JSON.parse(e.target.response):null)};return t.onload=o,t.ontimeout=o,t.onerror=o,t.timeout=SCRIPT_TIMEOUT,t.open("GET",e),t.send(),t},isHD:function(){return null==defaultHd&&(defaultHd=devicePixelRatio>1.2?1:0),defaultHd},onMap:function(e){if($.hasClass(e.target,"ldmap_maparea"))return!0;for(var n=e.target;n&&!$.hasClass(n,"ldmap_overlay");)n=n.parentElement;return!!n&&!!$.hasClass(n,"ldmap_markerholder")&&(e.activeElement=n,!0)},fastClick:function(e,n){if("ontouchstart"in window){var t=!1,o=null;e.addEventListener("touchstart",(function(){clearTimeout(o),t=!0})),e.addEventListener("touchend",(function(e){x=Date.now(),n(e),o=setTimeout((function(){t=!1}),400)}))}e.addEventListener("click",(function(e){t||n(e)}))},validateLocation:function(e){return e&&m.isPointInRect(e.lon,e.lat,-180,-90,180,90)},pointToLocation:function(e,n){return{lon:e.minLon+n.x/e.pointPerDegree,lat:e.normToLat(e.maxLat-n.y/e.pointPerDegree)}},locationToPoint:function(e,n){return{x:Math.round((n.lon-e.minLon)*e.pointPerDegree),y:Math.round((e.maxLat-e.latToNorm(n.lat))*e.pointPerDegree)}},pointToTile:function(e){return{u:e.x>>TILEEXP>>e.z,v:e.y>>TILEEXP>>e.z,w:e.z}},tileToPoint:function(e){return{x:e.ux<<TILEEXP<<e.w,y:e.v<<TILEEXP<<e.w}},boundOfTile:function(e,n){null==n.ux&&(n.ux=n.u);var t=$.pointToLocation(e,$.tileToPoint(n)),o=$.pointToLocation(e,$.tileToPoint({ux:n.ux+1,v:n.v+1,w:n.w}));return{minLon:t.lon,minLat:o.lat,maxLon:o.lon,maxLat:t.lat}},addLocation:function(e,n){return{lon:e.lon+n.lon,lat:e.lat+n.lat}},subLocation:function(e,n){return{lon:e.lon-n.lon,lat:e.lat-n.lat}},makeLocation:function(e){return{lon:e.x,lat:e.y}},copyLocation:function(e){return{lon:e.lon,lat:e.lat}},sanitizeLocation:function(e){return void 0===e.lon?e:{lon:"number"==typeof e.lon?e.lon:parseFloat(e.lon),lat:"number"==typeof e.lat?e.lat:parseFloat(e.lat)}},centerOfBound:function(e){return{lon:(+e.minLon+ +e.maxLon)/2,lat:(+e.minLat+ +e.maxLat)/2}},sizeOfBound:function(e){return{width:+e.maxLon-+e.minLon,height:+e.maxLat-+e.minLat}},polygonPivot:function(e){for(var n,t=(n=e[0]).lat,o=t,a=1;(n=e[a])&&!0!==n;++a)n.lat<t?t=n.lat:n.lat>o&&(o=n.lat);for(var i,r=(t+o)/2,l=181,s=null,d=(a=1,e[0]);i=d,(d=e[a])&&!0!==d;++a){var u=m.lineIntersectPoint(-181,r,181,r,i.lon,i.lat,d.lon,d.lat,!0);u&&(u.x<l?(s=l,l=u.x):u.x<s&&u.x!=l&&(s=u.x))}return 181==l&&null===s?l=s=e[0].lon:181==s&&(s=l),{lon:(l+s)/2,lat:r}},polylinePivot:function(e){var n=e.length>>1;if(!n)return e[0];var t=e[n],o=e[n-1];return{lon:(3*t.lon+o.lon)/4,lat:(3*t.lat+o.lat)/4}},locationBound:function(e){for(var n,t=(n=e[0]).lon,o=n.lat,a=t,i=o,r=1;n=e[r];++r)n.lon<t?t=n.lon:n.lon>a&&(a=n.lon),n.lat<o?o=n.lat:n.lat>i&&(i=n.lat);return{minLon:t,minLat:o,maxLon:a,maxLat:i}},averageLocation:function(e,n,t){var o=$.locationToPoint(e,n),a=$.locationToPoint(e,t),i={x:(o.x+a.x)/2,y:(o.y+a.y)/2};return $.pointToLocation(e,i)},distance:function(e,n){for(var t,o=0,a=1,i=e[0];t=i,i=e[a];++a){var r=i.lat*RAD,l=t.lat*RAD,s=r-l,d=(i.lon-t.lon)*RAD,u=m.square(Math.sin(s/2))+Math.cos(r)*Math.cos(l)*m.square(Math.sin(d/2));o+=Math.atan2(Math.sqrt(u),Math.sqrt(1-u))*EARTH_DIAMETER}return n?$.formatDistance(o,n):o},area:function(e,n){for(var t,o=0,a=e[0].lat,i=a,r=1,l=e[0];t=l,l=e[r];++r)!0===l?l=e[++r]:(o+=t.lon*l.lat-l.lon*t.lat,l.lat<a?a=l.lat:l.lat>i&&(i=l.lat));if(!0===n)return o/2;var s=(a+i)/2;return o=Math.abs(o)/2*$.longitudeLength(s)*$.latitudeLength(s),$.formatAllArea(o,n)},areaCircle:function(e,n){var t=Math.PI*m.square(e[1]*($.longitudeLength(e[0].lat)+$.latitudeLength(e[0].lat))/2);return $.formatAllArea(t,n)},contains:function(e,n){for(var t,o=!1,a=1,i=n[0];t=i,i=n[a];++a)if(!0===i)i=n[++a];else{var r=m.closestPointOnLine(e.lon,e.lat,t.lon,t.lat,i.lon,i.lat);if(r.x==e.lon&&r.y==e.lat)return null;m.isPointCrossLine(e.lon,e.lat,t.lon,t.lat,i.lon,i.lat)&&(o=!o)}return o},translateGeom:function(e,n){for(var t,o=[],a=0;t=e[a];++a)o.push(t.lon?this.addLocation(t,n):t);return o},rotateGeom:function(e,n,t){for(var o,a=[],i=0;o=e[i];++i){var r=o.lon-n.lon,l=o.lat-n.lat,s=m.distance(r,l),d=Math.atan2(l,r)+t;a.push(o.lon?{lon:n.lon+s*Math.cos(d),lat:n.lat+s*Math.sin(d)}:o)}return a},longitudeLength:function(e){var n=e*RAD;return 111412.84*Math.cos(n)+-93.5*Math.cos(3*n)},latitudeLength:function(e){var n=e*RAD;return 111132.92+-559.82*Math.cos(2*n)+1.175*Math.cos(4*n)},sameLocation:function(e,n){return $.isAbsInRange(e.lon-n.lon,1e-6)&&$.isAbsInRange(e.lat-n.lat,1e-6)},overlayFromWkt:function(e,n,t){function o(e){if(t)return t;switch(e){case"POINT":case"MULTIPOINT":return longdo.Dot;case"LINESTRING":case"MULTILINESTRING":return longdo.Polyline;case"POLYGON":case"MULTIPOLYGON":return longdo.Polygon;case"GEOMETRYCOLLECTION":return;default:throw"Unsupported WKT"}}var a=[],i=e.split(/\s*[\(\)]\s*/);"MULTIPOINT"==i[0]&&i[1]&&(i=e.replace(",","),(").split(/\s*[\(\)]\s*/));for(var r=[],l=0,s=i[0];void 0!==(s=i[l]);++l)if(s&&","!=s)if(","!=s[0])if(s.charCodeAt(0)>57)m=o(s);else for(var d=s.split(/,\s*/),u=0;u<d.length;++u){var c=d[u].split(" ");r.push({lon:parseFloat(c[0]),lat:parseFloat(c[1])})}else{a.push(new m(r,n)),r=[];var m=o(s.substring(1))}else r.length&&(","==s&&m==longdo.Polygon?r.push(!0):(a.push(new m(r,n)),r=[]));return a},overlayToWkt:function(e){var n=e[0];if(n instanceof longdo.Dot||n instanceof longdo.Circle)var t="POINT";else if(n instanceof longdo.Polyline)t="LINESTRING";else{if(!(n instanceof longdo.Polygon))throw"Unsupported Geometry";var o=!0;t="POLYGON"}for(var a="",i=0;i<e.length;++i){a+=o?",((":",(";var r=e[i].location();if(r.length){for(var l=0,s=r[0];s=r[l];++l)!0===s?a=a.substring(0,a.length-1)+"),(":s.lon&&(a+=s.lon+" "+s.lat+",");a=a.substring(0,a.length-1)+(o?"))":")")}else a+=r.lon+" "+r.lat+")"}return a=a.substring(1),e.length>1?"MULTI"+t+"("+a+")":t+a},wktFromWkB:function(e){if("01"!=e.substring(0,2))return!1;switch(e.substring(2,6)){case"0100":return!(e.length<50)&&"POINT("+e.substring(18,34)+" "+e.substring(34,50)+")"}return!1},overlayFromGeoJSON:function(e,n){function t(e){for(var n=[],t=0,o=e[0];o=e[t];++t){t>0&&n.push(!0);for(var a=0,i=o[0];i=o[a];++a)n.push({lon:i[0],lat:i[1]})}return n}switch(e.type){case"FeatureCollection":for(var o=[],a=0,i=e.features[0];i=e.features[a];++a)o=o.concat(this.overlayFromGeoJSON(i,n));return o;case"Feature":return this.overlayFromGeoJSON(e.geometry,n||e.properties);case"Point":return[new longdo.Dot(t([[e.coordinates]]),n)];case"LineString":return[new longdo.Polyline(t([e.coordinates]),n)];case"Polygon":return[new longdo.Polygon(t(e.coordinates),n)];case"GeometryCollection":o=[],a=0;for(var r=e.geometries[0];r=e.geometries[a];++a)o=o.concat(this.overlayFromGeoJSON(r,n));return o;default:if("Multi"==e.type.substring(0,5)){o=[],a=0;for(var l=e.coordinates[0];l=e.coordinates[a];++a)o=o.concat(this.overlayFromGeoJSON({type:e.type.substring(5),coordinates:l},n));return o}throw"Unsupported GeoJSON"}},overlayToGeoJSON:function(e){var n=e[0];if(n instanceof longdo.Dot||n instanceof longdo.Circle)var t="Point";else if(n instanceof longdo.Polyline)t="LineString";else{if(!(n instanceof longdo.Polygon))throw"Unsupported Geometry";var o=[];t="Polygon"}for(var a=[],i=0;i<e.length;++i){var r=e[i].location();if(r.length){for(var l=[],s=0,d=r[0];d=r[s];++s)!0===d?(a.push(l),l=[]):d.lon&&l.push([d.lon,d.lat]);a.push(l),o&&(o.push(a),a=[])}else a.push([r.lon,r.lat])}return o&&(a=o),e.length>1?{type:"Multi"+t,coordinates:a}:{type:t,coordinates:a[0]}},locationToDMS:function(e){var n=Math.abs(e.lon),t=e.lon<0?"W":"E",o=0|n,a=(n-o).toFixed(6),i=60*a|0,r=Math.round(3600*(a-i/60)),l=Math.abs(e.lat),s=e.lat<0?"S":"N",d=0|l,u=(l-d).toFixed(6),c=60*u|0;return{lonDegree:o,lonMinute:i,lonSecond:r,lonHemisphere:t,latDegree:d,latMinute:c,latSecond:Math.round(3600*(u-c/60)),latHemisphere:s}},locationToUTMZone:function(e){return $.isInRange(e.lat,{min:-80,max:84})?{zone:e.lon/6+31|0,hemisphere:e.lat<0?"S":"N"}:null},locationToGeohash:function(e,n){for(var t=0,o=0,a=!0,i="",r=-180,l=-90,s=180,d=90;i.length<n;){if(a){var u=(r+s)/2;e.lon>u?(t=1+(t<<1),r=u):(t<<=1,s=u)}else u=(l+d)/2,e.lat>u?(t=1+(t<<1),l=u):(t<<=1,d=u);a=!a,5==++o&&(i+=BASE32.charAt(t),t=0,o=0)}return i},boundOfGeohash:function(e){if(!e.length)throw"Invalid geohash";e=e.toLowerCase();for(var n,t=!0,o=-180,a=-90,i=180,r=90,l=0;n=e.charAt(l);++l){var s=BASE32.indexOf(n);if(s<0)throw"Invalid geohash";for(var d=4;d>=0;--d){var u=s>>d&1;if(t){var c=(o+i)/2;u?o=c:i=c}else c=(a+r)/2,u?a=c:r=c;t=!t}}return{minLon:o,minLat:a,maxLon:i,maxLat:r}},isInRange:function(e,n){return e>=n.min&&e<=n.max},isAbsInRange:function(e,n){return e>=-n&&e<=n},bound:function(e,n,t){return e<n?n:e>t?t:e},boundAngle:function(e){var n=e%360;return n<0?n+360:n},lastItem:function(e){return e[e.length-1]},pushOrder:function(e,n,t){for(var o=0,a=e.length-1;o<=a;){var i=o+a>>1,r=t(n,e[i]);if(!r){o=i;break}r<0?o=i+1:a=i-1}return e.splice(o,0,n),o},now:function(){return Date.now()-TIME_LEAP},getImage:function(e){return IMAGE_PREFIX+e+IMAGE_SUFFIX},getFile:function(e){return IMAGE_PREFIX+e},capFirst:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},formatDate:function(e,n){var t=e.split("-");return+t[2]+MONTH[n][+t[1]]+(t[0]-1957)},formatTime:function(e){var n=e.split(":");return n[0]+":"+n[1]},formatDateTimeRange:function(e,n,t){var o=e.split(" "),a=n.split(" "),i=$.formatDate(o[0],t);return o[1]&&(i+=" "+$.formatTime(o[1])),i+=" -",o[0]!=a[0]&&(i+=" "+$.formatDate(a[0],t)),a[1]&&(i+=" "+$.formatTime(a[1])),i},formatInterval:function(e,n){var t=UNIT[n];return e>=3600?(e/3600|0)+t.hr+" "+$.formatInterval(e%3600,n):Math.ceil(e/60)+t.min},formatDistance:function(e,n){var t=UNIT[n];return e>=1e5?$.numberWithCommas(e/1e3|0)+t.km:e>=1e4?(e/1e3).toFixed(1)+t.km:e>=1e3?(e/1e3).toFixed(2)+t.km:Math.ceil(e)+t.m},formatArea:function(e,n){var t=UNIT[n];return e>=1e5?$.numberWithCommas((e/1e6).toFixed(e<1e10?1:0))+t.sqkm:(0|e)+t.sqm},formatThaiArea:function(e,n){var t=UNIT[n],o="",a=e/1600|0;a&&(o+=$.numberWithCommas(a)+t.rai);var i=e%1600/400|0;i&&(o+=" "+i+t.ngan);var r=e%400/4|0;return r&&(o+=" "+r+t.sqwa),o},formatAllArea:function(e,n){return n?$.formatArea(e,n)+(e<16e8?"<br />"+$.formatThaiArea(e,n):""):e},formatPoi:function(e,n,t){var o=longdo.MapTheme.poi,a=o.poiLabel[n],i=document.createDocumentFragment();if(e.obsoleted?$.append(i,"div",{className:"ldmap_poi_warning ldmap_poi_obsoleted",innerHTML:'<img src="'+a.obsoleted+'" alt="Obsoleted" />'}):e.verified||$.append(i,"div",{className:"ldmap_poi_warning ldmap_poi_unverified",innerHTML:'<img src="'+a.unverified+'" alt="Unverified" />'}),e.address&&$.append(i,"div",{className:"ldmap_poi_item ldmap_poi_address",innerHTML:'<img class="ldmap_poi_icon" src="'+o.addressIcon+'" alt="Addr" /><div class="ldmap_poi_info">'+e.address+"</div>"}),e.tel&&$.append(i,"div",{className:"ldmap_poi_item ldmap_poi_tel",innerHTML:'<img class="ldmap_poi_icon" src="'+o.telIcon+'" alt="Tel" /><div class="ldmap_poi_info">'+e.tel+"</div>"}),e.working_hours){for(var r,l,s=new Date,d=s.toTimeString().substring(0,5),u=DOW.en[s.getDay()],c=DOW[n],m=a.close,p=e.working_hours.hours,f="",g=1,v=0;r=p[v],l=DOW.en[g];++g)r&&r.day==l.toLowerCase()?(++v,f+='<span class="ldmap_poi_dow">'+c[g]+"</span>"+r.start+" - "+r.end+"<br />",l==u&&(m=(d>=r.start&&d<=r.end?a.open:a.after)+r.start+" - "+r.end)):f+='<span class="ldmap_poi_dow">'+c[g]+"</span>"+a.close+"<br />";var h=$.append(i,"div",{className:"ldmap_poi_item ldmap_poi_open",innerHTML:'<img class="ldmap_poi_icon" src="'+o.openIcon+'" alt="Open" /><div class="ldmap_poi_info">'+m+' <img class="ldmap_arrow" src="'+longdo.MapTheme.ui.arrowDown+'" alt="More" /></div><div class="ldmap_poi_info_hidden">'+f+e.working_hours.remark+"</div>"});h.addEventListener("click",(function(){"ldmap_poi_info_hidden"==h.lastChild.className?(h.children[1].className="ldmap_poi_info_hidden",h.lastChild.className="ldmap_poi_info"):(h.children[1].className="ldmap_poi_info",h.lastChild.className="ldmap_poi_info_hidden")}))}if(e.url&&$.append(i,"div",{className:"ldmap_poi_item ldmap_poi_url",innerHTML:'<img class="ldmap_poi_icon" src="'+o.urlIcon+'" alt="URL" /><div class="ldmap_poi_info"><a href="'+e.url+'" target="_blank">'+e.url+"</a></div>"}),e.line)for(g=0;l=e.line[g];++g)$.append(i,"div",{className:"ldmap_poi_i[tem ldmap_poi_line",innerHTML:'<img class="ldmap_poi_icon" src="'+o.lineIcon+'" alt="LINE" /><div class="ldmap_poi_info"><a href="'+l.line_link+'" target="_blank">'+(l.line_id||l.line_link)+"</a></div>"});if(o.tagCount&&e.tag){var y=e.tag[0],T=Math.min(e.tag.length,o.tagCount);for(g=1;g<T;++g)y+=", "+e.tag[g];e.tag.length>o.tagCount&&(y+=", ..."),$.append(i,"div",{className:"ldmap_poi_item ldmap_poi_tag",innerHTML:'<img class="ldmap_poi_icon" src="'+o.tagIcon+'" alt="Tag" /><div class="ldmap_poi_info">'+y+"</div>"})}return t||$.append(i,"div",{className:"ldmap_poi_menu",innerHTML:"poi"==e.type?'<a class="ldmap_poi_detail" href="'+server.longdo+"/p/"+e.id+'/info" target="_blank">'+a.detail+'</a>        <a class="ldmap_poi_edit" href="'+server.longdo+"/p/"+e.id+'/edit" target="_blank">'+a.edit+'</a>        <a class="ldmap_poi_snippet" href="'+server.longdo+"/createsnippet?snippetpoi="+e.id+'" target="_blank">snippet</a>':""}),i},labelOptions:function(e,n,t){for(var o,a=0,i=e.toString().split(/<br\s*\/?>/),r=0;o=i[r];++r)o.length>a&&(a=o.length);var l=longdo.MapTheme.geometry.labelCharSize,s={icon:{html:'<div class="ldmap_geomlabel">'+e+"</div>",offset:{x:a*l.width,y:t.editable&&(t.draggable||t.rotatable)?-9:i.length*l.height}}};for(var d in n)s[d]=n[d];return s},numberWithCommas:function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},hexToRgba:function(e){var n=e.length>7?parseInt(e.substring(7,9),16)/255:1;return"rgba("+parseInt(e.substring(1,3),16)+","+parseInt(e.substring(3,5),16)+","+parseInt(e.substring(5,7),16)+","+n+")"},radianToDir:function(e){return(e/PIh+.5|0)%4}};var $=longdo.Util,IMAGE_SUFFIX=$.isHD()?"-2x.png":".png",LAYER_BLANK=$.getFile("layer-blank.png"),LAYER_CLEAR=$.getFile("layer-clear.png"),TRAFFIC_RANGE={min:7,max:16},TRAFFIC_REFRESH=180,SATELLITE_RANGE={min:1,max:18};longdo.LayerType={WMS:"WMS",TMS:"TMS",WMTS:"WMTS",WMTS_REST:"WMTS_REST",ArcGIS_REST:"ArcGIS_REST",Mapbox:"Mapbox",Custom:"Custom",Longdo:"Longdo"},longdo.Layer=function(e,n){var t=null,o={min:1,max:99},a=null;switch(this.name=function(){return e},this.image=function(e,n,t,i){var r=e.maxZoom-n.w;if(r<o.min||r>o.max)return null;if(this.tile&&(n.u<this.tile.minU>>n.w||n.u>this.tile.maxU>>n.w||n.v<this.tile.minV>>n.w||n.v>this.tile.maxV>>n.w))return null;if(this.defer&&!i)return NODATA;var l=a(e,n,r,t);return l&&this.refresh?l+"&time="+(Date.now()/this.refresh|0):l},e=e||"",t=(n=n||{}).url,n?n.type:null){case longdo.LayerType.WMS:if(!t)throw"Invalid URL";var i=n.styles||"",r=n.format||"image/png",l=n.extraQuery?"&"+n.extraQuery:"";a=function(o,a,s){var d=o.normSize/(1<<s),u=o.minX+a.u*d,c=o.maxY-a.v*d,m=TILESIZE;return t+"?SERVICE=WMS&REQUEST=GetMap&VERSION=1.1.1&SRS="+(n.srs||o.srs)+"&BBOX="+u+","+(c-d)+","+(u+d)+","+c+"&WIDTH="+m+"&HEIGHT="+m+"&LAYERS="+e+"&STYLES="+i+"&TRANSPARENT=true&TILED=true&FORMAT="+r+"&EXCEPTIONS=BLANK"+l};break;case longdo.LayerType.TMS:if(!t)throw"Invalid URL";e&&(t+="/"+e),n.srs&&(t+="/"+n.srs),t+="/";var s=isFinite(n.zoomOffset)?n.zoomOffset:-1;r=n.format||"png",a=function(e,n,o){return t+(o+s)+"/"+n.u+"/"+((1<<o)-1-n.v)+"."+r};break;case longdo.LayerType.WMTS:if(!t)throw"Invalid URL";i=n.styles||"",r=n.format||"image/png",l=n.extraQuery?"&"+n.extraQuery:"";var d=n.tileMatrix||function(e){return e};a=function(o,a,s){var u=n.srs||o.srs;return t+"?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER="+e+"&STYLE="+i+"&TILEMATRIXSET="+u+"&TILEMATRIX="+d(s)+"&TILEROW="+a.v+"&TILECOL="+a.u+"&FORMAT="+r+l};break;case longdo.LayerType.WMTS_REST:if(!t)throw"Invalid URL";e&&(t+="/"+e),n.styles&&(t+="/"+n.styles),t+="/",r=n.format||"png",a=function(e,o,a){var i=n.srs||e.srs;return t+i+"/"+a+"/"+o.u+"/"+o.v+"."+r};break;case longdo.LayerType.ArcGIS_REST:t||(t=server.mapa),e&&(t+="/"+e+"/MapServer"),t+="/tile/";var u=n.key?"?token="+n.key:"";a=function(e,n,o){return t+o+"/"+n.v+"/"+n.u+u};break;case longdo.LayerType.Mapbox:t||(t=server.mapb+"/v4"),e&&(t+="/"+e),t+="/",r=n.format||"png",u=n.key?"?access_token="+n.key:"",a=function(e,n,o){return t+o+"/"+n.u+"/"+n.v+"."+r+u};break;case longdo.LayerType.Custom:if(!(t instanceof Function))throw"Invalid Callback";a=t;break;default:t||(t=server.layer),a=function(n,o,a,i){var r=1<<a;return t+"?c=1&proj="+n.longdoName+"&mode="+e+"&res="+r+"&imgid="+923456789*(o.v*r+o.u)+(i?"&HD="+i:"")+"&key="+apikey}}if(n.zoomRange){if(n.zoomRange.min<1||n.zoomRange.min>n.zoomRange.max)throw"Invalid range";o=n.zoomRange}if(n.refresh){if(n.refresh<0)throw"Invalid refresh";this.refresh=1e3*n.refresh}this.opacity=n.opacity||1,n.weight&&(this.weight=n.weight),n.bound&&(this.bound=n.bound)},longdo.Layers={NORMAL:new longdo.Layer("normal",{url:server.coreLayer}),NORMAL_EN:new longdo.Layer("normal-en",{url:server.coreLayer}),REVERSE:new longdo.Layer("normalr",{url:server.coreLayer}),REVERSE_EN:new longdo.Layer("normalr-en",{url:server.coreLayer}),GRAY:new longdo.Layer("gray",{url:server.coreLayer}),GRAY_EN:new longdo.Layer("gray-en",{url:server.coreLayer}),POI:new longdo.Layer("icons",{url:server.coreLayer}),POI_EN:new longdo.Layer("icons-en",{url:server.coreLayer}),POLITICAL:new longdo.Layer("politicalwhite",{url:server.coreLayer}),POLITICAL_EN:new longdo.Layer("politicalwhite-en",{url:server.coreLayer}),POLITICAL_NOLABEL:new longdo.Layer("politicalwhitenolabel"),BASE:new longdo.Layer("base",{url:server.coreLayer}),HYDRO:new longdo.Layer("hydro",{url:server.coreLayer}),OSM:new longdo.Layer("osm",{url:server.coreLayer}),LONGDO_OSM:new longdo.Layer("longdo_osm",{url:server.coreLayer}),OPENCYCLE:new longdo.Layer("osm_opencycle",{url:server.coreLayer}),TERRAIN:new longdo.Layer("bluemarble_terrain"),GISTDA_SPOT5:new longdo.Layer("gistda_spot5"),THAICHOTE:new longdo.Layer("thaichote",{zoomRange:SATELLITE_RANGE}),TOMTOM_NORMAL:new longdo.Layer("tomnormal",{url:server.tomtom}),TOMTOM_POI:new longdo.Layer("tomicons",{url:server.tomtom}),TOMTOM_HYDRO:new longdo.Layer("tomhydro",{url:server.tomtom}),ARCGIS_WORLD_IMAGERY:new longdo.Layer("World_Imagery",{type:longdo.LayerType.ArcGIS_REST}),ARCGIS_WORLD_STREET_MAP:new longdo.Layer("World_Street_Map",{type:longdo.LayerType.ArcGIS_REST}),ARCGIS_WORLD_TOPO_MAP:new longdo.Layer("World_Topo_Map",{type:longdo.LayerType.ArcGIS_REST}),ARCGIS_WORLD_DARK:new longdo.Layer("Canvas/World_Dark_Gray_Base",{type:longdo.LayerType.ArcGIS_REST}),ARCGIS_WORLD_LIGHT:new longdo.Layer("Canvas/World_Light_Gray_Base",{type:longdo.LayerType.ArcGIS_REST}),BLANK:new longdo.Layer("blank",{type:longdo.LayerType.Custom,url:function(){return LAYER_BLANK}}),CLEAR:new longdo.Layer("clear",{type:longdo.LayerType.Custom,url:function(){return LAYER_CLEAR}}),CHECKERED:new longdo.Layer("checkered",{type:longdo.LayerType.Custom,url:function(e,n){return n.u%2^n.v%2?LAYER_BLANK:LAYER_CLEAR}}),POI_TRANSPARENT:new longdo.Layer("iconstransp",{url:server.coreLayer,zoomRange:SATELLITE_RANGE}),POI_TRANSPARENT_EN:new longdo.Layer("iconstransp-en",{url:server.coreLayer,zoomRange:SATELLITE_RANGE}),TRAFFIC:new longdo.Layer("trafficoverlay",{url:server.traffic,zoomRange:TRAFFIC_RANGE,refresh:TRAFFIC_REFRESH}),ARCGIS_WORLD_DARK_REF:new longdo.Layer("Canvas/World_Dark_Gray_Reference",{type:longdo.LayerType.ArcGIS_REST}),ARCGIS_WORLD_LIGHT_REF:new longdo.Layer("Canvas/World_Light_Gray_Reference",{type:longdo.LayerType.ArcGIS_REST}),ARCGIS_WORLD_PLACE:new longdo.Layer("Reference/World_Boundaries_and_Places",{type:longdo.LayerType.ArcGIS_REST}),ARCGIS_WORLD_TRANSPORTATION:new longdo.Layer("Reference/World_Transportation",{type:longdo.LayerType.ArcGIS_REST}),GOOGLE_ROADMAP:new longdo.Layer("ext.google.ROADMAP"),GOOGLE_TRAFFIC:new longdo.Layer("ext.google.ROADMAP.traffic"),GOOGLE_SATELLITE:new longdo.Layer("ext.google.SATELLITE"),GOOGLE_HYBRID:new longdo.Layer("ext.google.HYBRID"),MAPBOX_STREETS:new longdo.Layer("ext.mapbox.streets-v11"),MAPBOX_SATELLITE:new longdo.Layer("ext.mapbox.satellite-v9"),MAPBOX_HYBRID:new longdo.Layer("ext.mapbox.satellite-streets-v11"),MAPBOX_LONGDO_OSM:new longdo.Layer("ext.mapbox.longdo-osm-bright"),MAPBOX_LONGDO_TRAFFIC:new longdo.Layer("ext.mapbox.longdo-klokantech-basic.traffic"),byName:function(e){for(var n in this){var t=this[n];if(t.name&&t.name()==e)return t}return null}},longdo.Projections={EPSG3857:{srs:"EPSG:3857",minLon:-180,maxLat:180,size:360,minX:-20037508.342789,maxY:20037508.342789,normSize:40075016.685578,maxZoom:20,maxResolution:1<<20,maxPointX:1<<20<<TILEEXP,maxPointY:1<<20<<TILEEXP,ratio:1,pointPerDegree:(1<<20<<TILEEXP)/360,normToLat:function(e){return 360*(Math.atan(Math.exp(e*RAD))-PIq)/Math.PI},latToNorm:function(e){return Math.log(Math.tan(Math.PI*(.25+e/360)))/RAD},longdoName:"epsg3857"},EPSG4326:{srs:"EPSG:4326",minLon:-180,maxLat:90,size:360,minX:-180,maxY:90,normSize:360,maxZoom:20,maxResolution:1<<20,maxPointX:1<<20<<TILEEXP,maxPointY:1<<19<<TILEEXP,ratio:.5,pointPerDegree:(1<<20<<TILEEXP)/360,normToLat:function(e){return e},latToNorm:function(e){return e},longdoName:"epsg4326"},getBound:function(e){return{minLon:e.minLon,minLat:e.normToLat(e.maxLat-e.size*e.ratio),maxLon:e.minLon+e.size,maxLat:e.normToLat(e.maxLat)}}},longdo.Filter={Dark:"DARK",Light:"LIGHT",None:!1},longdo.LayerCollection=function(e){var n=[],t={},o={};function a(n,t){if(n.refresh&&(n.timer=setInterval(e.repaint,n.refresh,n)),n.bound){var o=$.locationToPoint(e.projection(),{lon:n.bound.minLon,lat:n.bound.maxLat}),a=$.locationToPoint(e.projection(),{lon:n.bound.maxLon,lat:n.bound.minLat});n.tile={minU:o.x>>TILEEXP,minV:o.y>>TILEEXP,maxU:a.x>>TILEEXP,maxV:a.y>>TILEEXP}}e.repaint("M"),t||e.Event.fire("layerChange",n)}function i(){t.placeholder||(l(),t.pan=function(e){t.map.panTo(new google.maps.LatLng(e.lat,e.lon))},t.location=function(){var n=e.location();t.map.setCenter(new google.maps.LatLng(n.lat,n.lon))},t.zoom=function(){var n=e.zoom();t.placeholder.style.display=n>19?"none":"block",t.map.setZoom(n),t.location()},t.resize=function(){google.maps.event.trigger(t.map,"resize")});var n=e.location();t.map=new google.maps.Map(t.placeholder,{zoom:e.zoom(),center:new google.maps.LatLng(n.lat,n.lon),mapTypeId:google.maps.MapTypeId[t.name[2]],disableDefaultUI:!0,disableDoubleClickZoom:!0,draggable:!1,keyboardShortcuts:!1,scrollwheel:!1}),"traffic"==t.name[3]&&(new google.maps.TrafficLayer).setMap(t.map),$.addClass(e.Ui.BottomLeft,"ldmap_external_bottom_left"),$.addClass(e.Ui.BottomRight,"ldmap_external_bottom_right"),e.Event.bind("locationAnimationBegin",t.pan).bind("location",t.location).bind("zoom",t.zoom).bind("pinch",t.zoom).bind("resize",t.resize).fire("layerChange",t.map)}function r(){t.placeholder||(l(),t.pan=function(e){t.map.easeTo({center:[e.lon,e.lat],duration:ANIMATION_INTERVAL,easing:function(e){return e}})},t.location=function(){var n=e.location();t.map.setCenter([n.lon,n.lat])},t.zoom=function(n){var o=$.pointToLocation(e.projection(),e.screenToPoint(n));t.map.easeTo({around:[o.lon,o.lat],zoom:e.zoom()-1,duration:ANIMATION_INTERVAL,easing:function(e){return e}})},t.rotate=function(){t.map.setBearing(-e.rotate())},t.pitch=function(){t.map.setPitch(e.pitch())},t.resize=function(){t.map.resize()});var n=e.location();mapboxgl.accessToken=o.mapboxKey,t.map=new mapboxgl.Map({container:t.placeholder,style:o.mapboxStyle||(t.name[2].indexOf("longdo-")?"mapbox://styles/mapbox/"+t.name[2]:server.vector+"/styles/"+t.name[2].substring(7)+"/style.json"),interactive:!1,center:[n.lon,n.lat],zoom:e.zoom()-1,bearing:-e.rotate(),pitch:e.pitch()}).once("load",(function(){"traffic"==t.name[3]&&("https://traffic.longdo.com/api/tiles/style.json","line",$.getJson("https://traffic.longdo.com/api/tiles/style.json",(function(e){for(var n in e.sources)t.map.addSource(n,e.sources[n]);for(var o,a=t.map.getStyle().layers,i=a.length-1;(r=a[i])&&"line"!=r.type;--i)o=r.id;var r;for(i=0;r=e.layers[i];++i)t.map.addLayer(r,o)}))),e.Event.fire("layerChange",t.map)})),$.addClass(e.Ui.BottomLeft,"ldmap_external_bottom_left"),$.addClass(e.Ui.BottomRight,"ldmap_external_bottom_right"),e.Event.bind("locationAnimationBegin",t.pan).bind("location",t.location).bind("zoom",t.zoom).bind("pinch",t.zoom).bind("rotate",t.rotate).bind("pitch",t.pitch).bind("resize",t.resize)}function l(){t.placeholder=$.append(e.placeholder(),"div",{className:"ldmap_externalmap"})}this.setBase=function(l){if(!(l instanceof longdo.Layer))throw"Not layer";t.map&&($.empty(t.placeholder),t.map=null,t.name=null,$.removeClass(e.Ui.BottomLeft,"ldmap_external_bottom"),$.removeClass(e.Ui.BottomRight,"ldmap_external_bottom"),e.Event.unbind("locationAnimationBegin",t.pan).unbind("location",t.location).unbind("zoom",t.zoom).unbind("rotate",t.rotate).unbind("resize",t.resize));var s=l.name();if(!s.indexOf("ext.")){!function(n){t.name=n.split(".");var a="externalmap"+e.id();if(t.placeholder)longdo.callback[a]();else switch(t.name[1]){case"google":longdo.callback[a]=i,window.google&&google.maps&&google.maps.version[0]>="3"?i():$.loadScript(server.mapg+"?language="+e.language()+"&callback=longdo.callback."+a+(o.googleQuery?"&"+o.googleQuery:""));break;case"mapbox":longdo.callback[a]=r,window.mapboxgl?r():($.loadStyle(server.mapb+"/mapbox-gl-js/v1.0.0/mapbox-gl.css"),$.loadScript(server.mapb+"/mapbox-gl-js/v1.0.0/mapbox-gl.js",r));break;default:throw"Unsupport map provider"}}(s),l=longdo.Layers.CLEAR;var d=!0}return n[0]=l,a(l,d),this},this.add=function(e){if(!(e instanceof longdo.Layer))throw"Not layer";if(!e.name().indexOf("ext."))throw"External map must be base layer, user setBase instead";for(var t=n.length,o=t-1;o;--o){var i=n[o];if(e==i)return this;e.weight>i.weight&&(t=o)}return n.splice(t,0,e),a(e),this},this.insert=function(e,t){if(e<=0)throw"Invalid index";if(!(t instanceof longdo.Layer))throw"Not layer";if(!t.name().indexOf("ext."))throw"External map must be base layer, user setBase instead";return n.indexOf(t)>0||(n.splice(e,0,t),a(t)),this},this.remove=function(t){if(!(t instanceof longdo.Layer))return this;var o=n.indexOf(t);return o>0&&(t.timer&&(clearInterval(t.timer),delete t.timer),n.splice(o,1),e.repaint("M").Event.fire("layerChange",t)),this},this.clear=function(){if(1==n.length)return this;for(var t,o=1;t=n[o];++o)t.timer&&(clearInterval(t.timer),delete t.timer);return n=[n[0]],e.repaint("M").Event.fire("layerChange"),this},this.list=function(){return n},this.size=function(){return n.length},this.contains=function(e){return n.indexOf(e)>=0},this.externalMap=function(){if(t.name){var e=t.name.slice();return e[0]=t.map,e}},this.externalOptions=function(e){return null==e?o:(o=e,this)},n=[longdo.Layers[defaultMap]]};var GEOMETRY_LINEWIDTH=4,GEOMETRY_LINEALPHA=.8,GEOMETRY_FILLALPHA=.4,STOCK_COLOR=["255,0,255","0,255,255","255,0,0","0,255,0","0,0,255","255,102,187","136,0,255","68,255,187","0,136,255","255,136,0","136,68,17","119,136,153"],nextColor=0;longdo.LineStyle={Solid:"SOLID",Dashed:"DASHED",Dot:"DOT"};var geometryTheme={editableRange:{min:7,max:99},editNodeColor:"rgba(63, 63, 63, 1)",editNodeSize:12,addNodeColor:"rgba(63, 63, 63, 0.5)",addNodeSize:12,translateNodeColor:"rgba(0, 0, 255, 1)",translateNodeSize:12,rotateNodeColor:"rgba(255, 255, 0, 0.5)",rotateNodeSize:32,guideOptions:{lineColor:"rgba(0, 0, 0, 0.2)",fillColor:!1},pointerColor:"rgba(63, 63, 63, 0.5)",pointerSize:12,labelCharSize:{width:2.7,height:6.5}};longdo.MapTheme.geometry=geometryTheme;var editGuide=null;longdo.Polyline=function(e,n){var t=null,o=null,a=null,i=null,r=null,l=!1,s=null,d=null;function u(e,n,t,o){var a=new longdo.Dot(n,{lineColor:geometryTheme.editNodeColor,lineWidth:geometryTheme.editNodeSize,popup:{loadDetail:function(n){$.append(n,"span",{className:"ldmap_link",innerHTML:"Remove",onclick:function(){e.removeNode(o,a)}})}},draggable:!0,weight:-1});return p(e,a,t)}function c(e,n,t){var o=new longdo.Dot(n,{lineColor:geometryTheme.addNodeColor,lineWidth:geometryTheme.addNodeSize,draggable:!0,weight:-1});return o.half=!0,p(e,o,t)}function p(e,n,t){return n.type="n",n.index=t,n.geometry=e,n}function f(e,n){switch(e){case longdo.LineStyle.Dashed:return[2*n,3*n];case longdo.LineStyle.Dot:return[1,2*n];default:return e instanceof Array?e:null}}function g(e,n,t,o,a){var i=$.subLocation(e[o],e[t]),r=Math.atan2(i.lat,i.lon),l=$.rotateGeom([{lon:-180,lat:n.lat},{lon:180,lat:n.lat}],n,r),s=m.closestPointOnLine(e[o].lon,e[o].lat,l[0].lon,l[0].lat,l[1].lon,l[1].lat);e[o]=$.makeLocation(s),l=$.rotateGeom(l,n,PIh),s=m.closestPointOnLine(e[a].lon,e[a].lat,l[0].lon,l[0].lat,l[1].lon,l[1].lat),e[a]=$.makeLocation(s),e[t]=n}if(this.popup=function(){return!0===t&&((t=new longdo.Popup(this.pivot(),n.popup,!0)).marker=this),t},this.peekPopup=function(){return t&&!0!==t},this.pivot=function(e){return o&&!e||(o="function"==typeof n.pivot?n.pivot(this.location()):n.pivot),o},this.linkEditing=function(e){return this.collection&&this.collection.linkEditing(this,e),this},this.node=function(e){if(a)return a;var n=this.location(),t=e.projection(),o=this.pivot(!0);if(this instanceof longdo.Circle)(a=[u(this,{lon:o.lon+n[1],lat:o.lat},0,t),u(this,{lon:o.lon-n[1],lat:o.lat},0,t)])[0].radius=!0,a[1].radius=!0;else{if(this instanceof longdo.Rectangle)(a=[u(this,n[0],0,t),u(this,n[2],0,t)])[0].topLeft=!0,a[1].bottomRight=!0;else{a=[],s=[];for(var l,d=0,m=n[0];l=m,m=n[d+1];++d)!0===m?(m=n[1+ ++d])&&(s.push(d),a.push(!0),a.push(!0),a.push(!0),a.push(!0)):(a.push(u(this,l,d,t)),a.push(c(this,$.averageLocation(t,l,m),d)));this instanceof longdo.Polyline||this instanceof longdo.Polycurve?a.push(u(this,l,d,t)):(s.unshift(-1),s.push(n.length))}this.rotatable&&(r=function(e,n){var t=new longdo.Dot(n,{title:"Rotate",lineColor:geometryTheme.rotateNodeColor,lineWidth:geometryTheme.rotateNodeSize,draggable:!0,weight:-1});return t.shaft=!0,p(e,t,0)}(this,o))}return this.translatable&&(i=function(e,n){var t=new longdo.Dot(n,{title:"Move",lineColor:geometryTheme.translateNodeColor,lineWidth:geometryTheme.translateNodeSize,draggable:!0,weight:-1});return t.center=!0,p(e,t,0)}(this,o)),a},this.showNode=function(e){if(l)return this;l=!0,this.node(e);var n=e.pause();e.pause(!0);for(var t,o=0;t=a[o];++o)!0!==t&&this.collection.add(t);return i&&this.collection.add(i),r&&this.collection.add(r),e.pause(n).repaint("G"),this},this.hideNode=function(e){if(!l)return this;if(l=!1,a&&this.collection){var n=e.pause();e.pause(!0);for(var t=0;t<a.length;++t)this.collection.remove(a[t]);this.collection.remove(i).remove(r),e.pause(n).repaint("G")}return this},this.updateNode=function(e,n,t){var o=this.location(),l=n.location(),d=n.index<<1;if(n.half){var p=u(this,l,n.index+1,e),f=n.index+1,v=c(this,$.averageLocation(e,l,o[f]),f);n.move($.averageLocation(e,l,o[n.index]));for(var h,y=d+2;h=a[y];++y)!0!==h&&++h.index;if(a.splice(d+2,0,p,v),o.splice(n.index+1,0,l),this instanceof longdo.Polygon){y=s.length-1;for(var T=f;s[y]>=T;--y)++s[y]}}else if(n.radius){var b=o[0];o[1]=m.distance(l.lon-b.lon,l.lat-b.lat),a[0].move({lon:b.lon+o[1],lat:b.lat}),a[1].move({lon:b.lon-o[1],lat:b.lat})}else if(n.topLeft)g(o,l,0,3,1),o[4]=l;else if(n.bottomRight)g(o,l,2,1,3);else if(n.center){var L=$.subLocation(l,this instanceof longdo.Circle?o[0]:this.pivot());o=$.translateGeom(o,L)}else if(n.shaft){var E=this.pivot(),_=$.subLocation(l,E);o=$.rotateGeom(o,E,Math.atan2(_.lat,_.lon)-PIh)}else{o[n.index]=l;var x=n.index-1,O=o[x],I=o[n.index+1];(this instanceof longdo.Polygon&&!O||!0===O)&&(x=s[s.indexOf(x)+1]-1,o[x--]=l,O=o[x]),O&&a[1+(x<<1)].move($.averageLocation(e,O,l)),I&&a[d+1].move($.averageLocation(e,l,I))}if(n.center||n.shaft?(this.hideNode(map),a=null):(i&&i.move(this.pivot(!0)),r&&r.move(this.pivot())),this.collection.move(this,o,"m"),t){if(n.half){if(delete n.link,delete t.half1.link,this.collection.linkNode(p,t.node),$.sameLocation(n.location(),t.half1.location()))var w=t.half1,M=t.half2;else w=t.half2,M=t.half1;this.collection.linkNode(n,w).linkNode(v,M)}}else if(n.link){var C,A=n.link;for(y=0;C=A[y];++y)C!=n&&C.geometry.updateNode(e,C.move(l),!n.half||{node:p,half1:n,half2:v})}return this},this.removeNode=function(e,n,t){var o=this.location(),i=this instanceof longdo.Polyline;if(o.length<=(i?2:4)||this instanceof longdo.Rectangle)this.collection.remove(this);else{var r,l=n.index<<1,d=n.index-1,u=o[d],c=o[n.index+1];if(i)u&&c&&(m=a[l-1]).move($.averageLocation(e,u,c));else{var m;u&&!0!==u||(d=s[s.indexOf(d)+1]-1,o[d--]=c,u=o[d]),(m=a[1+(d<<1)]).move($.averageLocation(e,u,c));for(var p=s.length-1,f=n.index+1;s[p]>=f;--p)--s[p]}for(p=l+1;r=a[p];++p)!0!==r&&--r.index;this.collection.remove(n),c?(this.collection.remove(a[l+1]),a.splice(l,2)):(this.collection.remove(a[l-1]),a.splice(l-1,2)),o.splice(n.index,1),this.collection.move(this,o,"m"),this.event.fire("beforeOverlayDrop",n),this.event.fire("overlayDrop",n)}if(t)m&&t.location&&($.sameLocation(m.location(),t.location())?this.collection.linkNode(m,t):(delete m.link,delete t.link));else if(n.link){var g;for(p=0;g=n.link[p];++p)g!=n&&g.geometry.removeNode(e,g,m||!0)}return this},this.showGuide=function(e){var n=this.location(),t=e.location();if(e.half)editGuide?n[e.index+1]=t:n.splice(e.index+1,0,t);else if(e.radius){var o=n[0];n[1]=m.distance(t.lon-o.lon,t.lat-o.lat),a[0].move({lon:o.lon+n[1],lat:o.lat}),a[1].move({lon:o.lon-n[1],lat:o.lat})}else if(e.topLeft)g(n,t,0,3,1),n[4]=t;else if(e.bottomRight)g(n,t,2,1,3);else if(e.center){var i=$.subLocation(t,this.pivot());n=$.translateGeom(n,i)}else if(e.shaft){var r=this.pivot(),l=$.subLocation(t,r);n=$.rotateGeom(n,r,Math.atan2(l.lat,l.lon)-PIh)}else if(n[e.index]=t,this instanceof longdo.Polygon){var s=n[e.index-1];if(!s||!0===s){var d=n.indexOf(!0,e.index);n[(d>0?d:n.length)-1]=t}}if(editGuide)editGuide.move(n);else{var u=longdo.Polygon;this instanceof longdo.Polyline||this instanceof longdo.Polycurve?u=longdo.Polyline:this instanceof longdo.Circle&&(u=longdo.Circle),editGuide=new u(n,geometryTheme.guideOptions),this.collection.add(editGuide)}return this},this.saveGuide=function(e){return this.hideNode(e),a=null,this.collection.move(this,editGuide.location(),"m"),this.collection.remove(editGuide),editGuide=null,this},this.showPointer=function(e,n){for(var t,o=this.location(),a=this.totalWidth<<n.z,i=1,r=$.locationToPoint(e,o[0]);t=r,r=o[i];++i){r=$.locationToPoint(e,r);var l=m.closestPointOnLine(n.x,n.y,t.x,t.y,r.x,r.y);if($.isAbsInRange(n.x-l.x,a)&&$.isAbsInRange(n.y-l.y,a)){var s=$.pointToLocation(e,l);d?this.collection.move(d,s):((d=new longdo.Dot(s,{lineColor:geometryTheme.pointerColor,lineWidth:geometryTheme.pointerSize,draggable:!0,weight:-1})).type="d",d.geometry=this,this.collection.add(d));break}}return this},this.hidePointer=function(){return d&&this.collection&&(this.collection.remove(d),d=null),this},this.update=function(e){var n=null;if(e.lineWidth&&(this.lineWidth=e.lineWidth,n="G"),e.lineColor&&(this.lineColor=e.lineColor,n="G"),e.fillColor&&(this.fillColor=e.fillColor,n="G"),e.lineStyle&&(this.lineStyle=f(e.lineStyle,this.lineWidth),n="G"),e.borderWidth&&(this.totalWidth=this.lineWidth+e.borderWidth,n="G"),e.borderColor&&(this.borderColor=e.borderColor,n="G"),e.label&&this.label){this.label.element().firstChild.innerHTML=e.label;var t=this.label.offset(),o=$.labelOptions(e.label,{},{}).icon.offset;t.x=o.x,t.y>0&&(t.y=o.y),n="G"==n?"C":"E"}return this.collection&&n&&(this.collection.paintNow=!0,this.collection.repaint(n),delete this.collection.paintNow),this},this.locationChange=function(e){return e||(a=null),this.label&&(this.defaultLabel&&(this.label.element().firstChild.innerHTML=this.size()),this.label.move(this.pivot(!0))),this},this.shift=function(e){return this.move($.translateGeom(this.location(),e))},this.rotate=function(e){return this.move($.rotateGeom(this.location(),this.pivot(),e*RAD))},this.size=function(){return(this instanceof longdo.Polygon?$.area:this instanceof longdo.Circle?$.areaCircle:$.distance)(this.location(),this.defaultLabel)},this.distance=function(n){for(var t,o,a,i=n.lon?n:n.location(),r=1<<30,l=1,s=e[0];a=s,s=e[l];++l)t=m.closestPointOnLine(i.lon,i.lat,s.lon,s.lat,a.lon,a.lat),(o=$.distance([i,$.makeLocation(t)]))<r&&(r=o);return r==1<<30?null:r},e.length<2&&(e=[e[0],e[0]]),(n=n||{}).pivot=n.pivot||$.polylinePivot,this.lineWidth=parseInt(n.lineWidth)||GEOMETRY_LINEWIDTH,this.lineColor=void 0===n.lineColor?"rgba("+STOCK_COLOR[nextColor]+","+GEOMETRY_LINEALPHA+")":n.lineColor,this.fillColor=void 0===n.fillColor?"rgba("+STOCK_COLOR[nextColor]+","+GEOMETRY_FILLALPHA+")":n.fillColor,void 0!==n.lineColor&&(this instanceof longdo.Dot||void 0!==n.fillColor)||(nextColor=(nextColor+1)%STOCK_COLOR.length),n.lineStyle&&(this.lineStyle=f(n.lineStyle,this.lineWidth)),n.linePattern&&(this.linePattern=n.linePattern),this.totalWidth=this.lineWidth+(n.borderWidth<<1),n.borderColor&&this instanceof longdo.Polyline&&(this.borderColor=n.borderColor),n.title&&(this.title=n.title.replace(TAG_REGEX,"")),n.popup||n.detail?(this.clickable=!0,t=!0,n.popup?n.popup.visibleRange=n.visibleRange:n.popup=n):n.clickable&&(this.clickable=!0),n.editable){var v=!0===n.editable?geometryTheme.editableRange:n.editable;this.editable=n.visibleRange?{min:Math.max(v.min,n.visibleRange.min),max:Math.min(v.max,n.visibleRange.max)}:v,n.draggable&&(this.translatable=!0),n.rotatable&&(this.rotatable=!0)}if(n.pointer&&this instanceof longdo.Polyline&&(this.pointer=!0),n.weight&&(this.weight=n.weight),LongdoOverlay.call(this,e,null,null,n.visibleRange),n.label){var h=n.label;!0===h&&(this.defaultLabel="th",h=this.size()),this.label=new longdo.Marker(this.pivot(),$.labelOptions(h,n.labelOptions||{visibleRange:n.visibleRange},n)),this.label.geometry=this}},longdo.Polyline.prototype=Object.create(LongdoOverlay.prototype),longdo.Polygon=function(e,n){this.contains=function(e){var n=e.lon?e:e.location();return $.contains(n,this.location())},this.union=function(e,n){return m.booleanOperation(this,e,!1,!1,n)},this.intersection=function(e,n){return m.booleanOperation(this,e,!0,!0,n)},this.difference=function(e,n){return m.booleanOperation(this,e,!1,!0,n)},this.split=function(e,n){if(e instanceof longdo.Polyline){for(var t=this.location(),o=null,a=4;a<t.length;++a)if(!0===t[a]){o=t.slice(a,t.length),t=t.slice(0,a);break}for(var i,r=e.location(),l=null,s=null,d=(a=1,t[0]);i=d,d=t[a];++a)for(var u,c=1,p=r[0];u=p,p=r[c];++c){var f=m.lineIntersectPoint(d.lon,d.lat,i.lon,i.lat,p.lon,p.lat,u.lon,u.lat);if(f&&f.a>1e-6&&f.a<.999999&&f.b>1e-6&&f.b<.999999){if(s)return null;if(f.index=a,f.split=c,l){var g=t.slice(0,l.index);g.push($.makeLocation(l));var v=t.slice(l.index,f.index);v.unshift($.makeLocation(l)),v.push($.makeLocation(f));var h=t.slice(f.index);if(h.unshift($.makeLocation(f)),l.split<f.split){var y=r.slice(l.split,f.split);(T=r.slice(l.split,f.split)).reverse()}else{(y=r.slice(f.split,l.split)).reverse();var T=r.slice(f.split,l.split)}o&&(h=h.concat(o)),s=[new longdo.Polygon(g.concat(y).concat(h),n),new longdo.Polygon(v.concat(T),n)]}l=f}}return s}return[this.difference(e,n),this.intersection(e,n)]};for(var t,o=1,a=0,i=e[a];t=e[o],o<=e.length;++o)if(null===t&&(e[o]=!0),!t||!0===t){if($.sameLocation(e[o-1],i)||e.splice(o++,0,$.copyLocation(i)),o-a<4)throw"Not enough vertices";i=e[a=++o]}(n=n||{}).pivot=n.pivot||$.polygonPivot,longdo.Polyline.call(this,e,n)},longdo.Polygon.prototype=Object.create(LongdoOverlay.prototype),longdo.Circle=function(e,n,t){this.contains=function(e){var n=this.location(),t=e.lon?e:e.location();return m.distance(t.lon-n[0].lon,t.lat-n[0].lat)<n[1]},e.length&&(t=n,n=e[1]||t.radius||1,e=e[0]),(t=t||{}).pivot=t.pivot||function(e){return e[0]};var o=[e,n];longdo.Polyline.call(this,o,t)},longdo.Circle.prototype=Object.create(LongdoOverlay.prototype),longdo.Polycurve=function(e,n){(n=n||{}).pivot=n.pivot||$.polylinePivot,longdo.Polyline.call(this,e,n)},longdo.Polycurve.prototype=Object.create(LongdoOverlay.prototype),longdo.Dot=function(e,n){(n=n||{}).pivot=n.pivot||function(e){return e},n.draggable&&(this.clickable=!0,this.draggable=!0),e.length&&(e=e[0]),longdo.Polyline.call(this,e,n)},longdo.Dot.prototype=Object.create(LongdoOverlay.prototype),longdo.Rectangle=function(e,n,t){if(this.divide=function(e,n,t){var o=this.location();if(m.distance(o[1],o[0])<m.distance(o[3],o[0])^!1===n)var a=3,i=1;else a=1,i=3;for(var r=$.subLocation(o[a],o[0]),l=$.subLocation(o[i],o[0]),s=Math.atan2(r.lat,r.lon),d=m.distance(r.lon,r.lat)/e,u={lon:Math.cos(s)*d,lat:Math.sin(s)*d},c=[],p=$.copyLocation(o[0]);e--;p=f){var f=$.addLocation(p,u);c.push(new longdo.Rectangle([p,f,$.addLocation(f,l),$.addLocation(p,l)],t))}return c},e.length){var o=e;t=n}else e.minLon?(o=[{lon:e.minLon,lat:e.minLat},{lon:e.maxLon,lat:e.minLat},{lon:e.maxLon,lat:e.maxLat},{lon:e.minLon,lat:e.maxLat}],t=n):(n.width&&(n={lon:e.lon+n.width,lat:e.lat-n.height}),o=[e,{lon:n.lon,lat:e.lat},n,{lon:e.lon,lat:n.lat}]);(t=t||{}).texture&&(this.texture=new Image,this.texture.src=t.texture,this.textureAlpha=t.textureAlpha,void 0===t.lineColor&&(t.lineColor=!1),void 0===t.fillColor&&(t.fillColor=!1)),longdo.Polygon.call(this,o,t)},longdo.Rectangle.prototype=Object.create(longdo.Polygon.prototype);var MARKER_ICON={url:$.getFile("pin.svg"),offset:{x:15,y:42}},POPUP_OFFSET=25,POPUP_WIDTH_MIN=120,POPUP_WIDTH_MAX=320,POPUP_CLOSE=$.getImage("close"),POPUP_CALLOUT=$.getImage("callout"),TAG_REGEX=/(<[^>]+>)/gi,OVERLAY_RANGE={min:1,max:99},CAMERA_RANGE={motion:{min:13,max:99},city:{min:14,max:99},country:{min:10,max:99},highway:{min:9,max:99}},CAMERA_ICON_STILL={url:$.getFile("camera-still.png"),urlHD:$.getFile("camera-still-2x.png"),offset:{x:12,y:12}},CAMERA_ICON_MOTION={url:$.getFile("camera-motion.png"),urlHD:$.getFile("camera-motion-2x.png"),offset:{x:12,y:12}},CAMERA_SIZE={width:cap.marginOverflow?343:328,height:270},NOTICE_HEIGHT=28,EVENT_OFFSET={x:13,y:13},EVENT_REFRESH=180;function LongdoOverlay(e,n,t,o){var a=this,i="L"+ ++longdo.objectcount;this.location=function(){return e},this.element=function(){return n},this.offset=function(){return t},this.visibleRange=function(){return o},this.toString=function(){return i},this.setImageOffset=function(){var e=this.hd?2:1;t={x:n.width>>e,y:n.height>>e},n.offset=t},this.getElementOffset=function(){return{x:n.offsetWidth>>1,y:n.offsetHeight>>1}},this.setLocation=function(n){if((e=n).length)for(var t,o=0;t=e[o];++o)e[o]=$.sanitizeLocation(t);else e=$.sanitizeLocation(e)},this.active=function(){return!!this.collection},this.pop=function(e){return this.collection&&this.collection.pop(this,e),this},this.move=function(e,n){return this.collection?this.collection.move(this,e,n):(this.setLocation(e),this.locationChange&&this.locationChange()),this},this.initOverwrite=function(e){if(o.overwrite&&!n.overwrite){n.overwrite={};var i=function(i){var r=o.overwrite[i];if(r.html)throw"Unsupported parameter";var l=new Image;r.size&&(l.width=r.size.width<<a.hd,l.height=r.size.height<<a.hd),r.offset?l.offset=r.offset:r.size?l.offset={x:r.size.width>>1,y:r.size.height>>1}:l.onload=function(){var e=a.hd?2:1;t={x:l.width>>e,y:l.height>>e},l.offset=t},l.src=a.hd?r.urlHD:r.url,n.overwrite[e.maxZoom-i]=l};for(var r in o.overwrite)i(r)}return a},t&&(t={x:t.x,y:t.y}),n instanceof Image&&(t?n.offset=t:n.width&&this.setImageOffset()),o=o||OVERLAY_RANGE,this.setLocation(e)}(new Image).src=MARKER_ICON.url,(new Image).src=POPUP_CALLOUT,longdo.OverlayWeight={Top:1},longdo.ObjectLabel={Title:{}},longdo.Marker=function(e,n){var t=this,o=null;this.popup=function(){return!0===o&&((o=new longdo.Popup(this.location(),n.popup,!0)).marker=this),o},this.peekPopup=function(){return o&&!0!==o},this.destroyPopup=function(){return this.peekPopup()&&(o=!0),self},this.update=function(e){return void 0!==e.rotate&&(this.rotate=$.boundAngle(e.rotate)*RAD),this.collection&&this.collection.repaint(this.element()instanceof Image?"O":"E"),this};var a=null,i=(n=n||{}).icon||MARKER_ICON;i.html?((a=document.createElement("div")).className="ldmap_overlay ldmap_markerholder",n.title&&(a.title=n.title.replace(TAG_REGEX,"")),a.innerHTML=i.html,n.style&&(a.style=n.style)):(this.hd=!$.isHD()&&i.url||!i.urlHD?0:1,(a=new Image).onload=function(){i.size&&(a.width=i.size.width<<t.hd,a.height=i.size.height<<t.hd),void 0===a.offset&&t.setImageOffset(),t.loadAction?(t.collection[t.loadAction](t),delete t.loadAction):t.update({})},a.src=this.hd?i.urlHD:i.url,n.title&&(this.title=n.title.replace(TAG_REGEX,""))),void 0!==n.rotate&&(this.rotate=$.boundAngle(n.rotate)*RAD),(n.popup||n.detail||n.clickable||n.draggable)&&(this.clickable=!0,i.html&&(a.className+=" ldmap_clickable"),(n.popup||n.detail)&&(o=!0,n.popup?n.popup.visibleRange=n.visibleRange:n.popup=n),n.draggable&&(this.draggable=!0)),n.weight&&(this.weight=n.weight),LongdoOverlay.call(this,e,a,i.offset,n.visibleRange)},longdo.Marker.prototype=Object.create(LongdoOverlay.prototype),longdo.Popup=function(e,n){var t=null,o={hidden:!0,visible:!0};function a(e){for(var n=e.target;n&&!$.hasClass(n,"ldmap_popupholder");){if(n.scrollHeight>n.clientHeight&&!o[getComputedStyle(n).overflowY])return;n=n.parentNode}e.preventDefault()}this.title=function(e){return null==e?t?t.children[1]:null:(t&&(t.children[1].innerHTML=e),this)},this.detail=function(e){return null==e?t?t.lastChild:null:(t&&(t.lastChild.innerHTML=e,this.focus()),this)},this.fit=function(){var e=this.title();e.style.maxWidth="none",e.style.whiteSpace="nowrap";var n=this.detail();n.style.whiteSpace="nowrap";var t=Math.min(Math.max(n.offsetWidth,e.offsetWidth+POPUP_OFFSET,POPUP_WIDTH_MIN),POPUP_WIDTH_MAX);return e.style.maxWidth=t-22+"px",e.style.whiteSpace=null,n.style.minWidth=t-20+"px",n.style.whiteSpace=null,this.element().firstChild.style.minWidth=t+"px",this},this.focus=function(){return this.autoFocus=!0,this.collection&&this.collection.repaint("E"),this},n=n||{};var i=document.createElement("div");if(i.className="ldmap_overlay ldmap_popupholder",n.html||n.loadHtml)i.className+=" ldmap_selectable",i.innerHTML=n.html,n.loadHtml&&n.loadHtml(i);else{var r=n.detail||"",l=n.title||"";if(i.innerHTML='<div class="ldmap_popup ldmap_selectable">'+(!1===n.closable?"":'<img class="ldmap_popup_close" src="'+POPUP_CLOSE+'" alt="X" />')+'<div class="ldmap_popup_title"'+(l.indexOf("<")<0?' title="'+l+'"':"")+">"+l+'</div><div class="ldmap_popup_detail">'+r+'</div></div><img class="ldmap_popup_callout" src="'+POPUP_CALLOUT+'" alt="" />',"onwheel"in window?i.addEventListener("wheel",a):(i.addEventListener("mousewheel",a),i.addEventListener("DOMMouseScroll",a)),t=i.firstChild,!1!==n.closable&&(this.closeButton=t.firstChild),n.loadDetail&&(this.loadDetail=n.loadDetail),n.size){var s=n.size,d=t.style;s.width?(d.minWidth=d.maxWidth=s.width+"px",this.title().style.maxWidth=this.detail().style.width=s.width-20+"px"):(d.minWidth=s.minWidth+"px",d.maxWidth=s.maxWidth+"px",this.title().style.maxWidth=s.minWidth-20+"px"),d=this.detail().style,s.height?d.minHeight=d.maxHeight=s.height-POPUP_OFFSET+"px":(d.minHeight=s.minHeight-POPUP_OFFSET+"px",d.maxHeight=s.maxHeight-POPUP_OFFSET+"px")}else n.loadDetail||(this.autoFit=!0);n.autoFocus&&(this.autoFocus=!0)}this.weight=longdo.OverlayWeight.Top,LongdoOverlay.call(this,e,i,null,n.visibleRange)},longdo.Popup.prototype=Object.create(LongdoOverlay.prototype),longdo.Overlays={cameras:{id:"cameras",url:server.camera+"/feed/?command=json",overlayType:"O",popup:!0,motion:!0,createOverlays:function(e,n){this.items=e;for(var t,o=null,a=[],i=0;t=e[i];++i){var r=this.motion&&"Y"==t.motion,l={icon:r?CAMERA_ICON_MOTION:CAMERA_ICON_STILL,visibleRange:CAMERA_RANGE["Y"==t.incity?r?"motion":"city":t.camid.indexOf("DOHBHS")?"country":"highway"]};if(this.popup){var s=r&&t.hls_url,d=r&&cap.nomjpeg&&!t.hls_url,u='<a href="'+t.link+'" target="_blank"><video class="ldmap_overlay_camera" poster="'+(!r||cap.nomjpeg||t.hls_url?t.imgurl:t.vdourl)+(s?'" data-video="'+t.hls_url:"")+'" loop></video>'+(t.hls_url?'<img class="ldmap_overlay_camera_overlay" src="'+server.camera+"/feed/images/"+t.overlay_file+'">':"")+"</a>";d&&(u+='<span class="ldmap_overlay_info">Your browser is not supported. Please use Chrome or Firefox to view streaming cameras.</span>'),l.popup={title:t.title,size:d?{width:CAMERA_SIZE.width,height:CAMERA_SIZE.height+NOTICE_HEIGHT}:CAMERA_SIZE,detail:u},s&&(l.popup.loadDetail=this.playVideo)}else l.clickable="true";(o=new longdo.Marker({lon:t.longitude,lat:t.latitude},l)).type="c",o.index=i,o.data=t,r&&(o.motion=!cap.nomjpeg||"N/A"),a.push(o)}return this.pragmaOnce||(n.Event.bind("zoom",this.resumeVideo).bind("resize",this.resumeVideo).bind("loadTile",this.resumeVideo).bind("popupClose",this.stopVideo),this.pragmaOnce=!0),a},playVideo:function(e){var n=longdo.Overlays.cameras,t=e.firstChild.firstChild,o=t.getAttribute("data-video");t.canPlayType("application/vnd.apple.mpegurl")?(t.src=o,t.addEventListener("loadedmetadata",t.play)):window.Hls?Hls.isSupported()&&(n.hls=new Hls,n.hls.loadSource(o),n.hls.attachMedia(t),n.hls.on(Hls.Events.MANIFEST_PARSED,(function(){t.play()}))):$.loadScript("https://cdn.jsdelivr.net/npm/hls.js@latest",(function(){n.playVideo(e)}))},resumeVideo:function(e){"start"!=e&&setTimeout((function(){var e=document.getElementsByClassName("ldmap_overlay_camera")[0];e&&e.play()}),200)},stopVideo:function(e){var n=longdo.Overlays.cameras;e.marker&&"c"==e.marker.type&&n.hls&&(n.hls.stopLoad(),delete n.hls)}},events:{id:"events",url:server.event+"/feed/json",overlayType:"O",popup:!0,refresh:EVENT_REFRESH,createOverlays:function(e,n){var t="th"==n.language().substring(0,2);this.items=e;for(var o,a=null,i=[],r=0;o=e[r];++r){var l=server.event+"/sites/default/files/icons/"+o.icon,s={title:t||!o.title_en?o.title:o.title_en,icon:{url:l+".png",urlHD:l+"-2x.png",offset:EVENT_OFFSET},visibleRange:{min:o.showlevel,max:99}};this.popup?s.detail='<span class="ldmap_overlay_info">'+$.formatDateTimeRange(o.start,o.stop,"th")+" โดย "+o.contributor+'</span><div class="ldmap_overlay_description">'+(o.images?'<div class="ldmap_overlay_image"><a href="'+o.images[0]+'" target="_blank"><img src="'+o.images[0]+'/thumbnail" /></a></div>':"")+(t||!o.description_en?o.description:o.description_en)+"</div>":s.clickable="true",(a=new longdo.Marker({lon:o.longitude,lat:o.latitude},s)).type="e",a.index=r,a.data=o,i.push(a)}return i}},Object:function(e,n,t){var o=this,a="th";function i(e){var n=e.name_t?e.name_t:e.myid;return STOCK_COLOR[(n.charCodeAt()-n.length)%STOCK_COLOR.length]}function r(e,n,t){o.popup?n?(e.detail='<div id="'+o.id+"-"+t+'" class="ldmap_poi_load">Loading...</div>',e.loadDetail=function(){$.loadScript(server.poi+"/json/get?id="+t+"&locale="+a+"&key="+apikey+"&callback=longdo.callback."+o.id+"Detail")}):e.detail=t:e.clickable="true"}o.popup=!0,o.createOverlays=function(l,s){var d="th"==(a=s.language()).substring(0,2);o.items=l;for(var u=[],c=0;_=l[c];++c){var m=_.linearray;if(m)if("ooi_layer"==_.objecttype)for(var p,f=0;p=m[f];++f){var g=p.myid,v=(I={type:longdo.LayerType.TMS,url:server.usertile+"/"+g[0]+"/"+g[1]+g[2]+"/"+g[3]+g[4]+"/"+g[5]+g[6]+"/"+g[7]+g[8],zoomOffset:0,zoomRange:{min:7,max:99},bound:p.data},!1),h={};for(var y in t)"title"==y||"detail"==y||"loadDetail"==y||"html"==y||"loadHtml"==y||"size"==y||"autoFocus"==y?(v=!0,h[y]=t[y]):I[y]=t[y];(O=new longdo.Layer("",I)).type=n,O.index=e+","+c+","+f,O.data=p,u.push(O),v&&(!0===t.title&&(t.title=d?p.name_t:p.name_e),(O=new longdo.Popup({lon:p.centerlong,lat:p.centerlat},t)).type=n,O.index=e+","+c+","+f,O.data=p,u.push(O))}else{var T;for(f=0;T=m[f];++f){switch(T.mode){case"polygon":var b=longdo.Polygon;break;case"line":b=longdo.Polyline;break;default:continue}var L=d?T.name_t:T.name_e,E=(I={title:L,pivot:{lon:T.centerlong,lat:T.centerlat}},"LONGDO"==n&&void 0===t.detail);for(var y in r(I,E,E?T.myid:(d?T.desc_t:T.desc_e)||T.name_e),t)I[y]=t[y];I.label===longdo.ObjectLabel.Title&&(I.label=L),void 0===I.lineWidth&&T.linewidth&&(I.lineWidth=T.linewidth),void 0===I.lineColor&&(I.lineColor=T.linecolor?$.hexToRgba("#"+T.linecolor):"rgba("+i(T)+","+GEOMETRY_LINEALPHA+")"),void 0===I.fillColor&&(I.fillColor=T.fillcolor?$.hexToRgba("#"+T.fillcolor):"rgba("+i(T)+","+GEOMETRY_FILLALPHA+")"),void 0===I.borderWidth&&null==I.borderColor&&s.Ui.Mouse.isTouch()&&(I.borderWidth=8,I.borderColor="rgba(255, 255, 255, 0.01)"),void 0===I.pivot&&T.centerlong&&(I.pivot={lon:T.centerlong,lat:T.centerlat});for(var _=T.data[0],x=1;x<T.data.length;++x)_.push(!0),_=_.concat(T.data[x]);(O=new b(_,I)).type=n,O.index=e+","+c+","+f,O.data=T,u.push(O)}}else{var O,I={title:d?_.name:_.name_en},w="LONGDO"==n&&void 0===t.detail;for(var y in r(I,w,w?_.id:_.name_en),t)I[y]=t[y];t.icon?"big"==t.icon&&(I.icon={url:server.icon+"_2x/"+_.iconimagefile,urlHD:server.icon+"_4x/"+_.iconimagefile}):I.icon={url:server.icon+"/"+_.iconimagefile,urlHD:server.icon+"_2x/"+_.iconimagefile},(O=new longdo.Marker(_,I)).type=n,O.index=c,O.data=_,u.push(O)}}return"LONGDO"==n&&(longdo.callback[o.id+"Detail"]=function(e){var n=document.getElementById(o.id+"-"+e.meta.keyword);n&&(e.data.length?$.empty(n.parentNode).appendChild($.formatPoi(e.data[0],a,s.Ui.popup)):$.empty(n))}),u},t=t||{},o.id=n+ ++longdo.objectcount,o.url=server.object+"?id="+(e.join?e.join(";"):e)+"&dataset="+n+"&key="+apikey,t.simplify&&(o.url+="&simplify="+t.simplify),t.combine&&(o.url+="&combine="+t.combine),t.ignorefragment&&(o.url+="&ignorefragment="+t.ignorefragment),o.overlayType="LONGDO"!=n||"G"==e[0]||"M"==e[0]?t.label?"C":"G":"Y"==e[0]?"M":"O"}};var SPATIAL_DATA_MAX=16,CHANGE_DELAY=5,OVERLAY_PAINT_DELAY=120,DROP_SPEED=40,BOUNCE_HEIGHT=20;function SpatialDb(e){var n={x:e>>1,y:e>>1,data:{},size:0};function t(e,n,t,o,a){if(t<=a.x){if(o<=a.y)return a.nw;if(n>a.y)return a.sw}else if(e>a.x){if(o<=a.y)return a.ne;if(n>a.y)return a.se}return!1}function o(e,n,t,a,i,r,l,s,d){for(var u in d=d||e<=r.x-l+1&&n<=r.y-l+1&&t>=r.x+l&&a>=r.y+l,r.data){var c=r.data[u];!d&&(c.minX>t||c.minY>a||c.maxX<e||c.maxY<n)||void 0!==i&&(i<c.minZ||i>c.maxZ)||(c.value.weight?c.value.weight<0?s.over:s.top:s.normal).push(c)}r.nw&&(l>>=1,e<=r.x&&(n<=r.y&&o(e,n,t,a,i,r.nw,l,s,d),a>r.y&&o(e,n,t,a,i,r.sw,l,s,d)),t>r.x&&(n<=r.y&&o(e,n,t,a,i,r.ne,l,s,d),a>r.y&&o(e,n,t,a,i,r.se,l,s,d)))}this.add=function(o,a,i,r,l,s,d,u){for(var c=o>>TILEEXP,m=a>>TILEEXP,p=r>>TILEEXP,f=l>>TILEEXP,g=n,v=e>>1;v;v>>=1){if(!g.nw){if(g.data[d])return!1;if(g.size>=SPATIAL_DATA_MAX){var h=v>>1,y=h||1;g.nw={x:g.x-h,y:g.y-h,data:{},size:0},g.ne={x:g.x+y,y:g.y-h,data:{},size:0},g.sw={x:g.x-h,y:g.y+y,data:{},size:0},g.se={x:g.x+y,y:g.y+y,data:{},size:0};var T={};for(var b in g.data){var L=g.data[b];(E=t(L.minX,L.minY,L.maxX,L.maxY,g))?(E.data[L.value]=L,++E.size,--g.size):T[L.value]=L}g.data=T}}var E;if(!g.nw||!(E=t(c,m,p,f,g)))break;g=E}return g.data[d]={minX:c,minY:m,minZ:i,maxX:p,maxY:f,maxZ:s,value:d,extra:u,bound:{minX:o,minY:a,maxX:r,maxY:l}},++g.size,!0},this.remove=function(e,o,a,i,r){for(var l=n;l;){if(l.nw){var s=t(e,o,a,i,l);if(s){l=s;continue}}if(l.data[r])return delete l.data[r],--l.size,!0;break}return!1},this.get=function(t,a,i,r,l){var s={normal:[],top:[],over:[]};return o(t,a,i,r,l,n,e>>1,s),s}}longdo.OverlayCollection=function(e,n){var t=this,o=e.projection(),a=null,i=null,r=null,l=!0,s=!0,d=null,u=0,c=!1,p=null,f=null,g=null,v=null,h=[],y=[function(e,n){return n.extra.y-e.extra.y},function(e,n){return n.extra.x-e.extra.x||n.extra.y-e.extra.y},function(e,n){return e.extra.y-n.extra.y||n.extra.x-e.extra.x},function(e,n){return e.extra.x-n.extra.x||e.extra.y-n.extra.y}];function T(e){return f==e&&(e.offset().y=e.originalY,delete e.originalY,f=null),e}function b(n){n||e.Event.fire("connectionError","overlays")}function L(e){"n"==e.type&&e.active()&&e.geometry.showGuide(e)}t.hit=function(e,o,a){for(var i=e.x>>TILEEXP,r=e.y>>TILEEXP,l=n.getZoom(),s=Math.ceil((t.maxImageSize<<l)/TILESIZE),d=t.image(i-s,r-s,i+s,r+s,l,a),u=0;L=d[u];++u){var c=L.value,p=L.extra,f=c.element(),g=c.offset(),v=c.hd,h=p.x-(g.x<<l),y=p.y-(g.y<<l),T=h+(f.width>>v<<l),b=y+(f.height>>v<<l);if(e.x>=h&&e.x<T&&e.y>=y&&e.y<b)return c}var L,E=n.hitGeometry(o);if(!E)return null;for(E=E<<l>>TILEEXP>>1,d=t.geometry(i-E,r-E,i+E,r+E,l),u=0;L=d[u];++u){if(E=((c=L.value).totalWidth<<l)/2,c instanceof longdo.Circle||c instanceof longdo.Dot){var _=L.extra[0],x=L.extra[1];x||(x=0);var O=m.distance(e.x-_.x,e.y-_.y);if((c.fillColor||O<x-E)&&O>x+E)continue}else if(!(c instanceof longdo.Polygon&&c.fillColor&&m.isPointInPolygon(e,L.extra)||m.isPointOnPolyline(e,L.extra,E)))continue;return c}return null},t.element=function(e,n,t,o,i,r){var l=a.get(e,n,t,o,i);if(void 0!==r){var s=y[r];l.top.sort(s),l.normal.sort(s)}return l.top.concat(l.normal)},t.image=function(e,n,t,o,a,r){var l=i.get(e,n,t,o,a);if(void 0!==r){var s=y[r];l.top.sort(s),l.normal.sort(s)}return l.top.concat(l.normal)},t.geometry=function(e,n,t,o,a){var i=r.get(e,n,t,o,a);return i.over.concat(i.top).concat(i.normal)},t.add=function(c){if(!(c instanceof LongdoOverlay))throw"Not overlay";if(c instanceof longdo.Popup){if(e.Ui.popup)return e.Ui.popup.set(c,!0),t;s&&c.detail()&&(c.autoFocus=!0),l&&d&&d!=c&&t.remove(d),d=c,c.loadDetail&&(e.Event.fire("popupLoadDetail",c)&&setTimeout(c.loadDetail,OVERLAY_PAINT_DELAY,c.detail()),delete c.loadDetail)}var m=Math.min(o.maxZoom,o.maxZoom-c.visibleRange().min+1),p=Math.max(0,o.maxZoom-c.visibleRange().max);if(m<=p)return t;t.paintNow||h.push(c),c.collection=t,c.event=e.Event;var f=n.getZoom(),g=c.element();if(g)if(g instanceof Image){if(c.initOverwrite(o),!g.width)return c.loadAction="add",t;!function(e,n,a,r,l){var s=$.locationToPoint(o,e.location()),d=n.offset,c=Math.max(d.x,d.y,n.width-d.x,n.height-d.y);if(c>t.maxImageSize&&(t.maxImageSize=c),i.add(s.x,s.y,r,s.x,s.y,a-1,e,s)){if(l>=r&&l<a)for(var m=s.x-(d.x<<l),p=s.y-(d.y<<l),f=m+(n.width>>e.hd<<l),g=p+(n.height>>e.hd<<l),v=$.pointToTile({x:m,y:p,z:l}),h=$.pointToTile({x:f,y:g,z:l}),y=v.v;y<=h.v;++y)for(var T=v.u;T<=h.u;++T)t.repaint({u:T,v:y,w:l,mode:"O"});++u}}(c,g,m,p,f)}else{if(!(g instanceof Element))throw"Invalid overlay";!function(n,i,r,l,s){n.closeButton&&(n.closeButton.onclick=function(){t.remove(n),e.Event.fire("popupClose",n)});var d=$.locationToPoint(o,n.location());if(a.add(d.x,d.y,l,d.x,d.y,r-1,n,d)){if(s>=l&&s<r){var c=$.pointToTile({x:d.x,y:d.y,z:s});t.repaint({u:c.u,v:c.v,w:s,mode:"E"}),"ldmap_overlay ldmap_popupholder ldmap_selectable"==i.className&&e.repaint({u:c.u,v:c.v,w:s,mode:"F"})}++u}}(c,g,m,p,f)}else!function(n,a,i,l){var s=n.location(),d=n.totalWidth>>1;if(d>t.maxGeometrySize&&(t.maxGeometrySize=d),n instanceof longdo.Circle)var c=$.locationToPoint(o,s[0]),m=s[1]*o.pointPerDegree,p=c.x-m,f=c.y-m,g=c.x+m,v=c.y+m,h=[c,m];else{for(var y,T=$.locationToPoint(o,n instanceof longdo.Dot?s:s[0]),b=(g=p=T.x,v=f=T.y,h=[T],1);y=s[b];++b)!0===y?h.push(!0):(T=$.locationToPoint(o,y),h.push(T),T.x<p?p=T.x:T.x>g&&(g=T.x),T.y<f?f=T.y:T.y>v&&(v=T.y));n instanceof longdo.Dot||(n.bound={minX:p,minY:f,maxX:g,maxY:v})}r.add(p,f,i,g,v,a-1,n,h)&&(l>=i&&l<a&&(n.texture&&!n.texture.complete?n.texture.onload=function(){t.repaint("G")}:t.repaint("G")),++u,n.defaultLabel&&n.defaultLabel!=e.language()&&(n.defaultLabel=e.language(),n.label.element().firstChild.innerHTML=n.size()),n.label&&t.add(n.label))}(c,m,p,f);return t},t.remove=function(l){if(!(l instanceof LongdoOverlay))return t;l.peekPopup&&l.peekPopup()&&(e.Ui.popup?e.Ui.popup.set(l.popup(),!1):t.remove(l.popup())),l==d&&(d=null);var s=Math.min(o.maxZoom,o.maxZoom-l.visibleRange().min+1),c=Math.max(0,o.maxZoom-l.visibleRange().max);if(s<=c)return t;var m=n.getZoom(),p=l.element();if(p)if(p instanceof Image)t.paintNow||h.push(l),function(e,n,a,r,l){var s=$.locationToPoint(o,e.location()),d=s.x>>TILEEXP,c=s.y>>TILEEXP;if(i.remove(d,c,d,c,e)){if(l>=r&&l<a)for(var m=n.offset,p=s.x-(m.x<<l),f=s.y-(m.y<<l),g=p+(n.width>>e.hd<<l),v=f+(n.height>>e.hd<<l),h=$.pointToTile({x:p,y:f,z:l}),y=$.pointToTile({x:g,y:v,z:l}),T=h.v;T<=y.v;++T)for(var b=h.u;b<=y.u;++b)t.repaint({u:b,v:T,w:l,mode:"O"});--u}}(l,p,s,c,m);else{if(!(p instanceof Element))return t;!function(t,i,r,l,s){var d=$.locationToPoint(o,t.location()),c=d.x>>TILEEXP,m=d.y>>TILEEXP;if(a.remove(c,m,c,m,t)){if(s>=l&&s<r&&(n.removeElement(i,$.pointToTile({x:d.x,y:d.y,z:s})),t.marker&&(t.marker.geometry?t.marker.geometry.hideNode(e):t.marker.motion&&(i.firstChild.lastChild.firstChild.firstChild.src="#",t.marker.destroyPopup())),"ldmap_overlay ldmap_popupholder ldmap_selectable"==i.className)){var p=$.pointToTile({x:d.x,y:d.y,z:s});e.repaint({u:p.u,v:p.v,w:s,mode:"B"})}--u,setTimeout(e.Event.fire,CHANGE_DELAY,"overlayChange",t)}}(l,p,s,c,m)}else t.paintNow||h.push(l),function(n,a,i,l){var s=n.location();if(n instanceof longdo.Circle)var d=$.locationToPoint(o,s[0]),c=s[1]*o.pointPerDegree,m=d.x-c,p=d.y-c,f=d.x+c,g=d.y+c;else if(n instanceof longdo.Dot){var v=$.locationToPoint(o,s);f=m=v.x,g=p=v.y}else{if(!n.bound)return;var h=n.bound;m=h.minX,p=h.minY,f=h.maxX,g=h.maxY}r.remove(m>>TILEEXP,p>>TILEEXP,f>>TILEEXP,g>>TILEEXP,n)&&(l>=i&&l<a&&t.repaint("G"),--u,n.label&&t.remove(n.label),n.editable&&n.hideNode(e),n.pointer&&n.hidePointer())}(l,s,c,m);return delete l.collection,delete l.event,t},t.clear=function(){if(u)for(var n,l=t.list(),s=0;n=l[s];++s)delete n.collection,delete n.event;return a=new SpatialDb(o.maxResolution),i=new SpatialDb(o.maxResolution),r=new SpatialDb(o.maxResolution),t.maxImageSize=0,t.maxGeometrySize=0,u&&(u=0,e.repaint("C").Event.fire("overlayChange")),e.Ui&&e.Ui.popup&&e.Ui.popup.visible(!1),t},t.list=function(){if(!u)return[];for(var e=t.element(0,0,o.maxPointX,o.maxPointY).concat(t.image(0,0,o.maxPointX,o.maxPointY)).concat(t.geometry(0,0,o.maxPointX,o.maxPointY)),n=0;n<e.length;++n)e[n]=e[n].value;return e},t.size=function(){return u},t.move=function(n,o,a){if(!0===a||a>0&&n.location().lon)return T(n),!0===a?delete n.animationInterval:n.animationInterval=a,function(n,t){var o=$.now(),a=n.location(),i=t.lon-a.lon,r=t.lat-a.lat,l=n.animationInterval||ANIMATION_INTERVAL,s=e.Event.pause();e.Event.pause(!0),requestAnimationFrame((function d(){var u=Date.now()-o;if(u>l)return e.Event.pause(s),n.move(t),void delete n.animationInterval;requestAnimationFrame(d);var c=u/l;n.move({lon:a.lon+i*c,lat:a.lat+r*c})}))}(n,o),t;var i=e.Event.pause();e.Event.pause(!0),t.paintNow=!0;var r=u;return t.remove(n),r==u?(delete t.paintNow,e.Event.pause(i),t):(n.setLocation(o),n.peekPopup&&n.peekPopup()&&n.popup().setLocation(o.length?n.pivot():o),t.add(n),delete t.paintNow,e.Event.pause(i).fire("overlayMove",n),n.locationChange&&n.locationChange("m"==a),t)},t.load=function(n){var o=longdo.callback[n.id];return o&&o!=$.noop||(longdo.callback[n.id]=function(o){n.overlays&&t.unload(n),n.overlays=n.createOverlays(o,e);var a=e.pause();e.pause(a);for(var i,r=0;i=n.overlays[r];++r)i instanceof longdo.Layer?e.Layers.add(i):t.add(i);setTimeout((function(){e.pause(a).Event.fire("overlayLoad",o)}),OVERLAY_PAINT_DELAY),t.repaint(n.overlayType),n.refresh&&(n.timeout=setTimeout(t.load,1e3*n.refresh,n))}),$.loadScript(n.url+"&callback=longdo.callback."+n.id,b),t},t.unload=function(n){if(longdo.callback[n.id]=$.noop,!n.overlays)return t;var o=e.pause();if(e.pause(!0),"M"==n.overlayType)for(var a=0;a<n.overlays.length;++a)e.Layers.remove(n.overlays[a]);else for(clearTimeout(n.timeout),a=0;a<n.overlays.length;++a)e.Overlays.remove(n.overlays[a]);return e.pause(o).repaint(n.overlayType),delete n.items,delete n.overlays,t},t.pop=function(n,o,a){var i=n.popup();if(!i)return t;if(e.Ui.popup)return e.Ui.popup.set(i,o),t;var r=e.Event.pause();e.Event.pause(!0);var l=u;if(o)l=-1;else if(t.paintNow=!0,t.remove(i),e.Event.fire("overlayChange",i),delete t.paintNow,void 0!==o)return e.Event.pause(r),u<l&&e.Event.fire("overlayChange",i),t;return e.Event.pause(r),u<l?(e.Event.fire("overlayChange",i),t):(a&&i.setLocation(e.location(longdo.LocationMode.Pointer)),t.paintNow=!0,t.add(i),e.Event.fire("overlayChange",i),delete t.paintNow,t.floorPlan(n))},t.floorPlan=function(n){return c&&n.data&&n.data.id&&"A"==n.data.id[0]?(p=n.data.id,$.loadScript(server.longdo+"/webservice/json/getfloor?ooiid="+n.data.id+"&key="+apikey+"&callback=longdo.callback.floor"+e.id())):p=null,t},t.drop=function(n){if(n.dropTo)return t;T(n);var a=n.element();if(a instanceof Image&&!a.width)return n.collection=t,n.loadAction="drop",t;var i=(o.latToNorm(e.bound().maxLat)-o.latToNorm(n.location().lat))*o.pointPerDegree>>o.maxZoom-e.zoom();i=(i/DROP_SPEED|0)*DROP_SPEED;var r=n.offset();n.dropTo=r.y,r.y+=i;var l=e.Event.pause();return e.Event.pause(!0),t.paintNow=!0,t.add(n),requestAnimationFrame((function o(){if(t.remove(n),r.y-=DROP_SPEED,t.add(n),r.y<=n.dropTo)return delete n.dropTo,delete t.paintNow,void e.Event.pause(l);requestAnimationFrame(o)})),t},t.bounce=function(e){if(f)return t.remove(f).add(T(f)),setTimeout(t.bounce,100,e),t;if(!e)return t;var n=e.element();if(n instanceof Image&&!n.width)return e.collection=t,e.loadAction="bounce",t;f=e;var o=e.offset();e.originalY=o.y;var a=1,i=0;return requestAnimationFrame((function n(){e.originalY&&(t.remove(e),o.y+=a,t.add(e),++i>BOUNCE_HEIGHT&&(i=0,a=-a),requestAnimationFrame(n))})),t},t.repaint=function(n){return e.pause()?t:t.paintNow||f?(e.repaint(n),t):(g&&(clearTimeout(g),g=null),v?v!=n&&(n.mode&&v.mode==n.mode?v.u==n.u&&v.v==n.v&&v.w==n.w||(v=n.mode):v=v.mode==n||v==n.mode?n.mode||v.mode:"C"):v=n,g=setTimeout((function(){e.repaint(v),v=null;for(var n,t=0;n=h[t];++t)e.Event.fire("overlayChange",n);h=[]}),OVERLAY_PAINT_DELAY),t)},t.enableAutoClosePopup=function(e){return null==e?l:(l=e,t)},t.enableAutoFocusPopup=function(e){return null==e?s:(s=e,t)},t.enableFloorPlan=function(e){return null==e?c:(c=e,t)},t.enableEditGuide=function(n){return e.Event[n?"bind":"unbind"]("overlayDrag",L),t},t.lastOpenPopup=function(){return e.Ui.popup?e.Ui.popup.get():d},t.linkEditing=function(n,o){t.enableEditGuide(!1);for(var a,i=n.node(e),r=o.node(e),l=0;a=i[l];++l)if(!0!==a&&!a.radius)for(var s,d=a.location(),u=a.half?1:0;s=r[u];u+=2)!0===s||s.radius||$.sameLocation(d,s.location())&&t.linkNode(a,s);return t},t.linkNode=function(e,n){for(var o=(e.link||[e]).concat(n.link||[n]),a=0;a<o.length;++a)o[a].link=o;return t},t.pathAnimation=function(n,t,o){o=o||1/(1<<e.zoom());var a=t.location(),i=a[0],r=0;return e.Event.bind("overlayMove",(function t(l){if(n==l){var s=a[++r];if(s){var d=m.distance(s.lon-i.lon,s.lat-i.lat)/o;i=s,n.move(s,d)}else e.Event.unbind("overlayMove",t).fire("pathAnimationEnd",n)}})),n.move(i),this},$.isHD(),t.clear(),longdo.callback["floor"+e.id()]=function(n){n.id=p,p==n.id?e.Ui.FloorSelector.visible(p,n.result):e.Ui.FloorSelector.visible(!1)},e.Event.bind("overlayDrop",(function(n){"n"==n.type&&n.active()&&(editGuide?n.geometry.saveGuide(e):n.geometry.updateNode(e.projection(),n))})),t.enableEditGuide(!0)};var DPAD_MOVE=300,ZOOMBAR_HEIGHT=200,GEOLOCATION_TIMEOUT=15e3,NOTIFY_TIMEOUT=5e3,CONTEXTMENU_BUFFER_X=5,CONTEXTMENU_BUFFER_Y=15,CONTEXTMENU_POI_MAX=5,GUIDE_POINT_SIZE=15,POPUP_MINI_OFFSET_X=30,POPUP_MINI_OFFSET_Y=60,FLOOR_ZOOM_MIN=17,uiTheme={dpad:$.getImage("ui/dpad"),zoomIn:$.getImage("ui/zoom-in"),zoomOut:$.getImage("ui/zoom-out"),zoomBar:$.getImage("ui/zoom-bar"),zoomSlider:$.getImage("ui/zoom-slider"),zoomInMini:$.getImage("ui/zoom-in-mobile"),zoomOutMini:$.getImage("ui/zoom-out-mobile"),geolocation:$.getImage("ui/geolocation"),geolocationTip:"Your location",geolocationLabel:{th:{req:"กำลังหาตำแหน่ง...",res:"พบตำแหน่ง (ในระยะ ~",err:"ไม่สามารถหาตำแหน่งได้"},en:{req:"Locating...",res:"Location found (Accuracy ~",err:"Cannot find location"}},geolocationMarkerIcon:{url:$.getFile("current-location.png"),urlHD:$.getFile("current-location-2x.png"),offset:{x:28,y:42}},geolocationMaxZoom:99,measureOff:$.getImage("ui/measure-off"),measureOn:$.getImage("ui/measure-on"),measureTip:"Measurement",measureBeginTip:"Click to create line/polygon<br />Double click to create circle",measureDistanceTip:"Double Click to end",measureAreaTip:"Click to create polygon",measureColorList:!1,measureOptions:{label:!0,editable:!0,draggable:!0,rotatable:!0,weight:longdo.OverlayWeight.Top},rangeOff:$.getImage("ui/range-off"),rangeOn:$.getImage("ui/range-on"),rangeTip:"Zoom to selection",rangeOptions:{lineColor:"rgba(0,0,127,0.3)",lineWidth:2,fillColor:!1},clearOff:$.getImage("ui/clear-off"),clearOn:$.getImage("ui/clear-on"),clearTip:"Clear measurement",fullscreenUp:$.getImage("ui/fullscreen-up"),fullscreenDown:$.getImage("ui/fullscreen-down"),fullscreenTip:"Fullscreen",legendTraffic:{th:$.getImage("ui/legend-traffic-th"),en:$.getImage("ui/legend-traffic-en")},popupMiniMarkerIcon:{html:'<img src="'+$.getFile("icon-marker.png")+'" srcset="'+$.getFile("icon-marker-2x.png")+' 2x">',offset:{x:8,y:25}},contextMenuTip:"Right click for<br />more functions"};longdo.MapTheme.ui=uiTheme,longdo.DPad=function(e,n){var t=null,o=null;function a(){o.innerHTML=n.zoom()}this.visible=function(e){return null==e?"none"!=t.style.display:(t.style.display=e?"block":"none",n.Ui.updateStyle(),this)},(t=$.append(e,"div",{className:"ldmap_dpad"})).style.backgroundImage="url("+uiTheme.dpad+")",o=$.append(t,"div",{className:"ldmap_zoomlabel"}),$.append(t,"div",{className:"ldmap_goleft"}).addEventListener("click",(function(){n.move({x:-DPAD_MOVE,y:0},!0)})),$.append(t,"div",{className:"ldmap_goright"}).addEventListener("click",(function(){n.move({x:DPAD_MOVE,y:0},!0)})),$.append(t,"div",{className:"ldmap_goup"}).addEventListener("click",(function(){n.move({x:0,y:-DPAD_MOVE},!0)})),$.append(t,"div",{className:"ldmap_godown"}).addEventListener("click",(function(){n.move({x:0,y:DPAD_MOVE},!0)})),n.Event.bind("pinch",a).bind("zoom",a),a()},longdo.Zoombar=function(e,n){var t=null,o=null,a=null,i=0,r=n.projection().maxZoom,l=null;function s(){a.style.top=(1-n.zoom()/r)*ZOOMBAR_HEIGHT+"px"}this.visible=function(e){return null==e?"none"!=t.style.display:(t.style.display=e?"inline-block":"none",this)},this.element=function(){return t},t=$.append(e,"div",{className:"ldmap_zoom"}),$.append(t,"img",{className:"ldmap_zoomin ldmap_button",src:uiTheme.zoomIn,alt:"+"}).addEventListener("click",(function(){n.zoom(!0,!0)}));var d=$.append(t,"div",{className:"ldmap_zoombargroup"});o=$.append(d,"img",{className:"ldmap_zoombar",onload:s,src:uiTheme.zoomBar,alt:""}),a=$.append(d,"img",{className:"ldmap_zoomslider",src:uiTheme.zoomSlider,alt:""}),setTimeout($.transition,1e3,a,!0),$.append(t,"img",{className:"ldmap_zoomout ldmap_button",src:uiTheme.zoomOut,alt:"-"}).addEventListener("click",(function(){n.zoom(!1,!0)})),document.addEventListener("mousedown",(function(e){e.target==a&&(e.preventDefault(),l=e.clientY)})),document.addEventListener("mousemove",(function(e){if(l){e.preventDefault();var t=$.bound(e.clientY-l,-a.offsetTop,o.offsetHeight-a.offsetTop-a.offsetHeight+2),i=$.bound(n.zoom()-Math.round((e.clientY-l)/o.offsetHeight*r),1,r);$.isInRange(i,n.zoomRange())?$.translate(a,{x:0,y:t}):i=!1,n.Ui.Tooltip.set(i)}})),document.addEventListener("mouseup",(function(e){if(l){e.preventDefault();var t=n.zoomRange();s=$.bound(n.zoom()-Math.round((e.clientY-l)/o.offsetHeight*r),t.min,t.max),l=null,n.zoom(s,!0),$.translate(a,{x:0,y:0}),n.Ui.Tooltip.set(!1)}else{if(e.target!=o)return;i||(i=o.getBoundingClientRect().top);var s=1+((1-(e.clientY-i)/o.offsetHeight)*r|0);n.zoom(s,!0)}})),n.Event.bind("pinch",s).bind("zoom",s),s()},longdo.ZoombarMini=function(e,n){var t=null;this.visible=function(e){return null==e?"none"!=t.style.display:(t.style.display=e?"block":"none",this)},this.element=function(){return t},t=$.append(e,"div",{className:"ldmap_zoombar_mini"}),$.fastClick($.append(t,"img",{className:"ldmap_button ldmap_zoomin",src:uiTheme.zoomInMini,alt:"+"}),(function(){n.zoom(!0,!0)})),$.fastClick($.append(t,"img",{className:"ldmap_button ldmap_zoomout",src:uiTheme.zoomOutMini,alt:"-"}),(function(){n.zoom(!1,!0)}))},longdo.Geolocation=function(e,n){var t="th",o=uiTheme.geolocationLabel[t],a=null,i=null,r=null,l=null;function s(e){if("hide"!=e){if(e){if(clearTimeout(l),n.Overlays.remove(r),e.coords){var a=e.coords.accuracy,d=n.projection().maxZoom-(a<100?4:a<500?5:a<1e3?6:a<2500?7:a<1e4?8:a<25001?9:10);d>uiTheme.geolocationMaxZoom&&(d=uiTheme.geolocationMaxZoom),d>n.zoom()&&n.zoom(d),i.innerHTML=o.res+$.formatDistance(a,t)+")",r=new longdo.Marker({lon:e.coords.longitude,lat:e.coords.latitude},{icon:uiTheme.geolocationMarkerIcon}),n.Overlays.add(r)}else i.innerHTML='<span class="ldmap_alert_error">'+o.err+"</span>";setTimeout(s,NOTIFY_TIMEOUT,"hide")}else i.innerHTML=o.req,l=setTimeout(s,GEOLOCATION_TIMEOUT,!0);i.style.display="inline"}else i.style.display="none"}this.language=function(e){return null==e?t:(t="th"==e.substring(0,2)?"th":"en",o=uiTheme.geolocationLabel[t],this)},this.visible=function(e){return null==e?"none"!=a.style.display:(a.style.display=e?"inline":"none",this)},this.updateCurrentLocation=function(e){if(!navigator.geolocation)throw"Browser not supported";return s(),n.Event.fire("beforeGeolocation")?(navigator.geolocation.getCurrentPosition((function(t){void 0!==e&&n.location({lon:t.coords.longitude,lat:t.coords.latitude},e),s(t),n.Event.fire("geolocation",t)}),(function(e){s(e),n.Event.fire("geolocationError",e)}),{maximumAge:GEOLOCATION_TIMEOUT,timeout:GEOLOCATION_TIMEOUT,enableHighAccuracy:!0}),this):this},this.forceCurrentLocation=function(){return n.Overlays.remove(r),r=new longdo.Marker(n.location(),{icon:uiTheme.geolocationMarkerIcon}),n.Overlays.add(r),this},a=$.append(e,"img",{className:"ldmap_button ldmap_geolocation",src:uiTheme.geolocation,title:uiTheme.geolocationTip,alt:""}),$.fastClick(a,(function(){n.location(longdo.LocationMode.Geolocation,!0)})),i=$.append(e,"span",{className:"ldmap_alert"}),$.append(e,"br")},longdo.Toolbar=function(e,n){var t="th",o=null,a=null,i=null,r=null,l=0,s=null,d=[],u=null,c=null,m=null,p=null;function f(){"M"!=p&&(h(),p="M",a.src=uiTheme.measureOn,n.Event.bind("click",T).bind("overlayClick",T).bind("doubleClick",b).fire("toolbarChange",p),n.Ui.Tooltip.set(uiTheme.measureBeginTip),n.Ui.Mouse.overlayDoubleClick(!0))}function g(){"M"==p&&(p=null,a.src=uiTheme.measureOff,n.Event.unbind("mousemove",y).unbind("click",T).unbind("overlayClick",T).unbind("doubleClick",b).fire("toolbarChange",p),n.Overlays.remove(c).remove(m),c=null,m=null,u=null,n.Ui.Tooltip.set(!1),n.Ui.Mouse.overlayDoubleClick(!1))}function v(){"R"!=p&&(g(),p="R",i.src=uiTheme.rangeOn,n.Event.fire("toolbarChange",p),document.addEventListener("mousedown",L))}function h(){"R"==p&&(p=null,i.src=uiTheme.rangeOff,n.Event.fire("toolbarChange",p),document.removeEventListener("mousedown",L),n.Ui.Tooltip.set(!1))}function y(){var e=n.location(longdo.LocationMode.Pointer);if(u[u.length-1]=e,c?c.move(u):((c=new longdo.Polyline(u,{lineColor:"rgba("+s+", 0.3)",fillColor:!1,label:!0})).guide=!0,c.label.guide=!0,n.Overlays.add(c)),n.Ui.Tooltip.set(uiTheme.measureDistanceTip),!(u.length<4)){var t=10/(1<<n.zoom());$.isAbsInRange(e.lon-u[0].lon,t)&&$.isAbsInRange(e.lat-u[0].lat,t)?(m||((m=new longdo.Dot(u[0],{lineColor:"rgba("+s+", 1)",lineWidth:GUIDE_POINT_SIZE})).guide=!0,n.Overlays.add(m)),n.Ui.Tooltip.set(uiTheme.measureAreaTip)):(n.Overlays.remove(m),m=null)}}function T(){var e=n.location(longdo.LocationMode.Pointer);if(u){if(m)return u.pop(),b();y(),u.push(e)}else uiTheme.measureColorList?(s=uiTheme.measureColorList[l],l=(l+1)%uiTheme.measureColorList.length):s=STOCK_COLOR[nextColor],n.Event.bind("mousemove",y),u=[e,e];return!1}function b(e){e&&u&&y();var t=uiTheme.measureOptions;uiTheme.measureColorList?(t.lineColor="rgba("+s+", "+GEOMETRY_LINEALPHA+")",t.fillColor="rgba("+s+", "+GEOMETRY_FILLALPHA+")"):(delete t.lineColor,delete t.fillColor);var o=u?new(e?longdo.Polyline:longdo.Polygon)(u,t):new longdo.Circle(n.location(longdo.LocationMode.Pointer),100/(1<<n.zoom()),t);return n.Ui.Tooltip.set(!1),n.Overlays.add(o),d.push(o),r.src=uiTheme.clearOn,g(),!1}function L(e){if($.onMap(e)&&n.pageToScreen({x:e.pageX,y:e.pageY})){n.Ui.Mouse.enableDrag(!1);var t=n.location(longdo.LocationMode.Pointer);u=[t,{lat:t.lat},null,{lon:t.lon},t],document.removeEventListener("mousedown",L),document.addEventListener("mousemove",E),document.addEventListener("mouseup",_)}}function E(){if(!u||5!=u.length){if(!c)return;u=c.location()}u[2]=n.location(longdo.LocationMode.Pointer),u[1].lon=u[2].lon,u[3].lat=u[2].lat,c?c.move(u):((c=new longdo.Polygon(u,uiTheme.rangeOptions)).guide=!0,n.Overlays.add(c))}function _(){if(null!=u[2]){var e={};u[0].lon<u[2].lon?(e.minLon=u[0].lon,e.maxLon=u[2].lon):(e.minLon=u[2].lon,e.maxLon=u[0].lon),u[0].lat<u[2].lat?(e.minLat=u[0].lat,e.maxLat=u[2].lat):(e.minLat=u[2].lat,e.maxLat=u[0].lat),n.bound(e)}document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",_),n.Ui.Mouse.enableDrag(!0),n.Overlays.remove(c),c=null,u=null,h()}this.language=function(e){return null==e?t:(t="th"==e.substring(0,2)?"th":"en",this)},this.visible=function(e){return null==e?"none"!=o.style.display:(o.style.display=e?"inline":"none",n.Ui.updateStyle(),this)},this.measureToggle=function(e){(("boolean"==typeof e?e:a.src==uiTheme.measureOff)?f:g)()},this.rangeToggle=function(e){(("boolean"==typeof e?e:i.src==uiTheme.rangeOff)?v:h)()},this.measureList=function(){return d},this.activeTool=function(){return p},o=$.append(e,"span",{className:"ldmap_toolbar"}),(a=$.append(o,"img",{className:"ldmap_button",src:uiTheme.measureOff,title:uiTheme.measureTip,alt:"Measure"})).addEventListener("click",this.measureToggle),(i=$.append(o,"img",{className:"ldmap_button",src:uiTheme.rangeOff,title:uiTheme.rangeTip,alt:"Range"})).addEventListener("click",this.rangeToggle),(r=$.append(o,"img",{className:"ldmap_button",src:uiTheme.clearOff,title:uiTheme.clearTip,alt:"Clear"})).addEventListener("click",(function(){r.src=uiTheme.clearOff;for(var e=0;e<d.length;++e)n.Overlays.remove(d[e]);d=[],n.Event.fire("clearMeasure")}))},longdo.Fullscreen=function(e,n){var t=this,o=null;t.visible=function(e){return null==e?"none"!=o.style.display:(o.style.display=e?"inline":"none",t)},t.toggle=function(a){var i=void 0===a?$.hasClass(e.parentNode,"ldmap_placeholder_fullscreen"):!a;return i?($.removeClass(e.parentNode,"ldmap_placeholder_fullscreen"),o.src=uiTheme.fullscreenUp):($.addClass(e.parentNode,"ldmap_placeholder_fullscreen"),o.src=uiTheme.fullscreenDown),n.resize(),n.Event.fire("fullscreen",!i),t},(o=$.append(e,"img",{className:"ldmap_button ldmap_fullscreen",src:uiTheme.fullscreenUp,title:uiTheme.fullscreenTip,alt:"Fullscreen"})).addEventListener("click",(function(){t.toggle()})),(new Image).src=uiTheme.fullscreenDown},longdo.Crosshair=function(e,n){var t=null,o=null;this.visible=function(e){return null==e?"none"!=t.style.display:(t.style.display=o.style.display=e?"block":"none",this)},(t=$.append(e,"div",{className:"ldmap_crosshair ldmap_maparea"})).style.height=(n?10:20)+"px",(o=$.append(e,"div",{className:"ldmap_crosshair ldmap_maparea"})).style.width=(n?10:20)+"px"},longdo.Scale=function(e){var n=null,t=null,o=3779.52,a=!1,i=!0;this.repaint=function(e,r){var l=e.normToLat(e.maxLat-r.y/e.pointPerDegree),s=(e.maxPointY>>r.z)/e.size/$.longitudeLength(l),d=8e6;if(s>100)return n.style.width="100px",t.innerHTML="unscale"+s,self;s>25?d=1:s>5?d=10:s>2.5?d=50:s>.5?d=100:s>.25?d=500:s>.05?d=1e3:s>.025?d=5e3:s>.005?d=1e4:s>.0025?d=5e4:s>5e-4?d=1e5:s>25e-5?d=5e5:s>125e-6?d=1e6:s>625e-7?d=2e6:s>3125e-8&&(d=4e6),n.style.width=(s*d|0)+"px";var u="";if(a){var c=o/s,m=c<1e3?c<100?1:100:1e3;u="1:"+$.numberWithCommas(parseInt(c/m)*m),i&&(u+="<br />")}return i&&(u+=d<1e3?d+" m":d/1e3+" km"),t.innerHTML=u,self},this.visible=function(e){return null==e?"none"!=n.style.display:(n.style.display=e?"block":"none",this)},this.enableAbsolute=function(e){return null==e?a:(a=e,this)},this.enableRelative=function(e){return null==e?i:(i=e,this)},this.ppi=function(e){return null==e?o/39.37:(o=39.37*e,this)},n=$.append(e,"div",{className:"ldmap_scale"}),t=$.append(n,"div",{className:"ldmap_scalecaption"}),setTimeout($.transition,1e3,n,!0)},longdo.Legend=function(e,n){var t=this,o="th",a=null,i=!1,r=!1;function l(){n.Layers.contains(longdo.Layers.TRAFFIC)?(t.visible(uiTheme.legendTraffic[o]),i&&setTimeout(n.Overlays.load,100,longdo.Overlays.events),r&&setTimeout(n.Overlays.load,200,longdo.Overlays.cameras)):(t.visible(!1),i&&n.Overlays.unload(longdo.Overlays.events),r&&n.Overlays.unload(longdo.Overlays.cameras))}t.language=function(e){return null==e?o:(o="th"==e.substring(0,2)?"th":"en",l(),t)},t.visible=function(e){return null==e?"none"!=a.style.display:(e?(a.src=e,a.style.display="inline"):a.style.display="none",t)},t.enableLoadEvents=function(e){return null==e?i:(i=e,t)},t.enableLoadCameras=function(e){return null==e?r:(r=e,t)},a=$.append(e,"img",{src:NODATA,className:"ldmap_legend",alt:""}),n.Event.bind("layerChange",l),l()},longdo.Notice=function(e,n){var t='" target="_blank"><img src="'+$.getFile("logo.png")+'" srcset="'+$.getFile("logo-2x.png")+' 2x" alt="Longdo Map"></a>';$.append(e,"div",{className:"ldmap_notice",innerHTML:n?copyright[1]||'<a href="'+server.longdo+"/terms"+t:copyright[0]||'<a href="'+server.longdo+"/"+t+' - <a href="'+server.longdo+'/terms/" target="_blank">Terms</a>'})},longdo.ContextMenu=function(e,n){var t=null,o="ldcontext"+n.id()+"-",a=null,i=null,r=null,l=null,s=null,d={},u=null,c=null,m=!1,p=!0,f=!0;function g(e){e instanceof Element?a.appendChild(e):$.append(a,"div",{innerHTML:e})}function v(){var o=c.x+t.offsetWidth+CONTEXTMENU_BUFFER_X,a=c.y+t.offsetHeight+CONTEXTMENU_BUFFER_Y,i=o>e.offsetWidth?o-e.offsetWidth:0,r=a>e.offsetHeight?a-e.offsetHeight:0;(i||r)&&(m=!0,c.y-=r,c.x-=i,n.move({x:i,y:r},!1),t.style.display="block",t.style.top=c.y+"px",t.style.left=c.x+"px",setTimeout((function(){m=!1}),0))}function h(e){data=d[e.target.id.substring(o.length)],longdo.callback["detailNearPoi"+n.id()]=function(t){var o=t.data[0],a=document.getElementById("detail"+e.target.id);a&&(a=a.parentNode,$.empty(a).appendChild($.formatPoi(o,n.language(),n.Ui.popup)))};var t=new longdo.Marker(data,{title:data.name,detail:'<div id="detail'+e.target.id+'" class="ldmap_poi_load">Loading...</div>',loadDetail:function(){$.loadScript(server.poi+"/json/get?id="+data.id+"&locale="+n.language()+"&key="+apikey+"&callback=longdo.callback.detailNearPoi"+n.id())}});t.type="p",t.data=data,n.Overlays.add(t),t.pop()}this.visible=function(e,o){if(null==e)return"none"!=t.style.display;if(m)return this;if(e){c=e,r=o,$.empty(t);var d=$.append(t,"div",{className:"ldmap_contextmenu_info"}),h=n.zoom();if(p&&h>12&&server.poi&&(s=$.append(d,"div"),n.Search.nearPoi(o,{span:.01/(h-12),zoom:h+1,limit:CONTEXTMENU_POI_MAX})),f&&(l=$.append(d,"div",{innerHTML:"Loading..."}),n.Search.address(o,{limit:h<13?"&noaoi=fast&nowater="+(h<8?"":"fast"):""})),u=$.append(d,"div",{className:"ldmap_contextmenu_location",innerHTML:Number(o.lat).toFixed(6)+", "+Number(o.lon).toFixed(6)}),(a=document.createElement("div")).className="ldmap_contextmenu_extra",!n.Event.fire("beforeContextmenu",{location:o,add:g}))return this;a.children&&a.children.length||g(i),t.appendChild(a),t.style.display="block",t.style.top=c.y+"px",t.style.left=c.x+"px",v(),n.Event.fire("contextmenu")}else t.style.display="none";return this},this.enableNearPoi=function(e){return null==e?p:(p=e,this)},this.enableAddress=function(e){return null==e?f:(f=e,this)},t=$.append(e,"div",{className:"ldmap_contextmenu ldmap_selectable"}),n.Event.bind("address",(function(e){if(c){if(e&&isNaN(e.geocode)){var t="";e.country&&(e.province&&(e.district&&(e.subdistrict&&(t=e.subdistrict+", "),t+=e.district+", "),t+=e.province+", "),e.geocode?t=t.substring(0,t.length-2):t+=e.country),l.innerHTML=t}else if(e&&!e.error){if("th"==n.Search.language())var o=" ",a=e.house_num?e.house_num+" ":"",i="",r=e.moo?"หมู่ที่ "+e.moo+o:"";else o=", ",a="",i=e.house_num?e.house_num+" ":"",r=e.moo?"Moo "+e.moo+o:"";if(l.innerHTML=a+(e.aoi?e.aoi+o:"")+i+(e.water?e.water+o:e.road?e.road+o:e.express?e.express+o:"")+r+e.subdistrict+o+e.district+o+e.province,e.postcode&&(l.innerHTML+=" "+e.postcode),e.elevation){var s=UNIT[n.Search.language()];u.innerHTML+=" "+$.numberWithCommas(e.elevation)+s.m}}else $.empty(l);v()}})),n.Event.bind("nearPoi",(function(e){if(c&&$.sameLocation(r,e.meta)&&s&&(d={},e.data.length)){for(var n,t=document.createDocumentFragment(),a=0;n=e.data[a];++a){d[n.id]=n;var i=$.append(t,"div");$.append(i,"img",{className:"ldmap_contextmenu_icon",src:server.icon+($.isHD()?"_2x/":"/")+n.icon,alt:""}),$.append(i,"span",{id:o+n.id,className:"ldmap_contextmenu_poi ldmap_link",innerHTML:n.name,title:n.name}).addEventListener("click",h)}$.append(t,"hr"),$.empty(s).appendChild(t),v()}})),(i=document.createElement("div")).className="ldmap_link",i.innerHTML="Move here",i.onclick=function(){n.Ui.ContextMenu.visible(!1),n.location(r)}},longdo.Tooltip=function(e,n){var t=null,o=null;function a(){t.style.display="block",t.style.top=o.y+20+"px",t.style.left=o.x+"px"}this.visible=function(e){if(null==e)return"none"!=t.style.display;if(e){if(o=e,!t.innerHTML)return this;a()}else t.style.display="none";return this},this.set=function(e){return e?(t.innerHTML=e,o&&a()):($.empty(t).style.display="none",this.type=void 0),n.Event.fire("tooltipChange",e),this},this.get=function(){return t.innerHTML},t=$.append(e,"div",{className:"ldmap_tooltip"})},longdo.PopupMini=function(e,n){var t=null,o=null,a=null;this.set=function(i,r){if(!i&&!o)return this;var l=i!=o&&null!=i;if(void 0===r)r=l;else if(r!=l)return this;if(o){var s=o.element();s.insertBefore(t.firstChild,s.firstChild),o=null,t.setAttribute("style","")}if(r){t.appendChild(i.element().firstChild),i.closeButton&&(i.closeButton.onclick=function(){n.Ui.popup.set(),n.Event.fire("popupClose",n.Ui.popup)}),t.firstChild.setAttribute("style","");var d=i.detail();if(d){var u=d.style.width,c=1;u&&(c=e.offsetWidth/(+u.replace("px","")+POPUP_MINI_OFFSET_X),d.style.transformOrigin="0 0",d.style.transform="scale("+c+")");var m=d.style.minHeight;m&&(t.style.height=(+m.replace("px","")+POPUP_MINI_OFFSET_Y)*c+"px")}i.loadDetail&&(n.Event.fire("popupLoadDetail",i)&&i.loadDetail(i.detail()),delete i.loadDetail),o=i,a&&n.Overlays.remove(a),a=new longdo.Marker(i.location(),{icon:uiTheme.popupMiniMarkerIcon,style:"z-index: 255",weight:longdo.OverlayWeight.Top}),n.Overlays.add(a),this.visible(!0)}else n.Overlays.remove(a),a=null,this.visible(!1);return this},this.get=function(){return o},this.visible=function(e){return null==e?"none"!=t.style.display:(t.style.display=e?"block":"none",this)},t=$.append(e,"div",{className:"ldmap_popup_mini"})},longdo.FloorSelector=function(e,n){var t="th",o=null,a="ldfloor"+n.id()+"-",i=null,r=[];function l(e){i&&$.removeClass(i,"ldmap_floor_item_active"),d(),i=e.target,$.addClass(i,"ldmap_floor_item_active");var t=i.id.split("-");$.loadScript(server.longdo+"/webservice/json/getooichildren?ooiid="+t[1]+"&floor="+t[2]+"&key="+apikey+"&callback=longdo.callback.floorplan"+n.id())}function s(){n.zoom()>=FLOOR_ZOOM_MIN&&o.innerHTML?o.style.display="block":o.style.display="none"}function d(){var e=n.pause();n.pause(!0);for(var t=0;t<r.length;++t)n.Overlays.remove(r[t].marker);n.pause(e).repaint("C"),r=[]}function u(e){var o=$.formatPoi(r[e.firstChild.id.substring(a.length+1)],t,n.Ui.popup);$.empty(e).appendChild(o)}this.language=function(e){return null==e?t:(t="th"==e.substring(0,2)?"th":"en",this)},this.visible=function(e,n){if(null==e)return"none"!=o.style.display;if($.empty(o),i=null,d(),e){for(var t,r=document.createDocumentFragment(),u=0;t=n[u];++u)$.append(r,"div",{id:a+e+"-"+t,className:"ldmap_floor_item",innerHTML:t}).addEventListener("click",l);o.appendChild(r)}return s(),this},o=$.append(e,"div",{className:"ldmap_floor"}),n.Event.bind("pinch",s).bind("zoom",s),longdo.callback["floorplan"+n.id()]=function(e){var o=i.id.split("-");if(e.id=o[1],e.floor=o[2],e.id==o[1]&&e.floor==o[2]){var l=n.pause();n.pause(!0);for(var s=0;s<e.result.length;++s){var d=e.result[s];d.id=d.pid,d.lon=d.longitude,d.lat=d.latitude,"O"==d.status_ooi&&(d.obsoleted=!0),"A"==d.status_ooi&&(d.verified=!0),d.tel=d.telephone,d.tag=d.tag.split(", "),d.type="poi",d.icon="reddot.png",r.push(d),d.marker=new longdo.Marker(d,{title:d["title_"+t],detail:'<div id="'+a+"d"+s+'" class="ldmap_poi_load">Loading...</div>',icon:{url:server.icon+"/"+d.icon,urlHD:server.icon+"_2x/"+d.icon},loadDetail:u}),n.Overlays.add(d.marker)}n.pause(l).repaint("C")}}};var DEFAULT_TAG=["travel","restaurant","gas_station","bank"],DROPDOWN_BUFFER=30,DROPDOWN_MIN=15,DROPDOWN_CLOSE_DELAY=1e3;longdo.ButtonType={Radio:"RADIO",Toggle:"TOGGLE",Push:"PUSH",Reset:"RESET",Group:"GROUP",Custom:"CUSTOM"};var menuTheme={tagPanelLabel:{th:{title:"Tag: ",more:"หมวดหมู่เพิ่มเติม",less:"ย่อหมวดหมู่",clear:"ลบ tag"},en:{title:"Tag: ",more:"More categories",less:"Less categories",clear:"Clear tags"}},layerSelectorOption:{th:{button:[{label:"สถานที่",value:longdo.Layers.POI},{label:"จราจร",value:longdo.Layers.GRAY,value2:longdo.Layers.TRAFFIC,value4:!0},{label:"ดาวเทียม (กูเกิล)",value:longdo.Layers.GOOGLE_HYBRID}],dropdown:[{label:"ดาวเทียม (ไทยโชต)",value:longdo.Layers.THAICHOTE,value2:longdo.Layers.POI_TRANSPARENT},{label:"ถนน",value:longdo.Layers.NORMAL},{label:"สีเทา",value:longdo.Layers.GRAY},{label:"เขตการปกครอง",value:longdo.Layers.POLITICAL},{label:"มืด",value:longdo.Layers.POI,value3:longdo.Filter.Dark},{label:"สว่าง",value:longdo.Layers.POI,value3:longdo.Filter.Light}],more:"แผนที่อื่นๆ",dropdownTitle:"เลือกแผนที่"},en:{button:[{label:"Map",value:longdo.Layers.POI_EN},{label:"Traffic",value:longdo.Layers.GRAY_EN,value2:longdo.Layers.TRAFFIC,value4:!0},{label:"Satellite (Google)",value:longdo.Layers.GOOGLE_HYBRID}],dropdown:[{label:"Satellite (Thaichote)",value:longdo.Layers.THAICHOTE,value2:longdo.Layers.POI_TRANSPARENT_EN},{label:"Street",value:longdo.Layers.NORMAL_EN},{label:"Gray",value:longdo.Layers.GRAY_EN},{label:"Political",value:longdo.Layers.POLITICAL_EN},{label:"Dark",value:longdo.Layers.POI_EN,value3:longdo.Filter.Dark},{label:"Light",value:longdo.Layers.POI_EN,value3:longdo.Filter.Light}],more:"Other Maps",dropdownTitle:"Select Map"}},layerSelectorDropdown:[{label:"",type:longdo.ButtonType.Group},{label:"ภูมิประเทศ",value:longdo.Layers.TERRAIN},{label:"OpenStreetMap",value:longdo.Layers.OSM},{label:"Longdo OSM",value:longdo.Layers.LONGDO_OSM},{label:"Longdo OSM (Vector)",value:longdo.Layers.MAPBOX_LONGDO_OSM},{label:"Longdo Traffic (Vector)",value:longdo.Layers.MAPBOX_LONGDO_TRAFFIC},{label:"Non-free",type:longdo.ButtonType.Group},{label:"TomTom - สถานที่",value:longdo.Layers.TOMTOM_POI},{label:"TomTom - ถนน",value:longdo.Layers.TOMTOM_NORMAL},{label:"Google - ถนน",value:longdo.Layers.GOOGLE_ROADMAP},{label:"Google - จราจร",value:longdo.Layers.GOOGLE_TRAFFIC},{label:"Google - ดาวเทียม",value:longdo.Layers.GOOGLE_HYBRID},{label:"ESRI - สถานที่",value:longdo.Layers.ARCGIS_WORLD_TOPO_MAP},{label:"ESRI - ถนน",value:longdo.Layers.ARCGIS_WORLD_STREET_MAP},{label:"ESRI - ดาวเทียม สถานที่",value:longdo.Layers.ARCGIS_WORLD_IMAGERY,value2:longdo.Layers.ARCGIS_WORLD_PLACE},{label:"ESRI - ดาวเทียม ถนน",value:longdo.Layers.ARCGIS_WORLD_IMAGERY,value2:longdo.Layers.ARCGIS_WORLD_TRANSPORTATION}],arrowDown:$.getImage("ui/arrow-down"),arrowUp:$.getImage("ui/arrow-up"),arrowActive:$.getImage("ui/arrow-active")};for(var key in menuTheme)longdo.MapTheme.ui[key]=menuTheme[key];function LongdoControl(e){this.element=function(){return e},this.visible=function(n){return null==n?"none"!=e.style.display&&document.body.contains(e):(e.style.display=n?"inline-block":"none",this)}}longdo.MenuBar=function(e){var n=null,t=null,o=null,a=null,i=null,r=-1,l=-1,s=null;function d(n){var t=$.hasClass(n.target,"ldmap_button_active"),o=c();p(),r=n.target.index;var a=e.button[r];switch(a.type){case longdo.ButtonType.Toggle:t?(r=-1,a=null,$.removeClass(n.target,"ldmap_button_active")):$.addClass(n.target,"ldmap_button_active");break;case longdo.ButtonType.Push:r=-1;break;case longdo.ButtonType.Reset:r=-1,a=null;break;default:$.addClass(n.target,"ldmap_button_active")}e.change&&e.change(a,o)}function u(n){var a=c();p(),l=n.target.index;var i=e.dropdown[l];i.type==longdo.ButtonType.Reset?(l=-1,o.innerHTML=e.dropdownLabel,$.removeClass(t,"ldmap_button_active"),i=null):(o.innerHTML=i.label,$.addClass(n.target,"ldmap_option_active"),$.addClass(t,"ldmap_button_active")),e.change&&e.change(i,a)}function c(){if(r>=0){var n=e.button[r];return r=-1,$.removeClass(n.element,"ldmap_button_active"),n}return l>=0?(n=e.dropdown[l],l=-1,o.innerHTML=e.dropdownLabel,$.removeClass(t,"ldmap_button_active"),$.removeClass(n.element,"ldmap_option_active"),a.src=menuTheme.arrowDown,n):null}function m(){a.src=menuTheme.arrowUp,i.style.maxHeight=Math.max(n.placeholder().offsetHeight-i.offsetTop-DROPDOWN_BUFFER,DROPDOWN_MIN)+"px"}function p(){i&&(a.src=$.hasClass(t,"ldmap_button_active")?menuTheme.arrowActive:menuTheme.arrowDown,i.style.maxHeight="0px")}function f(e){e.relatedTarget&&($.hasClass(e.relatedTarget,"ldmap_option")||$.hasClass(e.relatedTarget,"ldmap_group"))||(s=setTimeout(p,DROPDOWN_CLOSE_DELAY))}function g(){s&&(clearTimeout(s),s=null)}this.map=function(e){return n=e,this},this.selectIndex=function(n){if(n<0)return c(),this;var t=e.button?e.button.length:0;return n<t?d({target:e.button[n].element}):e.dropdown&&(u({target:e.dropdown[n-t].element}),p()),this},this.selectValue=function(n){if(e.button)for(var t=0;o=e.button[t];++t)if(o.value==n)return d({target:o.element}),this;var o;if(e.dropdown)for(t=0;o=e.dropdown[t];++t)if(o.value==n)return u({target:o.element}),p(),this;return c(),this};var v=document.createElement("span");if(v.className="ldmap_menubar",e.button)for(var h=0;y=e.button[h];++h)y.value||(y.value=y.label),y.element=$.append(v,"span",{className:"ldmap_item ldmap_button ",innerHTML:y.label,index:h}),y.element.addEventListener("click",d);if(e.dropdown){e.dropdownLabel||(e.dropdownLabel="...");var y,T=$.append(v,"span",{className:"ldmap_dropdown"});for((t=$.append(T,"div",{className:"ldmap_dropdown_head",onclick:function(){("0px"!=i.style.maxHeight?p:m)()},onmouseover:g})).addEventListener("mouseout",f),a=$.append(t,"img",{className:"ldmap_arrow",src:menuTheme.arrowDown,alt:"More"}),o=$.append(t,"span",{innerHTML:e.dropdownLabel}),(i=$.append(T,"div",{className:"ldmap_dropdown_body",onmouseover:g})).addEventListener("mouseout",f),i.style.maxHeight="0px",h=0;y=e.dropdown[h];++h)y.type!=longdo.ButtonType.Group?y.type!=longdo.ButtonType.Custom?(y.value||(y.value=y.label),y.element=$.append(i,"div",{className:"ldmap_option",innerHTML:y.label,index:h}),y.element.addEventListener("click",u)):y.element=$.append(i,"div",{innerHTML:y.label}):y.element=$.append(i,"div",{className:"ldmap_group",innerHTML:y.label})}LongdoControl.call(this,v)},longdo.MenuBar.prototype=Object.create(LongdoControl.prototype),longdo.TagPanel=function(e){var n,t="tagpanel"+ ++longdo.objectcount,o="th",a=null,i=null,r=null,l=null,s=null,d=null,u=null,c=null;function m(){"N/A"!=s.innerHTML&&(l.src=menuTheme.arrowUp,$.addClass(r,"ldmap_tagpanel_down"),s.style.display="block",s.style.maxHeight=Math.max(i.placeholder().offsetHeight-s.offsetTop-DROPDOWN_BUFFER,DROPDOWN_MIN)+"px",$.translate(s,{x:r.offsetWidth-s.offsetWidth,y:-1}))}function p(){l.src=menuTheme.arrowDown,$.removeClass(r,"ldmap_tagpanel_down"),s.style.display="none",T()}function f(e){e.relatedTarget&&($.hasClass(e.relatedTarget,"ldmap_option")||$.hasClass(e.relatedTarget,"ldmap_group"))||(c=setTimeout(p,DROPDOWN_CLOSE_DELAY))}function g(){c&&(clearTimeout(c),c=null)}function v(e){i.Tags.set(e.target.title),e.stopPropagation(),p()}function h(e){e.stopPropagation(),("block"==d.style.display?T:y)()}function y(){u.firstChild.innerHTML=a.less,u.lastChild.src=menuTheme.arrowUp,d.style.display="block"}function T(){u.firstChild.innerHTML=a.more,u.lastChild.src=menuTheme.arrowDown,d.style.display="none"}this.map=function(e){return i=e,$.loadScript(server.longdo+"/mmmap/gen_icontag_table_2.php?map=longdo.map"+i.id()+"&locale="+o+"&callback=longdo.callback."+t),this},o=(e=e||{}).language||o,a=menuTheme.tagPanelLabel[o];var b=document.createElement("span");b.className="ldmap_tagpanel ldmap_menubar",b.onclick=function(){("block"==s.style.display?p:m)()},(r=$.append(b,"div",{className:"ldmap_dropdown_head",onmouseover:g})).addEventListener("mouseout",f),l=$.append(r,"img",{className:"ldmap_arrow",src:menuTheme.arrowDown,alt:"More"}),n=$.append(r,"span",{innerHTML:a.title,className:"ldmap_tagpanel_head"}),(s=$.append(b,"div",{className:"ldmap_tagpanel_body ldmap_dropdown_body",innerHTML:"N/A",onmouseover:g})).addEventListener("mouseout",f),s.style.display="none";for(var L,E=e.tag||DEFAULT_TAG,_=0;L=E[_];++_)$.append(n,"img",{src:server.icon+"_2x/"+L+".png",title:$.capFirst(L),alt:L}).addEventListener("click",v);longdo.callback[t]=function(e){for(var n="",t=0;t<e.length;++t)3==t&&(s.innerHTML=n,n="",(d=$.append(s,"div")).style.display="none",(u=$.append(s,"div",{className:"ldmap_morecategory",innerHTML:"<span>"+a.more+'</span> <img class="ldmap_arrow" src="'+menuTheme.arrowDown+'"  alt="More" />'})).addEventListener("click",h)),n+=e[t];(e.length>3?d:s).innerHTML=n;var o=$.append(s,"div",{className:"ldmap_command"});$.append(o,"span",{className:"ldmap_link",innerHTML:a.clear,onclick:i.Tags.clear})},LongdoControl.call(this,b)},longdo.TagPanel.prototype=Object.create(LongdoControl.prototype),longdo.CustomControl=function(e){var n=document.createElement("span");n.className="ldmap_customcontrol",n.innerHTML=e.html,LongdoControl.call(this,n)},longdo.CustomControl.prototype=Object.create(LongdoControl.prototype),longdo.LayerSelector=function(e,n,t){var o=null,a="th",i=null,r=!1;function l(){if(!r){var e=n.Layers.externalMap();e&&(e[0]="ext",e=e.join("."));var t=n.Layers.list();r=!0;for(var a,l=(i.button||[]).concat(i.dropdown||[]),s=0;a=l[s];++s)if(a.value)if(e){if(e==a.value.name()&&t[0]==longdo.Layers.CLEAR&&!t[1]){o.selectIndex(s),r=!1;break}}else if(t[0]==a.value&&t[1]==a.value2){o.selectIndex(s),r=!1;break}r&&(o.selectIndex(-1),r=!1)}}function s(e,n){for(var t,o=0;t=e[o];++o)t.value&&t.value.name().substring(0,n.length)==n&&e.splice(o--,1)}this.language=function(e){if(null==e)return a;a="th"==e.substring(0,2)?"th":"en";var n=menuTheme.layerSelectorOption[a],r=o.element().children;if("dropdown"!=t){i.button=n.button;for(var s=0;d=n.button[s];++s)r[s].innerHTML=d.label,d.element=r[s]}if("button"!=t){i.dropdownLabel=t?n.dropdownTitle:n.more,r[r.length-1].firstChild.lastChild.innerHTML=i.dropdownLabel,r=r[r.length-1].lastChild.children;var d,u="dropdown"==t?n.button.concat(n.dropdown):n.dropdown;for(s=0;d=u[s];++s)r[s].innerHTML=d.label,d.element=r[s],i.dropdown[s]=d}return l(),this},this.visible=function(e){return null==e?o.visible():(o.visible(e),this)},0==menuTheme.layerSelectorGoogle&&(s(menuTheme.layerSelectorOption.en.button,"ext.google."),s(menuTheme.layerSelectorOption.th.button,"ext.google."),s(menuTheme.layerSelectorDropdown,"ext.google."));var d=menuTheme.layerSelectorOption[a];(i="dropdown"==t?{dropdown:d.button.concat(d.dropdown).concat(menuTheme.layerSelectorDropdown),dropdownLabel:d.dropdownTitle}:"button"==t?{button:d.button}:{button:d.button,dropdown:d.dropdown.concat(menuTheme.layerSelectorDropdown),dropdownLabel:d.more}).change=function(e){r||(r=!0,n.Layers.clear().setBase(e.value),e.value2&&n.Layers.add(e.value2),n.enableFilter(e.value3?e.value3:longdo.Filter.None),e.value4?n.Overlays.load(longdo.Overlays.events).load(longdo.Overlays.cameras):n.Overlays.unload(longdo.Overlays.events).unload(longdo.Overlays.cameras),r=!1)},(o=new longdo.MenuBar(i)).map(n),e.appendChild(o.element()),n.Event.bind("layerChange",l),l(),(new Image).src=menuTheme.arrowUp,(new Image).src=menuTheme.arrowActive};var KEYSPEED_MIN=4,KEYSPEED_MAX=16,KEY_ACCEL=1.1,KEY_BREAK=.9,CONTINUOUS_KEY=600,INERTIA=.9,INERTIA_DISTANCE=48,CONTINUOUS_CLICK=300,HOLD_TOUCH=800,CLICK_SIZE=4,FRAMERATE=.06,FRAMESKIP_MAX=3,WHEEL_MAX=20,WHEEL_ZOOM={min:.125,max:8},TRACK_ZOOM={min:1,max:1};longdo.Keyboard=function(e,n,t){var o=!0,a=!0,i=null,r=null,l=0,s=0,d=0;function u(e,n){d=KEY_ACCEL,(e>0&&l<=0||e<0&&l>=0||n>0&&s<=0||n<0&&s>=0)&&(l=e,s=n),r||(i=Date.now(),requestAnimationFrame(c)),r=Date.now()}function c(){var e=Date.now(),n=Math.min((e-i)*FRAMERATE,FRAMESKIP_MAX);if(i=e,$.isAbsInRange(l,1)&&$.isAbsInRange(s,1))return l=0,s=0,void(r=null);requestAnimationFrame(c),e-r>CONTINUOUS_KEY&&(d=KEY_BREAK),t.drag({x:l*n|0,y:s*n|0});var o=Math.pow(d,n);l=$.bound(l*o,-KEYSPEED_MAX,KEYSPEED_MAX),s=$.bound(s*o,-KEYSPEED_MAX,KEYSPEED_MAX)}this.enable=function(e){return null==e?o:(o=e,this)},this.enableInertia=function(e){return null==e?a:(a=e,this)},document.addEventListener("keydown",(function(e){if(o&&document.activeElement==t.anchor&&(17==e.keyCode||!(e.ctrlKey||e.shiftKey||e.altKey||e.metaKey)))switch(e.keyCode){case 37:case 65:a?u(-KEYSPEED_MIN,0):t.drag({x:-KEYSPEED_MAX<<1,y:0});break;case 38:case 87:a?u(0,-KEYSPEED_MIN):t.drag({x:0,y:-KEYSPEED_MAX<<1});break;case 39:case 68:a?u(KEYSPEED_MIN,0):t.drag({x:KEYSPEED_MAX<<1,y:0});break;case 40:case 83:a?u(0,KEYSPEED_MIN):t.drag({x:0,y:KEYSPEED_MAX<<1});break;case 107:case 187:case 61:case 90:t.wheel(!0);break;case 109:case 189:case 173:case 88:t.wheel(!1);break;case 17:n.Ui.Toolbar&&t.getPointer()&&n.Ui.Toolbar.rangeToggle(!0)}})),document.addEventListener("keyup",(function(e){if(o)switch(e.keyCode){case 37:l<0&&(d=KEY_BREAK);break;case 38:s<0&&(d=KEY_BREAK);break;case 39:l>0&&(d=KEY_BREAK);break;case 40:s>0&&(d=KEY_BREAK);break;case 17:n.Ui.Toolbar&&n.Ui.Toolbar.rangeToggle(!1)}}))},longdo.Mouse=function(e,n,t){var o=!0,a=!0,i=!0,r=!0,l=!1,s=!1,d=null,u=null,c=null,p=null,f=null,g=null,v=null,h=null,y=null,T=null,b=null,L=0,E=0,_=!1,x=0,O=null;function I(e){if($.onMap(e)&&document.activeElement==t.anchor){u=R(e);var o=n.pageToScreen(u);o&&(e.preventDefault(),L=0,E=0,e.touches&&e.touches.length>1?(d=[A(e.touches[0]),A(e.touches[1])],h&&(clearTimeout(h),h=null)):(d=u,s&&(h=setTimeout(t.click,HOLD_TOUCH,!1,o))),e.activeElement?(v=t.overlayByElement(e.activeElement))&&v.geometry&&!v.clickable&&(v=t.down(o)):v=t.down(o),v&&v.draggable&&n.Event.fire("overlaySelect",v))}}function w(o){var i=R(o);if(d){if(h&&g&&(clearTimeout(h),h=null),!a){if($.onMap(o)){var r=n.pageToScreen(i);t.dragWhenDisable(r)}return}if(o.preventDefault(),o.touches&&o.touches.length>1){var l=A(o.touches[0]),s=A(o.touches[1]);if(!l||!s)return c=null,void(p=null);var b=m.distance(l.x-s.x,l.y-s.y);c&&n.pinch(b/c,n.pageToScreen(i)),p=c,c=b}else c=null,p=null;if($.isAbsInRange(d.x-i.x,CLICK_SIZE)&&$.isAbsInRange(d.y-i.y,CLICK_SIZE))return;if(!(f={x:parseInt(u.x-i.x),y:parseInt(u.y-i.y)}).x&&!f.y)return;return u=i,g=Date.now(),e.style.cursor="move",v&&v.draggable&&!c?(t.dragOverlay(v,f),n.Ui.Tooltip&&v.title&&n.Ui.Tooltip.get()==v.title&&n.Ui.Tooltip.set(!1)):t.drag(f),void(o.srcElement&&!o.srcElement.dragEvent&&(o.srcElement.addEventListener("drag",w),o.srcElement.dragEvent=!0))}!y||i.x==u.x&&i.y==u.y||(clearTimeout(y),y=null,T()),u=i,t.move(n.pageToScreen(u),$.onMap(o))}function M(e){if(d){if(h&&(clearTimeout(h),h=null),e.preventDefault(),!o||p||g){if(c)n.pinchEnd(n.pageToScreen(u)),c=null,p=null;else if(f){var a=Date.now()-g+10;if(v)t.dropOverlay(v);else{if(r&&a>0&&a<CONTINUOUS_CLICK){var i=30/a;L=$.bound(f.x*i,-INERTIA_DISTANCE,INERTIA_DISTANCE),E=$.bound(f.y*i,-INERTIA_DISTANCE,INERTIA_DISTANCE),b=g,P(Date.now()),requestAnimationFrame(P)}t.drop()}g=null,f=null}}else if(d.length)t.doubleClick(!1,n.pageToScreen({x:(d[0].x+d[1].x)/2,y:(d[0].y+d[1].y)/2}));else{var m=(s||1==e.which)&&3!=e.which,_=n.pageToScreen(d);y?(clearTimeout(y),y=null,t.doubleClick(m,_)):m&&!l&&v?t.hit(v):(T=function(){y=null,m&&v?t.hit(v):t.click(m,_)},y=setTimeout(T,CONTINUOUS_CLICK))}d=null}}function C(e){if(i&&$.onMap(e)){e.preventDefault();var o=n.pageToScreen(A(e));if(o){var a=void 0!==e.deltaY?e.deltaY:void 0!==e.wheelDeltaY?-e.wheelDeltaY:e.wheelDelta?-e.wheelDelta:e.detail;if(a){var r=a<0;r!=_&&t.wheelEnd(),_=r,t.wheel(r,o),WHEEL_ZOOM!=TRACK_ZOOM&&(O?++x:O=setTimeout((function(){x>WHEEL_MAX&&(WHEEL_ZOOM=TRACK_ZOOM),x=0,O=null}),2e3))}}}}function A(e){return{x:e.pageX,y:e.pageY}}function R(e){if(e.pageX||e.pageY||!e.touches)return A(e);if(1==e.touches.length)return A(e.touches[0]);var n=e.touches[0],t=e.touches[1];return{x:(n.pageX+t.pageX)/2,y:(n.pageY+t.pageY)/2}}function P(){var e=Date.now(),n=Math.min((e-b)*FRAMERATE,FRAMESKIP_MAX);if(b=e,!$.isAbsInRange(L,1)||!$.isAbsInRange(E,1)){requestAnimationFrame(P),t.drag({x:L*n|0,y:E*n|0});var o=Math.pow(INERTIA,n);L*=o,E*=o}}this.enable=function(e){return o=e,a=e,i=e,this},this.enableClick=function(e){return null==e?o:(o=e,this)},this.enableDrag=function(e){return null==e?a:(a=e,this)},this.enableWheel=function(e){return null==e?i:(i=e,this)},this.enableInertia=function(e){return null==e?r:(r=e,this)},this.overlayDoubleClick=function(e){return null==e?l:(l=e,this)},this.isTouch=function(){return s},"ontouchstart"in window&&(s=!0,document.addEventListener("touchstart",(function(e){s=!0,I(e)}),{passive:!1}),document.addEventListener("touchmove",w,{passive:!1}),document.addEventListener("touchend",M)),document.addEventListener("mousedown",(function(e){s||I(e)})),document.addEventListener("mousemove",(function(e){s=!1,w(e)})),document.addEventListener("mouseup",M),"onwheel"in window?e.addEventListener("wheel",C):(e.addEventListener("mousewheel",C),e.addEventListener("DOMMouseScroll",C))};var SMALL_WIDTH=600,SMALL_HEIGHT=360;longdo.UiPosition={Left:!1,Right:!0},longdo.UiComponent={Full:"FULL",Compact:"COMPACT",Mobile:"MOBILE",None:!1},longdo.UiCollection=function(e,n,t,o){var a=this,i="th",r=e.placeholder(),l=null,s=!1,d=null;function u(){r.offsetWidth==(window.innerWidth||document.documentElement.offsetWidth)&&a.Fullscreen.visible(!1)}a.resize=function(){if(s)return a.Zoombar.visible()&&(r.offsetHeight<SMALL_HEIGHT?a.Zoombar instanceof longdo.Zoombar&&(l.removeChild(a.Zoombar.element()),a.Zoombar=new longdo.ZoombarMini(l,e)):a.Zoombar instanceof longdo.ZoombarMini&&(l.removeChild(a.Zoombar.element()),a.Zoombar=new longdo.Zoombar(l,e))),a},a.language=function(e){return null==e?i:(i="th"==e.substring(0,2)?"th":"en",a.Geolocation&&a.Geolocation.language(e),a.LayerSelector&&a.LayerSelector.language(e),a.Legend&&a.Legend.language(e),a.Toolbar&&a.Toolbar.language(e),a)},a.add=function(n,t){if(!(n instanceof LongdoControl))throw"Not control";return a.TopRight.insertBefore(n.element(),t?a.TopRight.lastChild:a.TopRight.firstChild),n.map&&n.map(e),a},a.remove=function(e){try{a.TopRight.removeChild(e.element())}finally{return a}},a.updateStyle=function(){return a.TopRight.style.marginLeft=a.TopLeft.offsetWidth+56+"px",a.Fullscreen&&a.Fullscreen.visible&&u(),a},a.enableTouchMeasure=function(n){return $.loadScript(server.map+"/js/touchMeasure.js",(function(){longdo.touchMeasure(e,n)})),a},a.lockMap=function(){if(null===d){var e=$.append(r,"div",{className:"ldmap_lock_overlay"});$.append(r,"button",{className:"ldmap_lock_button",innerHTML:"Activate"}).addEventListener("click",(function(n){d?(e.style.display="none",n.target.innerHTML="Deactivate",d=!1):(e.style.display="block",n.target.innerHTML="Activate",d=!0)})),d=!0}},a.TopLeft=null,a.TopRight=null,a.BottomLeft=null,a.BottomRight=null,a.DPad=null,a.Geolocation=null,a.Zoombar=null,a.Toolbar=null,a.LayerSelector=null,a.Fullscreen=null,a.Scale=null,a.Legend=null,a.Notice=null,a.ContextMenu=null,a.Tooltip=null,a.FloorSelector=null,a.Crosshair=null,a.Keyboard=null,a.Mouse=null,r.addEventListener("contextmenu",(function(e){for(var n=e.target;n&&!$.hasClass(n,"ldmap_selectable");)n=n.parentElement;n||e.preventDefault()})),l=$.append(r,"div",{className:"ldmap_navigation ldmap_maparea"}),a.TopLeft=$.append(r,"div",{className:"ldmap_topleft ldmap_maparea"}),a.TopRight=$.append(r,"div",{className:"ldmap_topright ldmap_maparea"}),a.BottomLeft=$.append(r,"div",{className:"ldmap_bottomleft ldmap_maparea"}),a.BottomRight=$.append(r,"div",{className:"ldmap_bottomright ldmap_maparea"});var c=(innerWidth||document.documentElement.offsetWidth)<SMALL_WIDTH,m=r.offsetWidth>0&&r.offsetWidth<SMALL_WIDTH;if(t==longdo.UiComponent.Mobile?(c=!0,m=!0):t==longdo.UiComponent.Full&&(c=!1,m=!1),t!==longdo.UiComponent.None){var p,f={language:function(){},visible:function(){},rangeToggle:function(){}};c?(a.DPad=f,a.Geolocation=navigator.geolocation?new longdo.Geolocation(l,e):f,a.Zoombar=new longdo.ZoombarMini(l,e),a.Toolbar=f,a.popup=new longdo.PopupMini(r,e)):(a.DPad=new longdo.DPad(l,e),a.Geolocation=navigator.geolocation?new longdo.Geolocation(l,e):f,a.Zoombar=r.offsetHeight<SMALL_HEIGHT?new longdo.ZoombarMini(l,e):new longdo.Zoombar(l,e),a.Toolbar=new longdo.Toolbar(a.TopLeft,e),s=!0),t==longdo.UiComponent.Compact?p="dropdown":m&&(p="button"),a.LayerSelector=new longdo.LayerSelector(a.TopRight,e,p),a.Fullscreen=new longdo.Fullscreen(a.TopRight,e),u(),a.Scale=new longdo.Scale(a.BottomLeft),a.ContextMenu=new longdo.ContextMenu(r,e),a.Tooltip=new longdo.Tooltip(r,e),a.FloorSelector=new longdo.FloorSelector(a.BottomRight,e),a.Legend=m?f:new longdo.Legend(a.BottomRight,e)}a.Notice=new longdo.Notice(a.BottomRight,m),a.Crosshair=new longdo.Crosshair(r,c),!1!==o&&(a.Keyboard=new longdo.Keyboard(r,e,n),a.Mouse=new longdo.Mouse(r,e,n))};var PAINT_DELAY=5,LOAD_DELAY=100,POPUP_FOCUS_BUFFER=5;function LongdoRenderer(e,n,t){var o=this,a=e.placeholder(),i=e.projection(),r=0,l=0,s=null,d=null,u=null,c=!1,p=null,f={u:0,v:0},g=null,v=null,h=null,y=null,T=null,b=null,L=0,E=null,_={x:0,y:0},x=null,O=0,I=1,w=null,M=0,C=0,A=null,R=null,P=null,N=null,k=[function(e,n){return n*f.u+f.u-e},function(e,n){return e*f.v+n+1},function(e,n){return(f.v-n-1)*f.u+e+1},function(e,n){return(f.u-e-1)*f.v+f.v-n}];function S(){I=1,$.empty(d),v=[];for(var e=0;e<f.v;++e){v[e]=[];for(var n=0;n<f.u;++n){var t=$.append(d,"div",{className:"ldmap_tile"});v[e][n]={holder:t,map:$.append(t,"div",{className:"ldmap_tile"}),element:$.append(d,"div",{className:"ldmap_tile_element"})}}}}var D=function(e){e&&e.clearRect(0,0,e.canvas.width,e.canvas.height)};function z(){for(var e=(y.x>>y.z)-p.x-l,n=(y.y>>y.z)-p.y-l;e<0;)e+=i.maxPointX>>y.z;return E={u:e>>TILEEXP,v:n>>TILEEXP,w:y.z},{x:e,y:n,z:y.z}}function H(){x={x:(E.u<<TILEEXP)-l,y:(E.v<<TILEEXP)-l,z:y.z}}function G(e){return{x:x.x-e.x,y:x.y-e.y}}function F(){(y=n.getCenter()).x=$.bound(y.x,0,i.maxPointX),y.y=$.bound(y.y,0,i.maxPointY),n.setCenter(y),T=1<<i.maxZoom-y.z,b=i.ratio*T,L=Math.ceil(v[0].length/(T<<1))-1;var e=z();if(y.z-x.z)B(e);else{var t=v.length<<TILEEXP;if(_.x>t-TILESIZE||_.x<=-t)B(e);else if(t=v[0].length<<TILEEXP,_.y>t-TILESIZE||_.y<=-t)B(e);else{_=G(e);var o=-l,a=-TILESIZE-l;if(_.x>o)do{for(var r=0;d=v[r];++r){var s=d.pop();d.unshift(s),X(s)}U(-TILESIZE)}while(_.x>o);else if(_.x<=a)do{for(r=0;d=v[r];++r)s=d.shift(),d.push(s),X(s);U(TILESIZE)}while(_.x<=a);if(_.y>o)do{var d=v.pop();v.unshift(d);for(var u=0;u<d.length;++u)X(d[u]);W(-TILESIZE)}while(_.y>o);else if(_.y<=a)do{for(d=v.shift(),v.push(d),u=0;u<d.length;++u)X(d[u]);W(TILESIZE)}while(_.y<=a)}}}function U(e){_.x+=e,x.x+=e}function W(e){_.y+=e,x.y+=e}function Y(e){e.w=void 0}function X(e){e.w=void 0,D(e.geometry)}function B(e){for(var n=e?X:Y,t=0;t<f.v;++t)for(var o=0;o<f.u;++o)n(v[t][o]);e&&(H(),_=G(e))}function Z(e){j(),c&&($.isAbsInRange(c.u-E.u,f.u-1)&&$.isAbsInRange(c.v-E.v,f.v-1)?u.style.transform="translate3d("+(_.x+c.x+(c.u-E.u<<TILEEXP))+"px, "+(_.y+c.y+(c.v-E.v<<TILEEXP))+"px, 0px) scale("+c.s+")":o.clearBackFrame());for(var n=[],t=k[C],a=0;a<f.v;++a)for(var i=0;i<f.u;++i){var r=v[a][i],l={x:i<<TILEEXP,y:a<<TILEEXP};if($.translate(r.holder,l),$.translate(r.element,l),r.element.style.zIndex=t(i,a),null==r.w){var s=E.v+a;if(s<0||s>=b)$.append(r.map,"div",{className:"ldmap_tile_offworld"});else{r.ux=E.u+i,r.u=r.ux%T,r.u<0&&(r.u+=T),r.v=s,r.w=E.w;var d=Math.abs(i-g.u)+Math.abs(a-g.v);n[d]||(n[d]=[]),n[d].push(r)}}}if(n.length)for(i=0;i<n.length;++i){var m=n[i];if(m){if(m[0].w!=E.w)return;for(a=0;r=m[a];++a)e&&"M"!=e||setTimeout(ee,i,r),K(e,r,LOAD_DELAY+n.length)}}}function j(){$.transformOrigin(d,{x:w.x-_.x,y:w.y-_.y}),$.transform(d,"scale",I,_)}function K(n,t,o){switch(n){case void 0:case"C":q(t,C),V(t,C),o&&setTimeout(e.Tags.load,o,t);case"G":!function(n){var t=n.w,o=n.u<<t,a=n.v<<t,i=Math.ceil((e.Overlays.maxGeometrySize<<t)/TILESIZE),l=(1<<t)+i,s=e.Overlays.geometry(o-i,a-i,o+l,a+l,t);if(s.length){n.geometry||function(e){var n=(e.overlay?$.prepend:$.append)(e.holder,"canvas",{className:"ldmap_tile_canvas ldmap_maparea"},e.holder.lastChild);n.width=n.height=TILESIZE<<r;var t=n.getContext("2d");t.globalCompositeOperation="copy",t.lineCap=t.lineJoin="round",e.geometry=t}(n);var d=-n.u<<TILEEXP,u=-n.v<<TILEEXP;n.lineWidth=0;for(var c,m=s.length-1;c=s[m];--m){var p=c.value;p.borderColor&&Q(n,d,u,t,{lineWidth:p.totalWidth,lineColor:p.borderColor,lineStyle:p.lineStyle,linePattern:p.linePattern},c.extra,c.bound),Q(n,d,u,t,p,c.extra,c.bound)}n.geometry.drawImage(P,0,0),D(N)}else D(n.geometry)}(t);break;case"O":q(t,C),o&&setTimeout(e.Tags.load,o,t);break;case"E":V(t,C);break;case"F":$.addClass(t.element,"ldmap_tile_top");break;case"B":$.removeClass(t.element,"ldmap_tile_top")}}function V(n,t){$.empty(n.element);var o=n.w;if(n.ux>>i.maxZoom-o==L){var r=n.u<<o,l=n.v<<o,s=1<<o,d=e.Overlays.element(r,l,r+s-1,l+s-1,o,t);if(d.length){for(var u=-n.u<<TILEEXP,c=-n.v<<TILEEXP,m=document.createDocumentFragment(),p=d.length-1;p>=0;--p)m.appendChild(d[p].value.element());var f;for(n.element.appendChild(m),p=0;f=d[p];++p){var g=f.value,v=f.extra,h=g.element(),y=g.offset()||g.getElementOffset(),T={x:(v.x>>o)+u-y.x,y:(v.y>>o)+c-y.y},b=void 0===g.rotate?-M:g.rotate;if(b?($.transformOrigin(h,y),$.transform(h,"rotate",b+"rad",T)):$.translate(h,T),g.autoFit&&(g.fit(),delete g.autoFit),g.autoFocus){var E=g;delete E.autoFocus}}E&&function(n){var t=n.element().firstChild.getBoundingClientRect(),o=a.getBoundingClientRect(),i=e.Ui?e.Ui.TopRight.offsetHeight:0,r=Math.max(t.right-o.right+POPUP_FOCUS_BUFFER,0),l=Math.min(t.top-o.top-POPUP_FOCUS_BUFFER-i,0);(r||l)&&e.move({x:r,y:l})}(E)}}}function q(n,t){var o=n.w,a=n.u<<o,i=n.v<<o,l=Math.ceil((e.Overlays.maxImageSize<<o)/TILESIZE),s=(1<<o)+l,d=e.Overlays.image(a-l,i-l,a+s,i+s,o,t);if(d.length){n.overlay||function(e){var n=$.append(e.holder,"canvas",{className:"ldmap_tile_canvas ldmap_maparea"});n.width=n.height=TILESIZE<<r;var t=n.getContext("2d");t.globalCompositeOperation="copy",e.overlay=t}(n);for(var u,c=-n.u<<TILEEXP,m=-n.v<<TILEEXP,p=d.length-1;u=d[p];--p)J(c,m,o,u.value,u.extra);n.overlay.drawImage(A,0,0),D(R)}else D(n.overlay)}function J(e,n,t,o,a){var i=o.element();i.overwrite&&i.overwrite[t]&&(i=i.overwrite[t]);var r=i.offset;if(r){var l=i.width>>o.hd,s=i.height>>o.hd,d=void 0===o.rotate?-M:o.rotate;d?(R.save(),R.translate((a.x>>t)+e,(a.y>>t)+n),R.rotate(d),R.drawImage(i,-r.x,-r.y,l,s),R.restore()):R.drawImage(i,(a.x>>t)+e-r.x,(a.y>>t)+n-r.y,l,s)}else setTimeout(J,LOAD_DELAY,e,n,t,o,a)}function Q(e,n,t,o,a,i,r){if(N.save(),a.lineStyle&&N.setLineDash(a.lineStyle),N.beginPath(),a instanceof longdo.Circle){var l=i[0];N.arc((l.x>>o)+n,(l.y>>o)+t,Math.max(i[1]>>o,.1),0,PI2,!0),a.fillColor&&(N.fillStyle=a.fillColor,N.fill())}else{var s=((l=i[0]).x>>o)+n,d=(l.y>>o)+t;if(a.texture){a.textureAlpha<1&&(N.globalAlpha=a.textureAlpha);var u=(i[2].x>>o)+n,c=(i[2].y>>o)+t;N.drawImage(a.texture,s,d,u-s,c-d),a.textureAlpha<1&&(N.globalAlpha=1)}if(N.moveTo(s,d),a instanceof longdo.Dot||r.minX>>o==r.maxX>>o&&r.minY>>o==r.maxY>>o)N.lineTo(s+.1,d+.1);else if(a instanceof longdo.Polycurve)for(var m=1;m<i.length;m+=3){l=i[m];var p=i[m+1],f=i[m+2];N.bezierCurveTo((l.x>>o)+n,(l.y>>o)+t,(p.x>>o)+n,(p.y>>o)+t,(f.x>>o)+n,(f.y>>o)+t)}else if(a.linePattern)for(m=1;l=i[m];++m)!0===l?(s=((l=i[++m]).x>>o)+n,d=(l.y>>o)+t):(u=(l.x>>o)+n,c=(l.y>>o)+t,a.linePattern(N,m,s,d,u,c),s=u,d=c);else for(m=1;l=i[m];++m)!0===l?(l=i[++m],N.moveTo((l.x>>o)+n,(l.y>>o)+t)):N.lineTo((l.x>>o)+n,(l.y>>o)+t);a instanceof longdo.Polygon&&a.fillColor&&(N.fillStyle=a.fillColor,N.fill())}a.lineColor&&(N.lineWidth=a.lineWidth,a.lineWidth>e.lineWidth&&(e.lineWidth=a.lineWidth),N.strokeStyle=a.lineColor,N.stroke()),N.restore()}function ee(n){$.empty(n.map);for(var t,o=function(){if(!(l=t.image(i,n,r)))return"continue";O++||e.Event.fire("loadTile","start");var o=$.append(n.map,"img",{className:"ldmap_tile_canvas ldmap_maparea",src:l,onload:function(){ne(),this.style.opacity=this.opacity},onerror:function(){ne(),this.style.opacity=0},opacity:t.opacity,alt:"Map tile"});if(l==NODATA){var a=t;setTimeout((function(){o.src=a.image(i,n,r,!0)}),0)}},a=0;t=h[a];++a){var l;o()}}function ne(){--O||setTimeout(e.Event.fire,PAINT_DELAY,"loadTile","finish")}o.resize=function(){p={x:a.offsetWidth>>1,y:a.offsetHeight>>1},M&&$.transformOrigin(s,p),w||(w=p),y=n.getCenter(),z();var t=x;H();var i=2+(a.offsetWidth+l+l-2>>TILEEXP),r=2+(a.offsetHeight+l+l-2>>TILEEXP);return f&&i==f.u&&r==f.v||(f={u:i,v:r},g={u:i-1>>1,v:r-1>>1},h=e.Layers.list(),S()),o.repaint(!t||x.x!=t.x||x.y!=t.y)},o.repaint=function(n){if(!E)return o;if(n)if("M"==n)h=e.Layers.list(),B(),o.clearBackFrame(),Z("M");else if(n instanceof longdo.Layer){for(var t,a=0;t=h[a];++a)if(n==t){for(var l=0;l<f.v;++l)for(var s=function(){if(m=v[l][d],!(u=t.image(i,m,r)))return"continue";var e=new Image;e.onload=function(){e.updateTo.src=e.src},e.updateTo=m.map.children[a],e.src=u},d=0;d<f.u;++d){var u;s()}break}}else if("O"==n||"E"==n||"G"==n||"C"==n)B(),Z(n);else if(n.w==E.w){var c=v[n.v-E.v];if(c)for(var m,p=n.u-E.u;m=c[p];p+=T)K(n.mode,m)}else!0===n&&(B(z()),F(),Z());else F(),Z();return e.Ui.Scale&&e.Ui.Scale.repaint(i,y),e.Ui.ContextMenu&&e.Ui.ContextMenu.visible(!1),o},o.scale=function(e,n){if(I=e,M&&n){var t=m.rotateVector({x:n.x-p.x,y:n.y-p.y},M);w={x:t.x+p.x,y:t.y+p.y}}else w=n||p;return j(),o},o.camera=function(e,n){return M=e,C=$.radianToDir(M),$.transformOrigin(s,p),$.transform(s,"rotate",M+"rad",{x:0,y:0}),l&&M?o.repaint("C"):(l=M?Math.ceil(Math.max(f.u,f.v)/5)<<TILEEXP:0,o.resize())},o.removeElement=function(e,n){if(n.w!=E.w)return o;var t=v[n.v-E.v];if(!t)return o;for(var a,i=n.u-E.u;a=t[i];i+=T)try{return a.element.removeChild(e),o}catch(e){}return o},o.hitGeometry=function(e){if(M)var n=m.rotateVector({x:e.x-p.x,y:e.y-p.y},M),t=n.x+p.x-_.x,o=n.y+p.y-_.y;else t=e.x-_.x,o=e.y-_.y;var a=v[o>>TILEEXP][t>>TILEEXP];return!(!a.geometry||!a.geometry.getImageData(t%TILESIZE<<r,o%TILESIZE<<r,1,1).data[3])&&a.lineWidth},o.switchFrame=function(){for(var e=0;e<f.v;++e)for(var n=0;n<f.u;++n){var a=v[e][n];a.element&&d.removeChild(a.element),a.overlay&&a.holder.removeChild(a.holder.lastChild),a.geometry&&a.holder.removeChild(a.holder.lastChild)}var i=u;if(u=d,(d=i).style.zIndex=1,u.style.zIndex=0,S(),c=!1,o.repaint(),!1===t)return setTimeout((function(){$.empty(u)}),PAINT_DELAY),o;var r=!1,l=!1;if(!d.style.transform)return c=!0,o;r=d.style.transform,l=u.style.transform;var s=r.match(/translate3d\((-?\d+)px(, (-?\d+)px, 0px)?\)/),m=l.match(/translate3d\((-?\d+)px(, (-?\d+)px, 0px)?\) scale\((\d*.?\d+)\)/);return c={x:m[1]-s[1],y:m[3==m.length?1:3]-s[2==s.length?1:3],s:m[m.length-1],u:E.u,v:E.v},o},o.clearBackFrame=function(){return c&&($.empty(u),c=!1),o},o.loadingTile=function(){return O},r=$.isHD(),s=$.append(a,"div",{className:"ldmap_frameholder"}),(d=$.append(s,"div",{className:"ldmap_frame"})).style.zIndex=1,(u=$.append(s,"div",{className:"ldmap_frame"})).style.zIndex=0;var te={className:"ldmap_backbuffer",width:TILESIZE<<r,height:TILESIZE<<r};if(A=$.append(a,"canvas",te),P=$.append(a,"canvas",te),R=A.getContext("2d"),N=P.getContext("2d"),r){var oe=1<<r;R.scale(oe,oe),N.scale(oe,oe)}N.lineCap=N.lineJoin="round",o.resize()}longdo.Event=function(e){var n=this,t={ready:[],beforeResize:[],resize:[],repaint:[],zoom:[],zoomRange:[],locationAnimationBegin:[],location:[],fullscreen:[],rotate:[],pitch:[],suggest:[],search:[],address:[],nearPoi:[],toolbarChange:[],clearMeasure:[],tooltipChange:[],beforeContextmenu:[],contextmenu:[],mousemove:[],click:[],doubleClick:[],wheel:[],pinch:[],pinchEnd:[],drag:[],drop:[],idle:[],layerChange:[],loadTile:[],overlayChange:[],overlaySelect:[],overlayClick:[],overlayLoad:[],overlayDrag:[],beforeOverlayDrop:[],overlayDrop:[],overlayMove:[],overlayHover:[],overlayLeave:[],pathAnimationEnd:[],popupLoadDetail:[],popupClose:[],guideError:[],guideComplete:[],pathError:[],pathComplete:[],beforeGeolocation:[],geolocation:[],geolocationError:[],connectionError:[]},o=!1;n.bind=function(e,o){var a=t[e];if(!a)throw"Unsupported event";return a.indexOf(o)<0&&a.push(o),n},n.unbind=function(e,o){var a=t[e];if(!a)return n;var i=a.indexOf(o);return i>=0&&a.splice(i,1),n},n.fire=function(e,n){if(!o){for(var a=t[e],i=!1,r=0;r<a.length;++r)i=i||!1===a[r](n);return!i}},n.pause=function(e){return null==e?o:(o=e,n)},n.bindAll=function(e,o){if(console){var a=n.fire;n.fire=function(e,n){return t[e].length&&console.log(e,n),a(e,n)}}for(var i in t)o.indexOf(i)<0&&n.bind(i,e);return n},n.register=function(e){return t[e]||(t[e]=[]),n}};var searchTheme={searchLabel:{th:{load:"กำลังค้นหา...",zoom:"ซูมไปยังสถานที่นี้",empty:"ไม่พบผลลัพธ์การค้นหา",more:"เพิ่มเติม"},en:{load:"Loading...",zoom:"Zoom to this location",empty:"No result found",more:"more"}},zoomIcon:$.getImage("search/zoom"),zoomResult:14,showRegion:!0,showRoad:cap.vector,showLayer:!0};longdo.MapTheme.search=searchTheme;var poiTheme={addressIcon:$.getImage("search/address"),telIcon:$.getImage("search/tel"),openIcon:$.getImage("search/open"),urlIcon:$.getImage("search/url"),lineIcon:$.getImage("search/line"),tagIcon:$.getImage("search/tag"),tagCount:0,poiLabel:{th:{open:"เปิดให้บริการวันนี้ ",close:"ปิดบริการ",after:"นอกเวลาทำการ ",detail:"รายละเอียด",edit:"แก้ไข",unverified:$.getImage("search/unverified-th"),obsoleted:$.getImage("search/obsoleted-th")},en:{open:"Open today ",close:"Closed",after:"Open at ",detail:"detail",edit:"edit",unverified:$.getImage("search/unverified-en"),obsoleted:$.getImage("search/obsoleted-en")}}};function _createForOfIteratorHelper(e,n){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=tagcollection_unsupportedIterableToArray(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var o=0,a=function(){};return{s:a,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r=!0,l=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return r=e.done,e},e:function(e){l=!0,i=e},f:function(){try{r||null==t.return||t.return()}finally{if(l)throw i}}}}function tagcollection_unsupportedIterableToArray(e,n){if(e){if("string"==typeof e)return tagcollection_arrayLikeToArray(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?tagcollection_arrayLikeToArray(e,n):void 0}}function tagcollection_arrayLikeToArray(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,o=new Array(n);t<n;t++)o[t]=e[t];return o}longdo.MapTheme.poi=poiTheme,longdo.Search=function(e,n){var t=this,o={G:"polygon",K:"area",L:"road",T:"tag",W:"water",X:"water",Y:"layer"},a="th",i=searchTheme.searchLabel[a],r=null,l="ldsearch"+e.id()+"-",s=null,d=null,u=null;function c(n){n||e.Event.fire("connectionError","search")}function m(n){if(r){var a=n.meta.start;if(a){var c=r.firstChild;n.meta.hasmore?(r.lastChild.innerHTML=i.more,r.lastChild.onclick=function(){this.innerHTML=i.load,s.offset=n.meta.end+1,s.limit=n.meta.end-a+1,e.Search.search(n.meta.keyword,s)}):r.removeChild(r.lastChild)}else{a=0;var m=document.createDocumentFragment();c=$.append(m,"ol",{className:"ldsearch_list"}),n.data.length?n.meta.hasmore&&$.append(m,"div",{className:"ldsearch_more",innerHTML:i.more,onclick:function(){this.innerHTML=i.load,s.offset=n.meta.end+1,s.limit=n.meta.end-a+1,e.Search.search(n.meta.keyword,s)}}):$.append(m,"div",{className:"ldsearch_empty",innerHTML:i.empty}),d=[]}for(var g,v=[],h=0;g=n.data[h];++h){var y=a+h,T=g.id[0];if(g.icon)var b=server.icon+"/"+g.icon;else b=(b=o[T])?$.getFile("search/type-"+b+".png"):server.icon+"/reddot.png";var L=$.append(c,"li",{className:"ldsearch_item",innerHTML:'<img class="ldsearch_icon" src="'+b+'" alt="" />',id:l+"i"+y});"T"!=T&&$.append(L,"img",{className:"ldsearch_zoom",src:searchTheme.zoomIcon,title:i.zoom,alt:"Zoom"}),L.innerHTML+=g.name+'<div class="ldsearch_address">'+(g.address||"&nbsp;")+"</div>",L.addEventListener("click",p),d.push(g),!1===u.icon||"T"==T||("G"==T||"K"==T||"W"==T||"X"==T)&&searchTheme.showRegion||"L"==T&&searchTheme.showRoad||"Y"==T&&searchTheme.showLayer||(v.push(g),g.marker=new longdo.Marker(g,!1===t.popup?{title:g.name,clickable:!0}:{title:g.name,detail:'<div id="'+l+"d"+y+'" class="ldmap_poi_load">Loading...</div>',icon:u.icon,loadDetail:f}),g.marker.type="s",g.marker.index=d.length,g.marker.data=g,e.Overlays.add(g.marker))}a||($.empty(r).appendChild(m),v.length&&e.bound($.locationBound(v)))}}function p(n){$.hasClass(n.target,"ldsearch_zoom")&&e.zoom()<searchTheme.zoomResult&&e.zoom(searchTheme.zoomResult);var t=d[n.currentTarget.id.substring(l.length+1)],o=t.id[0];if("T"!=o)if(e.location(t,!0),t.marker)e.Overlays.pop(t.marker,!0);else{if(!t.popup){var a={title:t.name,detail:t.address};"L"==o&&searchTheme.showRoad?t.object=new longdo.Overlays.Object(t.id.substring(1),"RID",a):"Y"==o&&searchTheme.showLayer?t.object=new longdo.Overlays.Object(t.id,"LONGDO"):searchTheme.showRegion&&("G"==o?t.object=new longdo.Overlays.Object(t.id,"LONGDO"):"K"==o?t.object=new longdo.Overlays.Object(t.address.split(" ")[1],"IG",a):"W"!=o&&"X"!=o||(t.object=new longdo.Overlays.Object(t.id,o+"ID"))),t.popup=new longdo.Popup(t,a)}t.object&&e.Overlays.load(t.object),e.Overlays.add(t.popup)}else e.Tags.set(t.name.substring(5))}function f(n){var t=$.formatPoi(d[n.firstChild.id.substring(l.length+1)],a,e.Ui.popup);$.empty(n).appendChild(t)}t.language=function(e){return null==e?a:(a="th"==e.substring(0,2)?"th":"en",i=searchTheme.searchLabel[a],t)},t.placeholder=function(e,n){return null==e?r:(r=e,u=n||{},$.addClass(r,"ldsearch_placeholder"),t)},t.suggest=function(n,o){var a="";return(o=o||{}).area&&(a+="&area="+o.area),o.offset&&(a+="&offset="+o.offset),o.limit&&(a+="&limit="+o.limit),o.dataset&&(a+="&dataset="+o.dataset),$.loadScript(server.search+"/json/suggest?keyword="+encodeURIComponent(n)+a+"&key="+apikey+"&version=2&callback=longdo.callback.suggest"+e.id()),t},t.search=function(n,o){!(s=o||{}).offset&&r&&(t.clear(),r.innerHTML='<div class="ldsearch_load">'+i.load+"</div>");var l=e.location(),d="&lon="+l.lon+"&lat="+l.lat;return n&&(d+="&keyword="+encodeURIComponent(n)),s.area&&(d+="&area="+s.area),s.tag&&(d+="&tag="+s.tag),s.span&&(d+="&span="+s.span),s.offset&&(d+="&offset="+s.offset),s.limit&&(d+="&limit="+s.limit),s.dataset&&(d+="&dataset="+s.dataset),$.loadScript(server.search+"/json/search?locale="+a+d+"&key="+apikey+"&version=2&callback=longdo.callback.search"+e.id(),c),t},t.address=function(n,o){o=o||{};var i=server.address;return n.lon&&n.lat?i+="?lon="+n.lon+"&lat="+n.lat:9==n.length&&isFinite(n.substring(1))?i+="?id="+n:i=n.length<=6&&isFinite(n)?server.poi+"/json/address?"+(5==n.length?"postcode=":"geocode=")+n:server.poi+"/json/geocoding?address="+n,o.limit&&(i+="&limit="+o.limit),o.dataset&&(i+="&dataset="+o.dataset),$.loadScript(i+"&locale="+a+"&key="+apikey+"&callback=longdo.callback.address"+e.id(),c),t},t.nearPoi=function(n,o){o=o||{};var i=server.poi+"/json/search?lon="+n.lon+"&lat="+n.lat;return o.span&&(i+="&span="+o.span),o.zoom&&(i+="&zoom="+o.zoom),o.limit&&(i+="&limit="+o.limit),$.loadScript(i+"&locale="+a+"&key="+apikey+"&status=A,N&callback=longdo.callback.nearPoi"+e.id(),c),t},t.clear=function(){if(!r||!d)return t;var n="O",o=e.pause();e.pause(!0);for(var a,i=0;a=d[i];++i)e.Overlays.remove(a.marker),a.object&&(e.Overlays.unload(a.object),e.Overlays.remove(a.popup),n="layer"==a.type||"C");return e.pause(o).repaint(n),$.empty(r),t},this.enablePopup=function(e){return null==e?t.popup||!1:(t.popup=e,t)},n?t.setResult=m:(longdo.callback["suggest"+e.id()]=function(n){e.Event.fire("suggest",n)},longdo.callback["search"+e.id()]=function(n){m(n),e.Event.fire("search",n)},longdo.callback["address"+e.id()]=function(n){e.Event.fire("address",n)},longdo.callback["nearPoi"+e.id()]=function(n){e.Event.fire("nearPoi",n)})};var TAG_RANGE={min:4,max:99},LABEL_RANGE={min:99,max:98},OFFSET_WAIT=50,s="1px %23fff",tagTheme={labelStyle:{default:"font: 12px/1.4 sans-serif; color: %235d5d5d; text-shadow: -1px -"+s+", 1px -"+s+", -1px "+s+", 1px "+s+";"},labelSize:{x:-4,y:9,width:200,height:16,font:"12px sans-serif"}};longdo.MapTheme.tag=tagTheme,longdo.TagCollection=function(e){var n=this,t=!1,o="th",a=e.projection(),i="ldtag"+e.id()+"-",r={},l=0,s=[],d={},u={},c={},m=null;function p(){u={};var n="O",o=e.pause();for(var a in e.pause(!0),c){var i=c[a];i.overlayType?(e.Overlays.unload(i),n="C"):e.Overlays.remove(i)}c={},t&&(longdo.callback[t]=$.noop),t="tag"+ ++longdo.objectcount,l&&(longdo.callback[t]=f),e.pause(o).repaint(n)}function f(n){if(l&&n.data.length){var t=r[n.meta.config],i={min:n.meta.z,max:t?t.visibleRange.max:a.maxZoom},s=n.meta.iconpath||server.icon,d=n.meta.iconpathhd||server.icon+"_2x",u=e.pause();e.pause(!0);for(var m,p=!1,f=[],v=0;m=n.data[v];++v){var y=m.id[0];if("G"==y||"Y"==y){if(c[m.id])continue;var T=new longdo.Overlays.Object(m.id,"LONGDO");c[m.id]=T,e.Overlays.load(T)}else{var b="blank.png"==m.icon||m.icon.endsWith("/blank.png"),L=c[m.id];if(L){if(L.visibleRange().min<=i.min){!m.label||c[m.id+"L"]||b||(L.data=m,f.push(L));continue}e.Overlays.remove(L)}var E=m.icon.indexOf("custom:")?m.icon.indexOf("big/")?m.icon.indexOf("small/")?{url:s+"/"+m.icon,urlHD:d+"/"+m.icon}:{url:s+"_"+m.icon,urlHD:s+"_big"+m.icon.substring(5)}:{url:s+"_"+m.icon,urlHD:s+"_3x"+m.icon.substring(3)}:r[m.icon.substring(7)].icon;if(b){var _=m.name[0]<"0"||m.name[0]>"9"?-1:m.name.indexOf("th"==o?" ":",");E={url:g(_>0?m.name.substring(0,_):m.name,m.icon,"center")}}else if(t&&t.visibleRange.overwrite){var x={small:"_big",big:"_3x"};for(var O in i.overwrite={},t.visibleRange.overwrite){var I=t.visibleRange.overwrite[O];"default"==I&&x[t.icon]?i.overwrite[O]={url:E.url.replace("_"+t.icon,""),urlHD:E.urlHD.replace(x[t.icon],"_2x")}:x[I]?t.icon?x[t.icon]&&(i.overwrite[O]={url:E.url.replace("_"+t.icon,"_"+I),urlHD:E.urlHD.replace(x[t.icon],x[I])}):i.overwrite[O]={url:E.url.replace(s,s+"_"+I),urlHD:E.urlHD.replace("_2x",x[I])}:i.overwrite[O]=I}}var w=new longdo.Marker(m,{icon:E,visibleRange:i,clickable:!0});w.type="t",w.svg=b,w.data=m,n.meta.detailpath&&(m.detailpath=n.meta.detailpath),b||(e.Overlays.add(w),c[m.id]=w),m.label&&f.push(w),p=!0}}e.pause(u),p&&e.Overlays.repaint("O"),f.length&&setTimeout(h,OFFSET_WAIT,n.meta,f,{min:n.meta.z,max:t?t.label.max:a.maxZoom})}}function g(e,n,t,o){return'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="'+v(e)+'" height="'+tagTheme.labelSize.height+'"><foreignObject width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="'+(tagTheme.labelStyle[n]||tagTheme.labelStyle.default)+" text-align: "+t+'">'+encodeURIComponent(e)+"</div></foreignObject></svg>"}function v(e){return Math.min(Math.ceil(m.measureText(e).width)+2,tagTheme.labelSize.width)}function h(n,t,o){var i,r=_createForOfIteratorHelper(t);try{for(r.s();!(i=r.n()).done;)if(!i.value.offset())return void setTimeout(h,OFFSET_WAIT,n,t,o)}catch(e){r.e(e)}finally{r.f()}var l,s=[],d=a.maxZoom-n.z,u=1<<d,c=n.x<<d,m=n.y<<d,p=_createForOfIteratorHelper(e.Overlays.image(c-u,m,c+u+u-1,m+u-1,d));try{for(p.s();!(l=p.n()).done;){var f=l.value;if("t"==f.value.type){var g=f.value.hasIcon?b(f.extra,d,f.value.data.name):L(f.extra,d,f.value.offset());s.push(g)}}}catch(e){p.e(e)}finally{p.f()}var v=e.pause();e.pause(!0);var E,_=_createForOfIteratorHelper(t);try{for(_.s();!(E=_.n()).done;){var x=E.value;2==x.data.label&&(s.push(y(x,d,[])),T(x,o))}}catch(e){_.e(e)}finally{_.f()}var O,I=_createForOfIteratorHelper(t);try{for(I.s();!(O=I.n()).done;){var w=O.value;1==w.data.label&&y(w,d,s)&&T(w,o)}}catch(e){I.e(e)}finally{I.f()}e.pause(v).Overlays.repaint("O")}function y(e,n,t){var o,i=$.locationToPoint(a,e.location()),r=e.offset(),l=e.svg?L(i,n,r):b(i,n,e.data.name,r),s=_createForOfIteratorHelper(t);try{for(s.s();!(o=s.n()).done;){var d=o.value;if(l.minX<=d.maxX&&l.maxX>=d.minX&&l.minY<=d.maxY&&l.maxY>=d.minY)return!1}}catch(e){s.e(e)}finally{s.f()}return t.push(l),l}function T(n,t){if(n.svg)return e.Overlays.add(n),void(c[n.data.id]=n);var o=c[n.data.id+"L"];o&&e.Overlays.remove(o);var a=new longdo.Marker(n.data,{icon:{url:g(n.data.name,n.data.icon,"left"),offset:{x:tagTheme.labelSize.x-n.offset().x,y:tagTheme.labelSize.y}},visibleRange:t,clickable:!0});a.type="t",a.svg=!0,a.hasIcon=!0,a.data=n.data,c[n.data.id+"L"]=a,e.Overlays.add(a)}function b(e,n,t,o){var a=e.x+((o?o.x-tagTheme.labelSize.x:12)<<n),i=tagTheme.labelSize.y-2<<n;return{minX:a,minY:e.y-i,maxX:a+(v(t)<<n),maxY:e.y+i}}function L(e,n,t){var o=t.x+1<<n,a=t.y+1<<n;return{minX:e.x-o,minY:e.y-a,maxX:e.x+o,maxY:e.y+a}}function E(t){!1!==n.popup&&"t"==t.type&&(n.pop(t.data),e.Overlays.floorPlan(t))}function _(n){n||e.Event.fire("connectionError","tags")}n.language=function(e){return null==e?o:(o="th"==e.substring(0,2)?"th":"en",n)},n.set=function(e,t){n.clear().add(e,t)},n.add=function(t,o){if(t.split){var i=t.split("|");if(i.length>1){for(var d=0;d<i.length;++d)n.add(i[d],o);return n}}if(r[t])return n;o=o||{};var u={tag:t,source:"function"==typeof t?"function"+ ++longdo.objectcount:(o.source||server.tag)+"/"+(o.visibleRange||o.label&&o.label.max||o.dataset?encodeURIComponent(t):a.longdoName),icon:o.icon,visibleRange:o.visibleRange||TAG_RANGE,label:o.label||LABEL_RANGE,dataset:o.dataset};return!0===u.label&&(u.label=u.visibleRange),r[t]=u,s=[],l||e.Event.bind("overlayClick",E),++l,p(),n},n.remove=function(t){if(t.split){var o=t.split("|");if(o.length>1){for(var a=0;a<o.length;++a)n.remove(o[a]);return n}}return r[t]?(delete r[t],s=[],--l||e.Event.unbind("overlayClick",E),p(),n):n},n.clear=function(){return r={},l=0,d={},p(),e.Event.unbind("overlayClick",E),n},n.list=function(){return Object.keys(r)},n.size=function(){return l},n.load=function(e){if(!l)return n;var i=e.u+"-"+e.v+"-"+e.w;if(u[i])return n;var c=a.maxZoom-e.w;u[i]=!0,(d=s[e.w])||(d=function(e){var n={};for(var t in r){var o=r[t];if($.isInRange(e,o.visibleRange))if("function"!=o.source.substring(0,8)){var a=n[o.source];a||(a={query:"?",count:0},n[o.source]=a,o.dataset&&(a.query+="dataset="+o.dataset+"&")),a.query+="tag%5B"+a.count+"%5D="+encodeURIComponent(t)+"&","big"==o.icon||"small"==o.icon?a.query+="iconmode%5B"+a.count+"%5D="+o.icon+"&":o.icon&&(a.query+="iconmode%5B"+a.count+"%5D=custom:"+encodeURIComponent(t)+"&"),$.isInRange(e,o.label)&&(a.query+="iconlabel%5B"+a.count+"%5D=1&"),++a.count}else n[o.source]=o.tag}return n}(c),s[e.w]=d);var m="/"+c+"/"+(e.v*(1<<c)+e.u)+"/"+o;for(var p in d)"function"==p.substring(0,8)?d[p](e,c):$.loadScript(p+m+d[p].query+"key="+apikey+"&callback=longdo.callback."+t,_);return n},n.pop=function(t){if(document.getElementById(i+t.id))e.Overlays.remove(e.Overlays.lastOpenPopup());else{var a=new longdo.Popup(t,{title:t.name,detail:'<div id="'+i+t.id+'" class="ldmap_poi_load">Loading...</div>',loadDetail:function(){$.loadScript((t.detailpath||server.poi+"/json/get")+"?id="+t.id+"&locale="+o+"&key="+apikey+"&callback=longdo.callback.tagDetail"+e.id())}});a.data=t,e.Overlays.add(a)}return n},n.enablePopup=function(e){return null==e?n.popup||!1:(n.popup=e,n)},n.initCanvas=function(){var t=$.append(e.placeholder(),"canvas");return(m=t.getContext("2d")).font=tagTheme.labelSize.font,n},longdo.callback["tagDetail"+e.id()]=function(n){var t=document.getElementById(i+n.meta.keyword);t&&(n.data.length?$.empty(t.parentNode).appendChild($.formatPoi(n.data[0],o,e.Ui.popup)):$.empty(t))}};var MARKER_DISTANCE_MIN=100,MARKER_POI_OPTION={span:.001,limit:1},UNKNOWN_ROAD={th:"ถนนเชื่อมต่อ",en:"Connecting road"},MAX_TIME=2592e6,routeTheme={markerPrefix:server.route+"/images/dest",markerOffset:{x:16,y:41},markerMax:50,routeLabel:{th:{insert:"เดินทางจากจุดนี้",add:"เดินทางมาจุดนี้",remove:"ลบจุดหมาย",origin:"จุดเริ่มต้น",dest:"จุดหมายที่ ",guide:{depart:"ออกจาก ",arrive:"ถึง ",fromroad:" จากถนน"},menu:{clear:"ลบ",reverse:"กลับ",animate:"วิ่ง",stop:"หยุด",pref:"ตั้งค่า",t:"หลบรถติด",c:"ถนนหลัก",d:"ทางลัด",w:"ขนส่งมวลชน",reload:"&#8635;",walk:"เดิน",road:"รถ",air:"เครื่องบิน",rail:"รถไฟ",ferry:"เรือ",toll:"ทางด่วน",bus:"รถเมล์ (beta)",metro:"รถไฟฟ้า"},menuTip:{clear:"ลบเส้นทางทั้งหมด",reverse:"กลับทิศทางการเดินทาง",animate:"แสดงหรือหยุดการเดินทางบนเส้นทาง",pref:"ตั้งค่า",t:"เดินทางไปตามถนนหลักโดยหลบรถติด",c:"เดินทางไปตามถนนหลัก",d:"ลัดเข้าซอยเพิ่อให้ใช้ระยะทางสั้นที่สุด",w:"ใช้รถสาธารณะ",reload:"หาเส้นทางใหม่โดยใช้จุดหมายเดิม"},about:'<div class="ldroute_head">บริการแนะนำเส้นทาง</div><div class="ldroute_indent ldroute_warn">*บริการแนะนำเส้นทางนี้ยังอยู่ในขั้นทดลอง ผลลัพธ์ต่างๆ อาจไม่ถูกต้อง</div>        <div class="ldroute_road">วิธีใช้งาน</div>        <div class="ldroute_indent"><span class="ldroute_poi">เพิ่มจุดหมาย</span> คลิกขวาที่ตำแหน่งที่ต้องการ แล้วเลือกคำสั่ง "เดินทางจากจุดนี้" หรือ "เดินทางมาจุดนี้"</div>        <div class="ldroute_indent"><span class="ldroute_poi">ลบจุดหมาย</span> คลิกที่จุดหมาย แล้วเลือกคำสั่ง "ลบจุดหมาย"</div>        <div class="ldroute_indent"><span class="ldroute_poi">ย้ายจุดหมาย</span> ลากจุดหมายไปยังตำแหน่งที่ต้องการ</div>        \x3c!-- div class="ldroute_indent"><span class="ldroute_poi">แทรกจุดหมาย</span> ลากเส้นทางไปยังตำแหน่งที่ต้องการ</div --\x3e',turn:["เลี้ยวซ้ายสู่","เลี้ยวขวาสู่","เบี่ยงซ้ายสู่","เบี่ยงขวาสู่","ไปตาม","ตรงไปตาม","เข้าสู่",,,"ถึง","","","","",""],guideError:"ไม่พบเส้นทางไปยังจุดหมาย",guideGone:"ไม่มีข้อมูล ณ เวลาที่เลือก"},en:{insert:"Direction from here",add:"Direction to here",remove:"Remove destination",origin:"starting position",dest:"destination #",guide:{depart:"Depart from ",arrive:"Arrive at ",fromroad:" from road"},menu:{clear:"clear",reverse:"rev.",animate:"go",stop:"stop",pref:"pref.",t:"Traffic",c:"Main road",d:"Shortcut",w:"Transit",reload:"&#8635;",walk:"Walk",road:"Road",air:"Air",rail:"Rail",ferry:"Ferry",toll:"Toll",bus:"Bus (beta)",metro:"Metro"},menuTip:{clear:"All clear",reverse:"Reverse direction",animate:"Start/Stop animation",pref:"Preferences",t:"Use main road, avoid traffic jam",c:"Use main road",d:"Use shortcut",w:"Use public transport",reload:"Reload result"},about:'<div class="ldroute_head">Route service</div><div class="ldroute_indent ldroute_warn">*BETA version, we do not guarantee validity of the result</div>        <div class="ldroute_road">Instruction</div>        <div class="ldroute_indent"><span class="ldroute_poi">Add destination</span> right click and choose "Direction from here" or "Direction to here"</div>        <div class="ldroute_indent"><span class="ldroute_poi">Remove destination</span> click at destination and choose "Remove destination"</div>        <div class="ldroute_indent"><span class="ldroute_poi">Move destination</span> drag destination to prefer location</div>        \x3c!-- div class="ldroute_indent"><span class="ldroute_poi">Insert destination</span> drag route to prefer location</div --\x3e',turn:["Turn left to","Turn right to","Slight left to","Slight right to","Head toward","Continue straight onto","Enter",,,"Arrive at","","","","",""],guideError:"No route to destination",guideGone:"์No data at selected time"}}};longdo.MapTheme.route=routeTheme,longdo.RouteType={Road:1,Air:2,Railway:4,Ferry:8,Tollway:16,Bus:32,Metro:64,All:127,AllDrive:25,AllTransit:111},longdo.RouteMode={Traffic:"t",Cost:"c",Distance:"d",Walk:"w",Both:"b",Fly:"f"},longdo.RouteLabel={Distance:"d",Time:"t",Hide:!1},longdo.RouteRestrict={Bike:1,Wheelchair:1},longdo.Route=function(e){var n=this,t="th",o=routeTheme.routeLabel[t],a=UNKNOWN_ROAD[t],i=null,r="ldroute"+e.id()+"-",l={destination:{lineColor:"rgba(136,68,255,"+GEOMETRY_LINEALPHA+")"},road:{lineColor:"rgba(136,68,255,"+GEOMETRY_LINEALPHA+")",pointer:!0},air:{lineColor:"rgba(68,255,255,"+GEOMETRY_LINEALPHA+")",pointer:!0},rail:{lineColor:"rgba(68,68,68,"+GEOMETRY_LINEALPHA+")",pointer:!0,lineStyle:longdo.LineStyle.Dashed},ferry:{lineColor:"rgba(255,255,68,"+GEOMETRY_LINEALPHA+")",pointer:!0},focus:{lineColor:"rgba(255,68,136,"+GEOMETRY_LINEALPHA+")"}},s=!1,d=!1,u=longdo.RouteMode.Traffic,c=longdo.RouteType.All,m=0,p=!1,f=[],g=[],v=null,h=null,y=!0,T=!0,b=!1,L=!1,E=longdo.RouteLabel.Distance,_=0,x=null;function O(){i&&(i.innerHTML='<div class="ldroute_about"><br />'+o.about+"</div>")}function I(t){var a;(a=document.createElement("div")).className="ldmap_link",a.innerHTML=o.insert,a.onclick=function(){e.Ui.ContextMenu.visible(!1),n.insert(0,t.location)},t.add(a),(a=document.createElement("div")).className="ldmap_link",a.innerHTML=o.add,a.onclick=function(){e.Ui.ContextMenu.visible(!1),n.add(t.location)},t.add(a)}function w(e){if(e.data.length)for(var n,t=0;n=f[t];++t)if($.sameLocation(n.location(),e.meta))return n.poi=e.data[_].name,void(0===v&&U())}function M(e){return e.currentTarget.id.substring(r.length+1)}function C(n){var t=f[M(n)];t&&e.location(t.location(),!0)}function A(n){var t=M(n).split("-"),o=g[t[0]];if(o&&o.path){var a=o.path[t[1]];a.normalLineColor=a.lineColor,a.lineColor=l.focus.lineColor,e.repaint("G")}}function R(n){var t=M(n).split("-"),o=g[t[0]];if(o&&o.path){var a=o.path[t[1]];a.lineColor=a.normalLineColor,delete a.normalLineColor,e.repaint("G")}}function P(n){var t=M(n).split("-"),o=g[t[0]];if(o&&o.path){var a=o.path[t[1]];e.bound($.locationBound(a.location()))}}function N(t,a){if(!(a instanceof longdo.Marker)){t=$.bound(t,0,f.length);var i=routeTheme.markerPrefix+(y&&t&&t==f.length?"Last":t>routeTheme.markerMax?"":t);(a=new longdo.Marker(a,{icon:{url:i+".png",urlHD:i+"-2x.png",offset:routeTheme.markerOffset},popup:{title:t?o.dest+t:o.origin,loadDetail:function(e){$.append(e,"span",{className:"ldmap_link",innerHTML:o.remove,onclick:function(){n.remove(a)}})},size:{width:100}},draggable:!0})).type="r"}return e.Overlays.add(a),T&&server.poi&&e.Search.nearPoi(a.location(),MARKER_POI_OPTION),a}function k(e){for(var n,t=e;n=f[t];++t)"r"==n.type&&(n.element().src=routeTheme.markerPrefix+(y&&t&&t==f.length-1?"Last":t>routeTheme.markerMax?"":t)+IMAGE_SUFFIX,n.popup().title(t?o.dest+t:o.origin))}function S(){!s||f.length<2||(d?d=!1:n.search())}function D(e){v=e,h=e}function z(n,o){var a=f[n],i=a.routeMode||u,r=a.location(),l=f[n+1].location();if(g[n]={from:r,to:l},i==longdo.RouteMode.Fly)return setTimeout(longdo.callback["guide"+e.id()],1,{meta:{from:r,to:l},data:[{id:0,interval:0,guide:[{name:"?",turn:4,distance:$.distance([r,l])}]}]}),void setTimeout(longdo.callback["path"+e.id()],2,{meta:{id:0},data:[[r,l]]});var s=(i==longdo.RouteMode.Walk||i==longdo.RouteMode.Both?server.transit:server.route)+"/json/route/guide?flon="+r.lon+"&flat="+r.lat+"&tlon="+l.lon+"&tlat="+l.lat+"&mode="+i+"&type="+c+"&restrict="+m+"&locale="+t+(p?"&time="+p:"")+(e.placeholder()?"":"&geom=0")+"&key="+apikey+"&maxresult="+(_+1)+"&callback=longdo.callback.guide"+e.id();cap.nolimit||!o?$.loadScript(s,G):setTimeout($.loadScript,RATE_LIMIT*o,s,G)}function H(n,t){$.loadScript((t==longdo.RouteMode.Walk||t==longdo.RouteMode.Both?server.transit:server.route)+"/json/route/path?id="+n+"&key="+apikey+"&callback=longdo.callback.path"+e.id(),G)}function G(n){n||e.Event.fire("connectionError","route")}function F(e){for(var n=0,t=0;t<e.length;++t)n+=e[t].distance;return n}function U(){if(i){$.empty(i);var e=n.guide(!0);e&&i.appendChild(e)}}function W(){var t=longdo.RouteMode,a=longdo.RouteType,i=document.createDocumentFragment(),r=$.append(i,"div");$.append(r,"span",{className:"ldroute_menu",innerHTML:"&nbsp;",onclick:n.nextGuide}),$.append(r,"span",{className:"ldroute_menu",innerHTML:o.menu.reverse,title:o.menuTip.reverse,onclick:n.reverse}),$.append(r,"span",{className:"ldroute_menu",innerHTML:o.menu.clear,title:o.menuTip.clear,onclick:n.clear}),$.append(r,"span",{className:"ldroute_menu",innerHTML:o.menu.pref,title:o.menuTip.pref,onclick:j}),(x=$.append(r,"div",{className:"ldroute_pref"})).style.display="none";var l=$.append(x,"div",{className:"ldroute_pref_right"});u==t.Walk?($.prepend($.append(l,"label",{innerHTML:o.menu.walk}),"input",{type:"checkbox",checked:c&a.Road,onchange:function(){d=!0,n.enableRoute(a.Road,this.checked)}}),$.prepend($.append(l,"label",{innerHTML:o.menu.bus}),"input",{type:"checkbox",checked:c&a.Bus,onchange:function(){d=!0,n.enableRoute(a.Bus,this.checked)}}),$.prepend($.append(l,"label",{innerHTML:o.menu.metro}),"input",{type:"checkbox",checked:c&a.Metro,onchange:function(){d=!0,n.enableRoute(a.Metro,this.checked)}}),$.prepend($.append(l,"label",{innerHTML:o.menu.rail}),"input",{type:"checkbox",checked:c&a.Railway,onchange:function(){d=!0,n.enableRoute(a.Railway,this.checked)}}),$.prepend($.append(l,"label",{innerHTML:o.menu.ferry}),"input",{type:"checkbox",checked:c&a.Ferry,onchange:function(){d=!0,n.enableRoute(a.Ferry,this.checked)}})):($.prepend($.append(l,"label",{innerHTML:o.menu.road}),"input",{type:"checkbox",checked:c&a.Road,onchange:function(){d=!0,n.enableRoute(a.Road,this.checked)}}),$.prepend($.append(l,"label",{innerHTML:o.menu.toll}),"input",{type:"checkbox",checked:c&a.Tollway,onchange:function(){d=!0,n.enableRoute(a.Tollway,this.checked)}}),$.prepend($.append(l,"label",{innerHTML:o.menu.ferry}),"input",{type:"checkbox",checked:c&a.Ferry,onchange:function(){d=!0,n.enableRoute(a.Ferry,this.checked)}}));var s=$.append(x,"div",{className:"ldroute_pref_left"});$.prepend($.append(s,"label",{innerHTML:o.menu.t,title:o.menuTip.t}),"input",{type:"radio",name:e.id()+"-routemode",checked:u==t.Traffic,onchange:function(){n.mode(t.Traffic)}}),$.prepend($.append(s,"label",{innerHTML:o.menu.c,title:o.menuTip.c}),"input",{type:"radio",name:e.id()+"-routemode",checked:u==t.Cost,onchange:function(){n.mode(t.Cost)}}),$.prepend($.append(s,"label",{innerHTML:o.menu.d,title:o.menuTip.d}),"input",{type:"radio",name:e.id()+"-routemode",checked:u==t.Distance,onchange:function(){n.mode(t.Distance)}}),server.transit&&$.prepend($.append(s,"label",{innerHTML:o.menu.w,title:o.menuTip.w}),"input",{type:"radio",name:e.id()+"-routemode",checked:u==t.Walk,onchange:function(){n.mode(t.Walk)}});var m=$.append(x,"div",{className:"ldroute_pref_bottom"}),f=new Date,g=6e4*f.getTimezoneOffset(),v={type:"datetime-local",min:new Date(f.getTime()-g).toISOString().substring(0,16),max:new Date(f.getTime()+MAX_TIME-g).toISOString().substring(0,16),onchange:function(){d=!0,n.time(new Date(this.value))}};return v.value=p?new Date(1e3*p-g).toISOString().substring(0,16):v.min,$.append(m,"input",v),$.append(m,"button",{innerHTML:o.menu.reload,onclick:n.search}),i}function Y(e){var n=g[e],o=n.guide,a=n.path;if(E){var i=function(e,n){for(var t=n/2,o=0,a=0;a<e.length;++a)if((o+=e[a].distance)>t)return a;return 0}(n.guide,n.distance),r=E==longdo.RouteLabel.Distance?$.formatDistance(n.distance,t):$.formatInterval(n.interval,t);n.label=new longdo.Marker($.polylinePivot(a[i]),$.labelOptions(r,{},{}))}var s=0;if(l.destination){var d=new longdo.Polyline([f[e].location(),a[0][0]],l.destination),u=new longdo.Polyline([$.lastItem($.lastItem(a)),f[e+1].location()],l.destination);a.push(u),a.push(d),s=2}for(var c=0;c<a.length-s;++c){var m=o[c].turn;a[c]=new longdo.Polyline(a[c],l[Z(m)]),a[c].type="g",a[c].index=e}for(c=e+2;c<g.length;++c)if(a=g[c].path)for(var p=0;p<a.length;++p)a[p].index=c}function X(){var n=e.pause();e.pause(!0);for(var t,o=0;t=g[o];++o){var a=t.path;if(a){for(var i=0;i<a.length;++i)e.Overlays.add(a[i]);t.label&&e.Overlays.add(t.label)}}e.pause(n).repaint("G").repaint("E")}function B(n){var t=g[n];if(t&&t.path){var o=t.path,a=e.pause();e.pause(!0);for(var i=0;i<o.length;++i)e.Overlays.remove(o[i]);e.Overlays.remove(t.label),e.pause(a).repaint("G").repaint("E")}}function Z(e){return e<10?"road":10==e?"air":11==e?"ferry":"rail"}function j(){"none"==x.style.display?x.style.display="block":x.style.display="none"}n.language=function(e){return null==e?t:(t="th"==e.substring(0,2)?"th":"en",o=routeTheme.routeLabel[t],a=UNKNOWN_ROAD[t],n)},n.placeholder=function(e){return null==e?i:(i=e,$.addClass(i,"ldroute_placeholder"),O(),s=!0,n)},n.enableContextMenu=function(){return e.Event.bind("beforeContextmenu",I),s=!0,n},n.line=function(e,t){return null==t?l[e]:(l[e]=t,n)},n.auto=function(e){return null==e?s:((s=e)&&S(),n)},n.mode=function(e){return null==e?u:(u=e,S(),n)},n.enableRoute=function(e,n){return null==e?c:null==n?(c&e)==e:(c=n?c|e:c&~e,S(),this)},n.enableRestrict=function(e,n){return null==e?m:null==n?(m&e)==e:(m=n?m|e:m&~e,S(),this)},n.time=function(e){return null==e?!!p&&new Date(1e3*p):(p=e instanceof Date&&parseInt(e.getTime()/1e3),S(),n)},n.modeOf=function(e,t){return void 0===t?f[e].routeMode:(f[e].routeMode=t,function(e){!s||f.length<2||e==f.length-1||(D(1),B(e),g[e]=null,z(e,0))}(e),n)},n.useStopMarker=function(e){return null==e?y:(y=e,n)},n.usePoiName=function(t){return null==t?T:(t!=T&&((T=t)?e.Event.bind("nearPoi",w):e.Event.unbind("nearPoi",w)),n)},n.useCumulativeDistance=function(e){return null==e?b:(b=e,n)},n.showUnknownRoad=function(e){return null==e?L:(L=e,n)},n.label=function(e){return null==e?E:(E=e,S(),n)},n.add=function(e,t){var o;return f.push(N(f.length,e)),t&&($.lastItem(f).routeMode=t),y&&f.length>2&&k(f.length-2),o=f.length-1,s&&o&&(1==o?n.search():(D(1),z(o-1))),n},n.insert=function(e,t,o){return e=+e,f.splice(e,0,N(e,t)),o&&(f[e].routeMode=o),k(e+1),function(e){if(s&&!(f.length<2))if(2==f.length)n.search();else if(e){var t=e-1;B(t),g.splice(t,1,null,null),D(2),z(t),z(e,1)}else g.unshift(null),D(1),z(e)}(e),n},n.remove=function(e){var t=f.indexOf(e);return t>=0&&n.removeAt(t),n},n.removeAt=function(t){return e.Overlays.remove(f[t]),f.splice(t,1),k(t?t-1:0),function(t){var o;s&&(f.length<2&&(n.clearPath(),O()),t&&t<f.length?(B(o=t-1),B(t),g.splice(o,2,null),D(1),z(o)):(B(o=t?t-1:0),g.splice(o,1),U(),X(),e.Event.fire("guideComplete",g),e.Event.fire("pathComplete",null)))}(t),n},n.clearDestination=function(){var t=e.pause();e.pause(!0);for(var o=0;o<f.length;++o)e.Overlays.remove(f[o]);return f=[],_=0,e.pause(t).repaint("O"),n},n.clearPath=function(){if(!g.length)return n;var t=e.pause();e.pause(!0);for(var o,a=0;o=g[a];++a){var i=o.path;if(i){for(var r=0;r<i.length;++r)e.Overlays.remove(i[r]);e.Overlays.remove(o.label)}}return g=[],e.pause(t).repaint("G").repaint("E"),n},n.clear=function(){return n.clearDestination(),n.clearPath(),D(null),O(),n},n.list=function(){return f},n.size=function(){return f.length},n.reverse=function(){for(var e,t=1,o=f[0];e=o,o=f[t];++t)o.routeMode=e.routeMode;return delete f[0].routeMode,f.reverse(),k(0),S(),n},n.search=function(){var e=f.length-1;if(e<1)return n;n.clearPath(),g=[],D(e);for(var t=0;t<e;++t)z(t,t);return n},n.distance=function(e){for(var n=0,o=0;o<g.length;++o)n+=g[o].distance;return e?$.formatDistance(n,t):n},n.interval=function(e){for(var n=0,o=0;o<g.length;++o)n+=g[o].interval;return e?$.formatInterval(n,t):n},n.guide=function(e){if(!g.length)return null;if(!e)return g;var n=W(),i=$.append(n,"div",{className:"ldroute_info"}),l=$.append(n,"ol",{className:"ldroute_list"}),s=g[0],d=$.append(l,"li",{className:"ldroute_item ldroute_dest",innerHTML:'<img class="ldroute_icon" src="'+server.route+"/images/turn4"+IMAGE_SUFFIX+'" alt="" />'+(s.fdistance>MARKER_DISTANCE_MIN?'<span class="ldroute_dist">'+$.formatDistance(s.fdistance,t)+o.guide.fromroad+"</span>":"")+o.guide.depart+'<span class="ldroute_poi">'+(f[0].poi||o.origin)+"</span>",id:r+"d0"});d.addEventListener("click",C);for(var u=0,c=0,m=0;s=g[m];++m){var p=s.guide;if(p)for(var v,h=p.length-1,y=u,T=0;v=p[T];++T)T&&T<h&&(v.turn<10&&v.distance<MARKER_DISTANCE_MIN||!L&&v.name==a)&&!s.raw||(b?y+=v.distance:y=v.distance,(d=$.append(l,"li",{className:"ldroute_item ldroute_type_"+Z(v.turn),innerHTML:'<img class="ldroute_icon" src="'+server.route+"/images/turn"+v.turn+IMAGE_SUFFIX+'" alt="" />'+(v.turn<10||v.interval>30?'<span class="ldroute_dist">'+(v.turn<10?$.formatDistance(y,t):$.formatInterval(v.interval,t))+"</span>"+o.turn[v.turn]+' <span class="ldroute_road">'+v.name+"</span>":v.name),id:r+"g"+m+"-"+T})).addEventListener("mouseover",A),d.addEventListener("mouseout",R),d.addEventListener("click",P));(d=$.append(l,"li",{className:"ldroute_item ldroute_dest",innerHTML:'<img class="ldroute_icon" src="'+server.route+"/images/turn9"+IMAGE_SUFFIX+'" alt="" />'+(s.tdistance>MARKER_DISTANCE_MIN?'<span class="ldroute_dist">'+$.formatDistance(s.tdistance,t)+o.guide.fromroad+"</span>":"")+o.guide.arrive+'<span class="ldroute_poi">'+(f[m+1].poi||o.dest+(m+1))+"</span>",id:r+"d"+(m+1)})).addEventListener("click",C),u+=s.distance,c+=s.interval}return i.innerHTML='<span class="ldroute_distance">'+$.formatDistance(u,t)+'</span><span class="ldroute_interval">'+$.formatInterval(c,t)+"</span>",n},n.exportRouteLine=function(e){for(var n=[],t=0;t<g.length;++t){var o=g[t].path,a=$.lastItem(o),i=0;null==a.type&&(n=n.concat(a.location()),i=1);for(var r=0;r<o.length-i;++r)n=n.concat(o[r].location().slice(1))}return new longdo.Polyline(n,e)},n.nextGuide=function(){return console.log("guide: ",++_),S(),n},longdo.callback["guide"+e.id()]=function(n){var a=n.meta;if(a.status){if(i){$.empty(i);var r=W();$.append(r,"div",{className:"ldroute_error",innerHTML:"<br />"+(410==a.status?o.guideGone:o.guideError)}),i.appendChild(r)}return--v,--h,void e.Event.fire("guideError",a.status)}for(var l,s=0;l=g[s];++s)if(!l.guide&&$.sameLocation(l.from,a.from)&&$.sameLocation(l.to,a.to)){var d=f[s].routeMode||u;if(a.config&&a.config!=d+c+t+m)return;if(n.data.length<=_&&(_=0,console.log("guide: rewind")),(l=n.data[_]).id>=0&&H(l.id,d),l.distance=F(l.guide),l.fdistance>MARKER_DISTANCE_MIN&&(l.distance+=l.fdistance),l.tdistance>MARKER_DISTANCE_MIN&&(l.distance+=l.tdistance),l.from=a.from,l.to=a.to,g[s]=l,--v>0)return;return U(),void e.Event.fire("guideComplete",g)}},longdo.callback["path"+e.id()]=function(n){var t=n.meta;if(t.status)return--h,void e.Event.fire("pathError",t.status);for(var o,a=0;o=g[a];++a)if(!o.path&&o.id==t.id){if(o.path=n.data,Y(a),--h>0)return;return X(),void e.Event.fire("pathComplete",n)}},e.Event.bind("overlayDrop",(function(t){if("r"==t.type){var o=f.indexOf(t);o>=0&&(t.poi=void 0,T&&server.poi&&e.Search.nearPoi(t.location(),MARKER_POI_OPTION),function(e){if(s&&!(f.length<2)){var n=e<f.length-1;if(D((e?1:0)+(n?1:0)),e){var t=e-1;B(t),g[t]=null,z(t)}n&&(B(e),g[e]=null,z(e,e?1:0))}}(o))}else"d"==t.type&&"g"==t.geometry.type&&n.insert(t.geometry.index+1,t.location(),n.modeOf(t.geometry.index))})),e.Event.bind("nearPoi",w)};var CENTER={x:209182721,y:123881006,z:13},SAVE_INTERVAL=5e3,WHEEL_END=300,ZOOM_SNAP={min:.01,max:.99},TOOLTIP_DELAY=500,IDLE_DELAY=4e3,BIG_NUM=1<<30;longdo.LocationMode={Pointer:"POINTER",Geolocation:"GEOLOCATION"},longdo.Map=function(e){var n=this,t=++longdo.objectcount,o=null,a=longdo.Projections.EPSG3857,i={min:1,max:cap.maxZoom?cap.maxZoom:a.maxZoom},r=CENTER,l=1,s=0,d=0,u=0,c={focus:function(){}},p={x:0,y:0},f={x:0,y:0},g=!1,v={resize:function(){},repaint:function(){},scale:function(){return this},removeElement:function(){},switchFrame:function(){return this},clearBackFrame:function(){return this}},h=!0,y=null,T=null,b=null,L=null,E=null,_=null,x={getZoom:function(){return r.z},removeElement:function(e,n){return v.removeElement(e,n)},hitGeometry:function(e){return v.hitGeometry(e)}},O={down:function(e){return g=n.screenToPoint(e),n.Ui.ContextMenu&&n.Ui.ContextMenu.visible(!1),C(),n.Overlays.hit(g,e,d)},click:function(e,t){g=n.screenToPoint(t),e?n.Event.fire("click",t):n.Ui.ContextMenu&&n.Ui.ContextMenu.visible(t,$.pointToLocation(a,g))},hit:function(e){n.Event.fire("overlayClick",e)&&e.popup&&n.Overlays.pop(e,void 0,null==e.element())},move:function(e,t){if(n.Ui.Tooltip&&n.Ui.Tooltip.visible(e),e)if(g=n.screenToPoint(e),n.Event.fire("mousemove",e),C(),t){var i=n.Event.pause();n.Event.pause(!0);var r=n.Overlays.hit(g,e,d);if(n.Event.pause(i),r!=T){var l,s;if(T&&(T.clickable&&(o.style.cursor="default",n.Event.fire("overlayLeave",T)),n.Ui.Tooltip&&T.title&&(clearTimeout(_),_=null,n.Ui.Tooltip.set(!1)),!(s=T.geometry||T).pivot||r&&r.geometry==s||(s.editable&&((l=n.Overlays.lastOpenPopup())&&l.marker&&l.marker.geometry&&(l.marker==T||l.marker.geometry==T)||s.hideNode(n)),s.pointer&&s.hidePointer())),r&&(r.clickable&&(o.style.cursor=r.draggable?"all-scroll":"pointer",n.Event.fire("overlayHover",r)),n.Ui.Tooltip&&r.title&&(_=setTimeout(n.Ui.Tooltip.set,TOOLTIP_DELAY,r.title)),r.pointer&&r.showPointer(a,g),r.editable&&$.isInRange(n.zoom(),r.editable)))(l=n.Overlays.lastOpenPopup())&&l.marker&&(s=l.marker.geometry)&&s.editable&&s!=r&&s.hideNode(n),r.showNode(n);T=r}}else _&&(clearTimeout(_),n.Ui.Tooltip.set(!1));else g=!1},dragWhenDisable:function(e){g=n.screenToPoint(e)},drag:function(e){!b&&n.Event.fire("drag",e)&&(C(),e={x:e.x<<r.z,y:e.y<<r.z},s&&(e=m.rotateVector(e,s)),r.x=(r.x+e.x)%a.maxPointX,r.x<0&&(r.x+=a.maxPointX),r.y+=e.y,n.repaint(),n.Event.fire("location"))},drop:function(){o.style.cursor="default",n.Event.fire("drop")},dragOverlay:function(e,t){t={x:t.x<<r.z,y:t.y<<r.z},s&&(t=m.rotateVector(t,s)),C();var o=$.locationToPoint(a,e.location());o.x-=t.x,o.y-=t.y,e.move($.pointToLocation(a,o)),n.Event.fire("overlayDrag",e)},dropOverlay:function(e){n.Event.fire("beforeOverlayDrop",e),o.style.cursor=e.element()instanceof Image?"pointer":"default",n.Event.fire("overlayDrop",e)},doubleClick:function(e,t){n.Event.fire("doubleClick",t)&&n.zoom(e,!0,t)},wheel:function(e,t){L&&clearTimeout(L),L=setTimeout(this.wheelEnd,WHEEL_END),C(),b&&!$.isInRange(b,WHEEL_ZOOM)||(n.zoom(e,!0,t),n.Event.fire("wheel",t))},wheelEnd:function(){L=null,b==BIG_NUM&&(b=null)},getPointer:function(){return g},overlayByElement:function(e){for(var t=f.x<<r.z,o=f.y<<r.z,a=n.Overlays.element(r.x-t>>TILEEXP,r.y-o>>TILEEXP,r.x+t>>TILEEXP,r.y+o>>TILEEXP,r.z,d),i=0;i<a.length;++i){var l=a[i].value;if(l.element()==e)return l}return null}},I={getCenter:function(){return r},setCenter:function(e){r=e}};function w(e){var n=$.now();v.clearBackFrame(),requestAnimationFrame((function t(){var o=Date.now()-n,a=Math.abs(Math.log2(b));if(o>ANIMATION_INTERVAL*a)return v.scale(b,e).switchFrame(),void(L&&(b>2||b<.5)?(b=BIG_NUM,clearTimeout(L),L=setTimeout(O.wheelEnd,WHEEL_END)):b=null);requestAnimationFrame(t);var i=o/ANIMATION_INTERVAL/a;v.scale(b>1?1+i*(b-1):1-i*(1-b),e)}))}function M(e,t){var o=$.now(),a=r.x,i=r.y;requestAnimationFrame((function l(){var s=Date.now()-o;if(s>ANIMATION_INTERVAL)return r.x=a+e,r.y=i+t,v.repaint(),void n.Event.fire("location");requestAnimationFrame(l);var d=s/ANIMATION_INTERVAL;r.x=a+e*d|0,r.y=i+t*d|0,v.repaint()}))}function C(){clearTimeout(E),E=setTimeout(n.Event.fire,IDLE_DELAY,"idle")}function A(e){$.onMap(e)&&n.focus()}function R(){return a.maxZoom-r.z+Math.log2(l)}if(n.id=function(){return t},n.resize=function(){if(!n.Event.fire("beforeResize"))return n;if(o){f={x:o.offsetWidth>>1,y:o.offsetHeight>>1};var e=o.getBoundingClientRect();p={x:e.left+(pageXOffset||document.body.scrollLeft),y:e.top+(pageYOffset||document.body.scrollTop)}}return v.resize(),n.Ui.resize&&n.Ui.resize(),n.Event.fire("resize"),n},n.repaint=function(e){return h||(v.repaint(e),n.Event.fire("repaint",e)),n},n.pause=function(e){return null==e?h:(h=e,n)},n.placeholder=function(){return o},n.projection=function(){return a},n.zoom=function(e,t,o){if(null==e)return 1==l?a.maxZoom-r.z:$.bound(Math.round(10*R())/10,.1,i.max+.9);t=(void 0===t||t)&&v;var d=(o=o||f).x-f.x,u=o.y-f.y;if(l=1,e>0)if(!0===e){if(r.z<=a.maxZoom-i.max)return n;--r.z;var c={x:d<<r.z,y:u<<r.z};s&&(c=m.rotateVector(c,s)),r.x+=c.x,r.y+=c.y,t?b?b*=2:(b=2,w(o)):v.clearBackFrame().scale(2,o).switchFrame()}else{if(!$.isInRange(e,i))return n;var p=e%1;p<ZOOM_SNAP.min?(e|=0,p=0):p>ZOOM_SNAP.max&&(e=e+1|0,p=0);var g=0|(p>.8?e+1:e);l=Math.pow(2,p)*(e>=g?1:.5);var h=r.z;r.z=a.maxZoom-g;var y=Math.min(h,r.z);c={x:d<<y,y:u<<y},s&&(c=m.rotateVector(c,s)),h-=r.z,r.x+=c.x*h,r.y+=c.y*h,h?v.clearBackFrame().switchFrame().scale(l,o):v.scale(l,o)}else{if(r.z>=a.maxZoom-i.min)return n;c={x:d<<r.z,y:u<<r.z},s&&(c=m.rotateVector(c,s)),r.x-=c.x,r.y-=c.y,++r.z,t?b?b/=2:(b=.5,w(o)):v.clearBackFrame().scale(.5,o).switchFrame()}return T&&T.editable&&($.isInRange(n.zoom(),T.editable)?T.showNode(n):T.hideNode(n)),n.Event.fire("zoom",o),n},n.zoomRange=function(e){if(null==e)return i;if(e.min<1||e.max>(cap.maxZoom?cap.maxZoom:a.maxZoom)||e.min>e.max)throw"Invalid range";i=e;var t=n.zoom();return t<i.min?n.zoom(i.min):t>i.max&&n.zoom(i.max),n.Event.fire("zoomRange",e),n},n.location=function(e,t){if(null==e)return $.pointToLocation(a,r);if(e==longdo.LocationMode.Pointer)return!!g&&$.pointToLocation(a,g);if(isFinite(e.x)&&isFinite(e.y))return $.pointToLocation(a,n.screenToPoint(e));if(e==longdo.LocationMode.Geolocation)return n.Ui.Geolocation&&n.Ui.Geolocation.updateCurrentLocation(!!t),n;if(!$.validateLocation(e))throw"Invalid location";var o=$.locationToPoint(a,e);return o.z=r.z,(void 0===t||t)&&v?(n.Event.fire("locationAnimationBegin",e),M(o.x-r.x,o.y-r.y)):(r=o,n.repaint(),n.Event.fire("location")),n},n.bound=function(e,t,i){if(null==e){var l={x:f.x<<r.z,y:f.y<<r.z};if(s){var d=Math.abs(Math.cos(s)),u=Math.abs(Math.sin(s));l={x:l.x*d+l.y*u,y:l.y*d+l.x*u}}var c=$.pointToLocation(a,{x:r.x-l.x,y:r.y+l.y}),p=$.pointToLocation(a,{x:r.x+l.x,y:r.y-l.y});return{minLat:c.lat,minLon:c.lon,maxLat:p.lat,maxLon:p.lon}}if(!o)return n;var g=$.locationToPoint(a,{lon:e.minLon,lat:e.maxLat}),v=$.locationToPoint(a,{lon:e.maxLon,lat:e.minLat});if(g.x>v.x||g.y>v.y)throw"Invalid bounding box";if(t){var h=$.locationToPoint(a,t),y=Math.max(v.x-h.x,h.x-g.x),T=Math.max(v.y-h.y,h.y-g.y);g={x:h.x-y,y:h.y-T},v={x:h.x+y,y:h.y+T},h.x==r.x&&h.y==r.y||n.location(t)}else t=$.centerOfBound(e),n.location(t);y=v.x-g.x,T=v.y-g.y,s&&(y=l=m.distance(y,T),T=l);var b=n.zoom(),L=$.bound(b+Math.min(Math.log2((o.offsetWidth<<r.z)/y),Math.log2((o.offsetHeight<<r.z)/T))|0,1,a.maxZoom);return(L<b||!1!==i&&L>b)&&n.zoom(L),n},n.move=function(e,t){return void 0===t||t?(e={x:e.x<<r.z,y:e.y<<r.z},s&&(e=m.rotateVector(e,s)),M(e.x,e.y)):O.drag(e),n},n.pinch=function(e,t){return l*=e,v.clearBackFrame().scale(l,t),n.Event.fire("pinch",t),n},n.pinchEnd=function(e){return n.zoom($.bound(R(),i.min,i.max),!1,e),n.Event.fire("pinchEnd"),n},n.language=function(e){return null==e?n.Ui.language():(n.Ui.language(e),n.Search.language(e),n.Tags.language(e),n.Route.language(e),n)},n.focus=function(){return c.focus(),n},n.pageToScreen=function(e){var n=e.x-p.x;if(n<0||n>=o.offsetWidth)return!1;var t=e.y-p.y;return!(t<0||t>=o.offsetHeight)&&{x:n,y:t}},n.screenToPoint=function(e){var n={x:e.x-f.x<<r.z,y:e.y-f.y<<r.z};s&&(n=m.rotateVector(n,s));var t={x:(r.x+n.x)%a.maxPointX,y:r.y+n.y,z:r.z};return t.x<0&&(t.x+=a.maxPointX),t},n.loadingTile=function(){return v.loadingTile()},n.rotate=function(e){if(null==e)return s/RAD;e=$.boundAngle(e);var t=n.Layers.list();return e>135&&e<225?t[0]==longdo.Layers.NORMAL?(t[0]=longdo.Layers.REVERSE,n.repaint("M")):t[0]==longdo.Layers.NORMAL_EN&&(t[0]=longdo.Layers.REVERSE_EN,n.repaint("M")):t[0]==longdo.Layers.REVERSE?(t[0]=longdo.Layers.NORMAL,n.repaint("M")):t[0]==longdo.Layers.REVERSE_EN&&(t[0]=longdo.Layers.NORMAL_EN,n.repaint("M")),s=e*RAD,d=$.radianToDir(s),v.camera(s,u),n.Event.fire("rotate",e),n},n.pitch=function(e){return null==e?u/RAD:(e=$.boundAngle(e),u=e*RAD,v.camera(s,u),n.Event.fire("pitch",e),n)},n.enableFilter=function(e){if(null==e){for(var t in longdo.Filter)if($.hasClass(o,"ldmap_placeholder_"+longdo.Filter[t]))return longdo.Filter[t];return longdo.Filter.None}for(var a in longdo.Filter)$.removeClass(o,"ldmap_placeholder_"+longdo.Filter[a]);return e&&$.addClass(o,"ldmap_placeholder_"+e),n},n.enableNightMode=function(e){return n.enableFilter(null==e?void 0:e?longdo.Filter.Dark:longdo.Filter.None)},n.exportImage=function(){var n=o.offsetWidth,t=o.offsetHeight,a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("width",n),a.setAttribute("height",t);var i=document.createElementNS(a.namespaceURI,"foreignObject");i.setAttribute("width",n),i.setAttribute("height",t),i.appendChild(o),a.appendChild(i),e.placeholder.appendChild(a);var r=$.append(e.placeholder,"canvas",{width:n,height:t}),l=r.getContext("2d"),s=new Image;s.onload=function(){URL.revokeObjectURL(s.src),e.placeholder.appendChild(o),e.placeholder.removeChild(a),e.placeholder.removeChild(r),l.drawImage(s,0,0),location=r.toDataURL("image/png").replace("image/png","image/octet-stream")},s.src=URL.createObjectURL(new Blob([(new XMLSerializer).serializeToString(a)],{type:"image/svg+xml"}))},n.Event=new longdo.Event(n),n.Layers=new longdo.LayerCollection(n),n.Overlays=new longdo.OverlayCollection(n,x),n.Ui={language:function(e){return e?(this.code=e,this):this.code},code:"th"},n.Search=new longdo.Search(n),n.Tags=new longdo.TagCollection(n),n.Route=new longdo.Route(n),e){longdo["map"+t]=n;var P=e.language&&"th"!=e.language.substring(0,2);if(a=e.projection||a,e.layer)if(e.layer instanceof Array){n.Layers.setBase(e.layer[0]);for(var N=1;N<e.layer.length;++N)n.Layers.add(e.layer[N])}else n.Layers.setBase(e.layer);else P&&"POI"==defaultMap&&n.Layers.setBase(longdo.Layers.POI_EN);isFinite(e.zoom)&&n.zoom(e.zoom,!1),!1===e.lastView?n.location(e.location,!1):function(){try{y=localStorage.getItem("ldmap_center_"+a.longdoName)}catch(e){}if(y){var e=y.split(",");(e={x:+e[0],y:+e[1],z:+e[2]}).x&&e.y&&e.z&&(r=e)}}(),n.zoomRange(e.zoomRange),setInterval((function(){var e=r.x+","+r.y+","+r.z;if(e!=y){try{localStorage.setItem("ldmap_center_"+a.longdoName,e)}catch(e){}y=e}}),SAVE_INTERVAL),e.placeholder instanceof Element&&($.empty(e.placeholder),o=$.append(e.placeholder,"div",{className:"ldmap_placeholder"}),n.Ui=new longdo.UiCollection(n,O,e.ui,e.input),v=new LongdoRenderer(n,I,e.smoothZoom),n.Tags.initCanvas(),o.addEventListener("mousedown",A),o.addEventListener("touchstart",A),P&&n.language("en"),c=$.append(o,"button",{className:"ldmap_anchor"}),O.anchor=c,!1!==e.autoResize&&addEventListener("resize",n.resize),n.pause(!1),setTimeout((function(){n.resize(),n.Ui.updateStyle();var e=o.getBoundingClientRect();window.self==top&&e.top<innerHeight&&e.left<innerWidth&&n.focus(),n.Event.fire("ready")}),100))}};$.append(document.head,"style",{type:"text/css",innerHTML:'.ldmap_placeholder{position:relative;width:100%;height:100%;min-width:100px;min-height:100px;background:#eee;font:12px/1.2 Tahoma,sans-serif;overflow:hidden;z-index:0;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;-webkit-touch-callout:none}.ldmap_placeholder *{box-sizing:content-box}.ldmap_placeholder_fullscreen{position:fixed!important;top:0!important;left:0!important;width:100%!important;height:100%!important;z-index:255}.ldmap_placeholder a:link,.ldmap_placeholder a:visited{color:#069;outline:none;text-decoration:none}.ldmap_placeholder a:hover,.ldmap_placeholder a:active{color:#e80;outline:none;text-decoration:underline}.ldmap_placeholder .ldmap_selectable{user-select:text;-moz-user-select:text;-webkit-user-select:text;-ms-user-select:text;-webkit-touch-callout:default}.ldmap_placeholder .ldmap_frame{position:absolute}.ldmap_placeholder .ldmap_frame .ldmap_tile{position:absolute;top:0;left:0;width:256px;height:256px;z-index:0}.ldmap_placeholder .ldmap_frame .ldmap_tile_canvas{position:absolute;top:0;left:0;width:256px;height:256px;z-index:0}.ldmap_placeholder .ldmap_frame img.ldmap_tile_canvas{opacity:0;transition:opacity .3s}.ldmap_placeholder .ldmap_frame .ldmap_tile_offworld{position:absolute;top:0;left:0;width:256px;height:256px;background:#eee;z-index:0}.ldmap_placeholder .ldmap_frame .ldmap_tile_element{position:absolute;top:0;left:0}.ldmap_placeholder .ldmap_frame .ldmap_tile_top{z-index:1000!important}.ldmap_placeholder .ldmap_backbuffer{display:none}.ldmap_placeholder .ldmap_frame .ldmap_overlay{position:absolute;z-index:2}.ldmap_placeholder .ldmap_frame .ldmap_clickable{cursor:pointer}.ldmap_placeholder .ldmap_frame .ldmap_popupholder{z-index:3}.ldmap_placeholder .ldmap_frame .ldmap_popup{position:absolute;bottom:46px;min-height:60px;min-width:120px;max-width:320px;padding:10px;border:1px solid #a0a0a0;background:#fff;border-radius:16px;box-shadow:2px 2px 6px #888}.ldmap_placeholder .ldmap_frame .ldmap_popup_title{height:20px;max-width:92%;font-size:14px;font-weight:bold;vertical-align:bottom;line-height:1.5;overflow:hidden;display:inline-block}.ldmap_placeholder .ldmap_frame .ldmap_popup_close{width:17px;height:17px;float:right;cursor:pointer}.ldmap_placeholder .ldmap_frame .ldmap_popup_detail{max-width:94%;max-height:240px;padding:6px 18px 4px 0;word-wrap:break-word;overflow-y:auto;display:inline-block}.ldmap_placeholder .ldmap_frame .ldmap_popup_callout{position:absolute;bottom:-6px;left:-6px;width:80px;height:54px;pointer-events:none}.ldmap_placeholder .ldmap_frame .ldmap_overlay_info{color:#888;font-size:11px}.ldmap_placeholder .ldmap_frame .ldmap_overlay_image{text-align:center}.ldmap_placeholder .ldmap_frame .ldmap_overlay_description{margin:4px 0 4px 0}.ldmap_placeholder .ldmap_frame .ldmap_overlay_camera{width:320px;min-height:180px;max-height:240px;border:none}.ldmap_placeholder .ldmap_frame .ldmap_overlay_camera_overlay{margin-top:-2px;width:320px}.ldmap_placeholder .ldmap_frame .ldmap_geomlabel{padding:1px 2px 1px 2px;background:#ffc;font-size:10px;font-weight:bold;box-shadow:2px 2px 4px #444;white-space:nowrap;opacity:.8}.ldmap_placeholder .ldmap_frame .ldmap_geomlabel sup{font-size:.5em}.ldmap_placeholder .ldmap_anchor{position:absolute;left:-16px;width:1px;height:1px;border:none}.ldmap_placeholder .ldmap_navigation{position:absolute;top:4px;left:4px;text-align:left;z-index:10}.ldmap_placeholder .ldmap_dpad{position:relative;width:50px;height:50px;margin:0 4px 0 0;background-size:50px 50px;vertical-align:top}.ldmap_placeholder .ldmap_dpad .ldmap_goleft{position:absolute;left:2px;top:0;bottom:0;width:16px;height:16px;margin:auto;cursor:pointer}.ldmap_placeholder .ldmap_dpad .ldmap_goright{position:absolute;right:2px;top:0;bottom:0;width:16px;height:16px;margin:auto;cursor:pointer}.ldmap_placeholder .ldmap_dpad .ldmap_goup{position:absolute;left:0;right:0;top:2px;width:16px;height:16px;margin:auto;cursor:pointer}.ldmap_placeholder .ldmap_dpad .ldmap_godown{position:absolute;left:0;right:0;bottom:2px;width:16px;height:16px;margin:auto;cursor:pointer}.ldmap_placeholder .ldmap_dpad .ldmap_zoomlabel{position:absolute;left:0;right:0;top:0;bottom:0;height:16px;margin:auto;color:#288fde;font-weight:bold;text-align:center}.ldmap_placeholder .ldmap_zoom{margin:4px 4px 0 15px;vertical-align:top;display:inline-block}.ldmap_placeholder .ldmap_zoom img{display:block}.ldmap_placeholder .ldmap_zoomin{width:20px;height:23px}.ldmap_placeholder .ldmap_zoomout{width:20px;height:25px}.ldmap_placeholder .ldmap_zoombargroup{position:relative}.ldmap_placeholder .ldmap_zoombar{width:6px;height:200px;margin:0 0 0 7px;cursor:pointer}.ldmap_placeholder .ldmap_zoomslider{position:absolute;width:20px;height:13px;cursor:ns-resize}.ldmap_placeholder .ldmap_zoombar_mini{margin:8px 0 0 3px;width:44px;height:86px;vertical-align:top;line-height:0}.ldmap_placeholder .ldmap_zoombar_mini .ldmap_zoomin{width:44px;height:40px}.ldmap_placeholder .ldmap_zoombar_mini .ldmap_zoomout{width:44px;height:46px}.ldmap_placeholder .ldmap_zoombar_mini .ldmap_button:hover{filter:none}.ldmap_placeholder .ldmap_geolocation{width:20px;height:20px;margin:4px 4px 0 15px;vertical-align:middle}.ldmap_placeholder .ldmap_topleft{position:absolute;top:4px;left:60px;text-align:left;z-index:9}.ldmap_placeholder .ldmap_toolbar{margin:0 4px 0 0;vertical-align:top}.ldmap_placeholder .ldmap_toolbar .ldmap_button{width:24px;height:24px;margin:0 2px 0 0}.ldmap_placeholder .ldmap_topright{position:absolute;top:4px;right:4px;margin:0 0 0 110px;text-align:right;z-index:8}.ldmap_placeholder .ldmap_fullscreen{width:24px;height:24px;margin:2px 0 0 4px;vertical-align:top}.ldmap_placeholder .ldmap_crosshair{position:absolute;top:0;bottom:0;left:0;right:0;width:0;height:0;margin:auto;border:1px solid #f00;background:#f00;z-index:4}.ldmap_placeholder .ldmap_bottomleft{position:absolute;bottom:4px;left:6px;z-index:7}.ldmap_placeholder .ldmap_scale{height:5px;width:100px;margin:0 0 2px 0;padding:5px 0 0 0;border:1px solid #333;border-top:none;pointer-events:none}.ldmap_placeholder .ldmap_scale .ldmap_scalecaption{position:absolute;bottom:12px;width:100%;color:#333;text-align:center}.ldmap_placeholder .ldmap_scale .ldmap_scaleouter{width:60%;height:7px;margin:auto;border-left:1px solid #333;border-right:1px solid #000}.ldmap_placeholder .ldmap_scale .ldmap_scaleinner{width:33%;height:7px;margin:auto;border-left:1px solid #333;border-right:1px solid #000}.ldmap_placeholder .ldmap_bottomright{position:absolute;bottom:4px;right:6px;text-align:right;z-index:6}.ldmap_placeholder .ldmap_notice{font-size:10px}.ldmap_placeholder .ldmap_notice img{border:none;vertical-align:middle}.ldmap_placeholder .ldmap_floor{position:absolute;bottom:40px;right:4px;border:1px solid #a6a6a6;background:#fff;text-align:center;z-index:11;display:none}.ldmap_placeholder .ldmap_floor_item{padding:3px 8px 3px 8px;cursor:pointer}.ldmap_placeholder .ldmap_floor_item:hover{background:#cee}.ldmap_placeholder .ldmap_floor_item_active{background:#feb}.ldmap_placeholder .ldmap_contextmenu{position:absolute;width:180px;border:1px solid #a6a6a6;background:#ffa;display:none;z-index:5}.ldmap_placeholder .ldmap_contextmenu .ldmap_contextmenu_info{padding:6px;background:#def}.ldmap_placeholder .ldmap_contextmenu .ldmap_contextmenu_location{color:#777}.ldmap_placeholder .ldmap_contextmenu .ldmap_contextmenu_extra{padding:6px}.ldmap_placeholder .ldmap_contextmenu .ldmap_contextmenu_icon{border:none;width:14px;max-height:14px;margin:0 6px 2px 0;vertical-align:top}.ldmap_placeholder .ldmap_contextmenu .ldmap_contextmenu_poi{display:inline-block;height:14px;width:146px;overflow:hidden}.ldmap_placeholder .ldmap_tooltip{position:absolute;padding:3px 4px 3px 4px;border:1px solid #444;background:#fff;font-size:11px;white-space:nowrap;display:none;z-index:13}.ldmap_placeholder .ldmap_popup_mini{position:absolute;bottom:0;width:100%;height:30%;background:#fff;border-top:2px solid #2a97eb;display:none;z-index:12;overflow-y:auto}.ldmap_placeholder .ldmap_popup_mini .ldmap_popup_title{height:22px;padding:4px 8px 4px 8px;font-size:16px;font-weight:bold;vertical-align:bottom;line-height:1.5;overflow:hidden}.ldmap_placeholder .ldmap_popup_mini .ldmap_popup_close{width:17px;height:17px;padding:6px;float:right;cursor:pointer}.ldmap_placeholder .ldmap_popup_mini .ldmap_popup_detail{color:#666;padding:0 16px 8px 8px;font-size:14px;word-wrap:break-word}.ldmap_placeholder .ldmap_popup_mini .ldmap_overlay_info{color:#888;font-size:12px}.ldmap_placeholder .ldmap_popup_mini .ldmap_overlay_camera{width:320px;min-height:180px;max-height:240px;border:none}.ldmap_placeholder .ldmap_popup_mini .ldmap_overlay_camera_overlay{margin-top:-2px;width:320px}.ldmap_placeholder .ldmap_button{border:none;cursor:pointer;font-size:11px}.ldmap_placeholder .ldmap_button:hover{filter:drop-shadow(0 0 4px #cee)}.ldmap_placeholder .ldmap_menubar{margin:0 4px 0 4px;border-radius:4px;font-size:11px;cursor:default;display:inline-block;white-space:nowrap}.ldmap_placeholder .ldmap_menubar .ldmap_item{padding:6px 8px 6px 8px;border-right:1px solid #a6a6a6;background:#fff;box-shadow:2px 3px 4px rgba(0,0,0,.2);vertical-align:top;display:inline-block;transition:.1s}.ldmap_placeholder .ldmap_menubar .ldmap_item:first-child{border-radius:4px 0 0 4px}.ldmap_placeholder .ldmap_menubar .ldmap_item:last-child{border-right:none;border-radius:0 4px 4px 0}.ldmap_placeholder .ldmap_menubar .ldmap_button:hover{background:#cee;filter:none}.ldmap_placeholder .ldmap_menubar .ldmap_button_active{background:#2085f3!important;color:#fff}.ldmap_placeholder .ldmap_menubar .ldmap_button_active:hover{background:#69f!important}.ldmap_placeholder .ldmap_menubar .ldmap_arrow{float:right;margin:6px 2px 0 4px;width:6px;height:6px}.ldmap_placeholder .ldmap_menubar .ldmap_dropdown{vertical-align:top;display:inline-block}.ldmap_placeholder .ldmap_menubar .ldmap_dropdown:first-child .ldmap_dropdown_head{border-top-left-radius:4px;border-bottom-left-radius:4px}.ldmap_placeholder .ldmap_menubar .ldmap_dropdown_head{padding:6px 4px 6px 8px;text-align:center;background:#fff;border-radius:0 4px 4px 0;box-shadow:2px 3px 4px rgba(0,0,0,.2);cursor:pointer;transition:.1s}.ldmap_placeholder .ldmap_menubar .ldmap_dropdown_head:hover{background:#cee}.ldmap_placeholder .ldmap_menubar .ldmap_dropdown_body{background:#fff;text-align:left;margin:4px 0 0 0;border-radius:4px;box-shadow:0 1px 6px rgba(0,0,0,.3);overflow-y:auto}.ldmap_placeholder .ldmap_menubar .ldmap_group{padding:6px 14px 6px 14px;background:#eee;text-align:center}.ldmap_placeholder .ldmap_menubar .ldmap_option{padding:6px 20px 6px 12px;cursor:pointer;transition:.1s}.ldmap_placeholder .ldmap_menubar .ldmap_option:hover{background:#cee}.ldmap_placeholder .ldmap_menubar .ldmap_option_active{background:#feb}.ldmap_placeholder .ldmap_menubar .ldmap_command{padding:3px 14px 3px 14px;background:#f3f6f9}.ldmap_placeholder .ldmap_tagpanel{border:none;background:#fff;text-align:right;vertical-align:top}.ldmap_placeholder .ldmap_tagpanel .ldmap_dropdown_head{border-radius:4px;display:inline-block}.ldmap_placeholder .ldmap_tagpanel .ldmap_tagpanel_head img{height:14px;margin:0 2px 0 0;vertical-align:top}.ldmap_placeholder .ldmap_tagpanel .ldmap_tagpanel_head img:hover{opacity:.5}.ldmap_placeholder .ldmap_tagpanel .ldmap_tagpanel_body{position:absolute;width:306px;margin:4px 0 0 0;padding:8px 0 0 0;border-radius:4px;box-shadow:0 1px 6px rgba(0,0,0,.3);z-index:-1}.ldmap_placeholder .ldmap_tagcategory{padding:0 6px 0 6px;color:#3f230c}.ldmap_placeholder .ldmap_tagcategory table{width:99%;margin:2px 0 6px 4px;border-collapse:separate;vertical-align:middle}.ldmap_placeholder .ldmap_tagcategory tr{height:18px}.ldmap_placeholder .ldmap_tagcategory td{padding:0;width:29px}.ldmap_placeholder .ldmap_category_icon{cursor:pointer;margin:auto}.ldmap_placeholder .ldmap_category_icon:hover{opacity:.5}.ldmap_placeholder .ldmap_morecategory{cursor:pointer;background:#fff9df;font-size:11px;color:#3f230c;text-align:center;padding:3px 0 3px 0;border:1px dashed #efdfb3}.ldmap_placeholder .ldmap_morecategory .ldmap_arrow{float:none;margin:0}.ldmap_placeholder .ldmap_customcontrol{vertical-align:top;display:inline-block;white-space:nowrap}.ldmap_placeholder .ldmap_alert{padding:2px 6px 2px 6px;border:1px solid #a6a6a6;background:#fff;font-size:11px;vertical-align:middle;display:none}.ldmap_placeholder .ldmap_alert_error{color:#f00}.ldmap_placeholder .ldmap_legend{width:115px}.ldmap_placeholder .ldmap_lock_overlay{position:absolute;top:0;left:0;bottom:0;right:0;background:rgba(0,0,0,.1);z-index:254}.ldmap_placeholder .ldmap_lock_button{position:absolute;bottom:22px;right:8px;width:80px;height:30px;z-index:255}.ldmap_placeholder .ldmap_externalmap{position:absolute;top:0;left:0;width:100%;height:100%;z-index:-2}.ldmap_placeholder .ldmap_external_bottom_left{bottom:28px}.ldmap_placeholder .ldmap_external_bottom_right{bottom:24px}.ldmap_placeholder .ldmap_link{color:#069;cursor:pointer}.ldmap_placeholder .ldmap_link:hover{color:#e80;text-decoration:underline}.ldmap_placeholder .ldmap_poi_load{width:252px;padding:20px;text-align:center}.ldmap_placeholder .ldmap_poi_warning{margin:8px 0 0 0;border-radius:4px;text-align:center}.ldmap_placeholder .ldmap_poi_warning img{width:144px;height:20px}.ldmap_placeholder .ldmap_poi_unverified{background:#ffa60c}.ldmap_placeholder .ldmap_poi_obsoleted{background:#e13209}.ldmap_placeholder .ldmap_poi_icon{width:24px;height:24px;margin:-4px 0 0 0;border:none;float:left}.ldmap_placeholder .ldmap_poi_info{margin:8px 0 0 34px;min-height:24px}.ldmap_placeholder .ldmap_poi_info .ldmap_arrow{width:6px;height:6px}.ldmap_placeholder .ldmap_poi_info_hidden{display:none}.ldmap_placeholder .ldmap_poi_open{cursor:pointer}.ldmap_placeholder .ldmap_poi_dow{width:40px;display:inline-block}.ldmap_placeholder .ldmap_poi_menu{width:292px;margin:8px 0 0 0;padding:4px 0 4px 0;border-top:1px solid #ccc}/*.ldmap_placeholder .ldmap_tag_label{color:#999;text-shadow:-1px -1px #fff,1px -1px #fff,-1px 1px #fff,1px 1px #fff}.ldmap_placeholder .ldmap_tag_label img{vertical-align:middle;cursor:pointer}.ldmap_placeholder .ldmap_tag_token{width:120px;height:16px;overflow:hidden;cursor:auto}*/.ldmap_placeholder_DARK{filter:invert(1) hue-rotate(200deg) brightness(1)}.ldmap_placeholder_LIGHT .ldmap_frame .ldmap_tile img:not([src^="https://mstraffic1."]){filter:grayscale(.75) saturate(.75) hue-rotate(30deg) contrast(1.1)}.ldsearch_placeholder{min-width:240px;font:12px/1.2 Tahoma,sans-serif}.ldsearch_placeholder .ldsearch_list{margin:0;padding:0;list-style:none;cursor:pointer}.ldsearch_placeholder .ldsearch_item{margin:0;padding:8px 4px 8px 6px;border-bottom:1px solid #ddd;background:#fff;font-size:14px}.ldsearch_placeholder .ldsearch_item:hover{background:#eee}.ldsearch_placeholder .ldsearch_zoom{width:16px;height:16px;float:right;margin:0 0 0 2px}.ldsearch_placeholder .ldsearch_icon{border:none;width:14px;max-height:14px;margin:4px 6px 20px 0;float:left}.ldsearch_placeholder .ldsearch_address{margin:2px 0 0 20px;color:#999;font-size:11px}.ldsearch_placeholder .ldsearch_empty{padding:6px 0 6px 0;color:#888;text-align:center}.ldsearch_placeholder .ldsearch_more{padding:6px 0 6px 0;text-align:center;color:#fff;background:#59b3f8;cursor:pointer}.ldsearch_placeholder .ldsearch_load{margin:8px;text-align:center}.ldroute_placeholder{min-width:240px;font:12px/1.2 Tahoma,sans-serif}.ldroute_placeholder .ldroute_about{height:100%;padding:0 8px 0 8px;background:#fff}.ldroute_placeholder .ldroute_head{color:#393;font-size:14px;font-weight:bold}.ldroute_placeholder .ldroute_warn{color:#f00}.ldroute_placeholder .ldroute_indent{margin:4px 0 8px 16px}.ldroute_placeholder .ldroute_error{color:#f00;text-align:center}.ldroute_placeholder .ldroute_menu{width:21%;padding:2%;font-weight:bold;background:#eef;cursor:pointer;text-align:center;display:inline-block}.ldroute_placeholder .ldroute_menu:hover{background:#eff}.ldroute_placeholder .ldroute_pref{padding:8px;background:#eff}.ldroute_placeholder .ldroute_pref_right{float:right;width:50%}.ldroute_placeholder .ldroute_pref_bottom{clear:both}.ldroute_placeholder .ldroute_pref label{display:block}.ldroute_placeholder button{margin:12px 0 4px 0}.ldroute_placeholder input[type=datetime-local]{margin:0 8px 0 4px;width:75%}.ldroute_placeholder .ldroute_info{height:16px;padding:8px;border-bottom:1px solid #ddd;color:#fff;background:#888;font-size:16px}.ldroute_placeholder .ldroute_distance{float:left;margin:0 0 0 2px}.ldroute_placeholder .ldroute_interval{float:right}.ldroute_placeholder .ldroute_list{margin:0;padding:0;list-style:none}.ldroute_placeholder .ldroute_item{padding:8px 4px 8px 6px;border-bottom:1px solid #ddd;background:#efe}.ldroute_placeholder .ldroute_type_air{background:#edf}.ldroute_placeholder .ldroute_type_rail{background:#ffd}.ldroute_placeholder .ldroute_type_ferry{background:#def}.ldroute_placeholder .ldroute_item:hover{background:#eee;cursor:pointer}.ldroute_placeholder .ldroute_dest{background:#fed!important}.ldroute_placeholder .ldroute_icon{border:none;margin:0 6px 10px 0;height:16px;float:left}.ldroute_placeholder .ldroute_road{color:#39c}.ldroute_placeholder .ldroute_poi{color:#c30;cursor:pointer}.ldroute_placeholder .ldroute_dist{color:#888;font-size:11px;margin:0 0 0 2px;float:right}@media print{.ldmap_placeholder .ldmap_button,.ldmap_placeholder .ldmap_menubar,.ldmap_placeholder .ldmap_dpad,.ldmap_placeholder .ldmap_zoom{display:none!important}}'});})()